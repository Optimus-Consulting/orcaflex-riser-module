{"version":3,"file":"858.js","mappings":"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","sources":["webpack://orcaflex-riser-module/./src/three/object-creators/water-plane.ts","webpack://orcaflex-riser-module/./src/services/orcaflex-api.service.ts","webpack://orcaflex-riser-module/./src/sidebar/line-types-section/line-types-section.component.ts","webpack://orcaflex-riser-module/./src/sidebar/line-types-section/buoyancy-modules-import-dialog.component.ts","webpack://orcaflex-riser-module/./src/three/object-creators/grid.ts","webpack://orcaflex-riser-module/./src/components/orcaflex-riser.component.ts","webpack://orcaflex-riser-module/./src/sidebar/risers-section/risers-section.component.ts","webpack://orcaflex-riser-module/./src/three/view-helper.ts","webpack://orcaflex-riser-module/./src/sidebar/logs-section/logs-section.component.ts","webpack://orcaflex-riser-module/./src/sidebar/vessel-section/vessel-section.component.ts","webpack://orcaflex-riser-module/./src/three/config.ts","webpack://orcaflex-riser-module/./src/services/model-state.service.ts","webpack://orcaflex-riser-module/./src/module.ts","webpack://orcaflex-riser-module/./src/sidebar/vessel-section/connection-points-import-dialog.component.ts","webpack://orcaflex-riser-module/./src/components/three-view/three-view.component.ts","webpack://orcaflex-riser-module/./src/three/object-creators/catenary-cable.ts","webpack://orcaflex-riser-module/./src/types/line-type.types.ts","webpack://orcaflex-riser-module/./src/sidebar/results-section/results-section.component.ts","webpack://orcaflex-riser-module/./src/types/riser.types.ts","webpack://orcaflex-riser-module/./src/three/scene-manager.ts","webpack://orcaflex-riser-module/./src/three/object-creators/lazy-wave-riser.ts","webpack://orcaflex-riser-module/./src/types/vessel.types.ts","webpack://orcaflex-riser-module/./src/components/generate-orcaflex-dialog/generate-orcaflex-dialog.component.ts","webpack://orcaflex-riser-module/./src/three/object-creators/seabed-plane.ts","webpack://orcaflex-riser-module/./src/types/environment.types.ts","webpack://orcaflex-riser-module/./src/sidebar/line-types-section/line-types-import-dialog.component.ts","webpack://orcaflex-riser-module/./src/three/object-creators/vessel-mesh.ts","webpack://orcaflex-riser-module/./src/sidebar/environment-section/environment-section.component.ts","webpack://orcaflex-riser-module/./src/three/object-creators/coordinate-axes.ts"],"sourcesContent":["/**\n * Water surface plane creator\n */\n\nimport * as THREE from 'three';\nimport { COLORS } from '../config';\n\nexport interface WaterPlaneOptions {\n  size?: number;\n  opacity?: number;\n}\n\n/**\n * Create a water surface plane at z=0\n */\nexport function createWaterPlane(options: WaterPlaneOptions = {}): THREE.Mesh {\n  const { size = 2000, opacity = 0.6 } = options;\n\n  const geometry = new THREE.PlaneGeometry(size, size, 32, 32);\n\n  const material = new THREE.MeshPhongMaterial({\n    color: COLORS.water,\n    transparent: true,\n    opacity: opacity,\n    side: THREE.DoubleSide,\n    shininess: 100,\n    specular: 0x111111,\n  });\n\n  const mesh = new THREE.Mesh(geometry, material);\n  mesh.position.set(0, 0, 0);\n  mesh.receiveShadow = true;\n  mesh.userData = {\n    type: 'waterSurface',\n    name: 'Sea Surface',\n  };\n\n  return mesh;\n}\n","import { Injectable, inject } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { firstValueFrom } from 'rxjs';\nimport {\n  CatenaryRequest,\n  CatenaryResult,\n  LazyWaveRequest,\n  LazyWaveResult,\n  ParseYamlResponse,\n  GenerateYamlRequest,\n  ModelValidationResult,\n  VesselExtractResponse,\n} from '../types';\n\n/**\n * API service for OrcaFlex calculations and YAML operations.\n * Uses the ModuleApiService provided by CARIS host application,\n * or falls back to HttpClient for standalone testing.\n */\n@Injectable({ providedIn: 'root' })\nexport class OrcaFlexApiService {\n  private httpClient = inject(HttpClient);\n  private externalApiService: any = null;\n\n  /**\n   * Initialize with the CARIS module API service (optional)\n   */\n  setApiService(api: any): void {\n    this.externalApiService = api;\n  }\n\n  // Calculation endpoints\n  async calculateCatenary(request: CatenaryRequest): Promise<CatenaryResult> {\n    return this.post<CatenaryResult>('/api/orcaflex/calculate/catenary', request);\n  }\n\n  async calculateLazyWave(request: LazyWaveRequest): Promise<LazyWaveResult> {\n    return this.post<LazyWaveResult>('/api/orcaflex/calculate/lazy-wave', request);\n  }\n\n  // YAML operations\n  async parseYaml(content: string): Promise<ParseYamlResponse> {\n    return this.post<ParseYamlResponse>('/api/orcaflex/parse', { content });\n  }\n\n  async parseVesselFromYaml(content: string | File): Promise<VesselExtractResponse> {\n    const contentStr = content instanceof File ? await content.text() : content;\n    return this.post<VesselExtractResponse>('/api/orcaflex/parse-vessel', { content: contentStr });\n  }\n\n  async generateYaml(request: GenerateYamlRequest): Promise<{ yaml: string }> {\n    return this.post<{ yaml: string }>('/api/orcaflex/generate', request);\n  }\n\n  async downloadYaml(request: GenerateYamlRequest): Promise<Blob> {\n    if (this.externalApiService) {\n      return this.externalApiService.post(\n        '/api/orcaflex/generate/download',\n        request,\n        { responseType: 'blob' }\n      );\n    }\n    return firstValueFrom(\n      this.httpClient.post('/api/orcaflex/generate/download', request, { responseType: 'blob' })\n    );\n  }\n\n  async validateModel(model: any): Promise<ModelValidationResult> {\n    return this.post<ModelValidationResult>('/api/orcaflex/validate', { model });\n  }\n\n  /**\n   * Make a POST request using either the external API service or HttpClient\n   */\n  private async post<T>(url: string, body: any): Promise<T> {\n    if (this.externalApiService) {\n      const response = await this.externalApiService.post(url, body);\n      return response as T;\n    }\n    // Use Angular HttpClient for standalone mode\n    return firstValueFrom(this.httpClient.post<T>(url, body));\n  }\n}\n","import { Component, inject, signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { ModelStateService } from '../../services/model-state.service';\nimport {\n  LineTypeConfig,\n  BuoyancyModuleConfig,\n  calculateWetMass,\n  calculatePipeDensity,\n  calculateDryMass,\n  calculateDryMassFromDensity,\n  calculateModuleBuoyancy,\n  calculateBuoyancySectionLength,\n  calculateBuoyancyWeightPerMeter,\n} from '../../types';\nimport { LineTypesImportDialogComponent } from './line-types-import-dialog.component';\nimport { BuoyancyModulesImportDialogComponent } from './buoyancy-modules-import-dialog.component';\n\n@Component({\n  selector: 'orcaflex-line-types-section',\n  standalone: true,\n  imports: [CommonModule, FormsModule, LineTypesImportDialogComponent, BuoyancyModulesImportDialogComponent],\n  template: `\n    <div class=\"section-content\">\n      <!-- Line Types -->\n      <div class=\"subsection-header\">\n        <span>Line Types</span>\n        <div class=\"header-actions\">\n          <button class=\"import-btn\" (click)=\"showLineTypesImportDialog = true\" title=\"Import from Excel\">Import</button>\n          <button class=\"add-btn\" (click)=\"startAddLineType()\">+</button>\n        </div>\n      </div>\n\n      @for (lineType of lineTypes(); track lineType.id) {\n        <div\n          class=\"line-type-item\"\n          [class.selected]=\"selectedLineTypeId() === lineType.id\"\n        >\n          <div class=\"line-type-header\" (click)=\"selectLineType(lineType.id)\">\n            <span class=\"line-type-name\">{{ lineType.name }}</span>\n            <button class=\"delete-btn\" (click)=\"deleteLineType(lineType.id); $event.stopPropagation()\"></button>\n          </div>\n          <div class=\"line-type-summary\">\n            OD: {{ formatDiameter(lineType.outerDiameter) }} | Dry Mass: {{ lineType.dryMass.toFixed(1) }} kg/m\n          </div>\n\n          @if (selectedLineTypeId() === lineType.id) {\n            <div class=\"line-type-editor\" (click)=\"$event.stopPropagation()\">\n              <div class=\"form-group\">\n                <label>Name</label>\n                <input type=\"text\" [ngModel]=\"lineType.name\"\n                  (ngModelChange)=\"updateLineType(lineType, 'name', $event)\" />\n              </div>\n\n              <!-- Geometry -->\n              <div class=\"section-title\">Geometry</div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Outer Diameter (mm)</label>\n                  <input type=\"number\" [ngModel]=\"lineType.outerDiameter * 1000\"\n                    (ngModelChange)=\"updateLineType(lineType, 'outerDiameter', $event / 1000)\" step=\"0.1\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Inner Diameter (mm)</label>\n                  <input type=\"number\" [ngModel]=\"lineType.innerDiameter * 1000\"\n                    (ngModelChange)=\"updateLineType(lineType, 'innerDiameter', $event / 1000)\" step=\"0.1\" />\n                </div>\n              </div>\n\n              <!-- Mass Properties -->\n              <div class=\"section-title\">Mass Properties</div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Dry Mass (kg/m)</label>\n                  <input type=\"number\" [ngModel]=\"lineType.dryMass\"\n                    (ngModelChange)=\"updateDryMass(lineType, $event)\" step=\"0.1\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Wet Mass (kg/m)</label>\n                  <input type=\"number\" [ngModel]=\"getWetMass(lineType)\"\n                    (ngModelChange)=\"updateWetMass(lineType, $event)\" step=\"0.1\" />\n                </div>\n              </div>\n              <div class=\"form-group\">\n                <label>Pipe Density (kg/m)</label>\n                <input type=\"number\" [ngModel]=\"getPipeDensity(lineType)\"\n                  (ngModelChange)=\"updatePipeDensity(lineType, $event)\" step=\"1\"\n                  class=\"calculated-input\" />\n                <span class=\"calc-hint\">Auto-calculated from mass & geometry</span>\n              </div>\n\n              <!-- Stiffness Properties -->\n              <div class=\"section-title\">Stiffness Properties</div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Bending EI (kNm)</label>\n                  <input type=\"number\" [ngModel]=\"lineType.bendingStiffness\"\n                    (ngModelChange)=\"updateLineType(lineType, 'bendingStiffness', $event)\" step=\"0.1\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Axial EA (kN)</label>\n                  <input type=\"number\" [ngModel]=\"lineType.axialStiffness\"\n                    (ngModelChange)=\"updateLineType(lineType, 'axialStiffness', $event)\" step=\"100\" />\n                </div>\n              </div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Torsional GJ (kNm)</label>\n                  <input type=\"number\" [ngModel]=\"lineType.torsionalStiffness ?? 10\"\n                    (ngModelChange)=\"updateLineType(lineType, 'torsionalStiffness', $event)\" step=\"0.1\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Poisson Ratio</label>\n                  <input type=\"number\" [ngModel]=\"lineType.poissonRatio ?? 0.5\"\n                    (ngModelChange)=\"updateLineType(lineType, 'poissonRatio', $event)\" step=\"0.01\" min=\"0\" max=\"0.5\" />\n                </div>\n              </div>\n\n              <!-- Limits -->\n              <div class=\"section-title\">Limits</div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Allowable Tension (kN)</label>\n                  <input type=\"number\" [ngModel]=\"lineType.allowableTension ?? 5000\"\n                    (ngModelChange)=\"updateLineType(lineType, 'allowableTension', $event)\" step=\"100\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Min Bend Radius (m)</label>\n                  <input type=\"number\" [ngModel]=\"lineType.minBendRadius ?? 3\"\n                    (ngModelChange)=\"updateLineType(lineType, 'minBendRadius', $event)\" step=\"0.1\" />\n                </div>\n              </div>\n\n              <!-- Coefficients -->\n              <div class=\"section-title\">Drag Coefficients</div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Normal</label>\n                  <input type=\"number\" [ngModel]=\"lineType.dragCoefficients.normal\"\n                    (ngModelChange)=\"updateDragCoeff(lineType, 'normal', $event)\" step=\"0.1\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Axial</label>\n                  <input type=\"number\" [ngModel]=\"lineType.dragCoefficients.axial\"\n                    (ngModelChange)=\"updateDragCoeff(lineType, 'axial', $event)\" step=\"0.001\" />\n                </div>\n              </div>\n            </div>\n          }\n        </div>\n      }\n\n      @if (addingLineType()) {\n        <div class=\"line-type-item new-item\">\n          <div class=\"line-type-editor\">\n            <div class=\"form-group\">\n              <label>Name</label>\n              <input type=\"text\" [(ngModel)]=\"newLineType.name\" placeholder=\"Line type name\" />\n            </div>\n            <div class=\"form-row\">\n              <div class=\"form-group half\">\n                <label>OD (mm)</label>\n                <input type=\"number\" [(ngModel)]=\"newLineTypeODmm\" step=\"0.1\" />\n              </div>\n              <div class=\"form-group half\">\n                <label>ID (mm)</label>\n                <input type=\"number\" [(ngModel)]=\"newLineTypeIDmm\" step=\"0.1\" />\n              </div>\n            </div>\n            <div class=\"form-group\">\n              <label>Dry Mass (kg/m)</label>\n              <input type=\"number\" [(ngModel)]=\"newLineType.dryMass\" step=\"0.1\" />\n            </div>\n            <div class=\"action-buttons\">\n              <button class=\"btn save\" (click)=\"saveNewLineType()\">Add</button>\n              <button class=\"btn cancel\" (click)=\"cancelAddLineType()\">Cancel</button>\n            </div>\n          </div>\n        </div>\n      }\n\n      <!-- Buoyancy Modules -->\n      <div class=\"subsection-header buoyancy\">\n        <span>Buoyancy Modules</span>\n        <div class=\"header-actions\">\n          <button class=\"import-btn\" (click)=\"showBuoyancyImportDialog = true\" title=\"Import from Excel\">Import</button>\n          <button class=\"add-btn\" (click)=\"startAddBuoyancy()\">+</button>\n        </div>\n      </div>\n\n      @for (buoyancy of buoyancyModules(); track buoyancy.id) {\n        <div\n          class=\"buoyancy-item\"\n          [class.selected]=\"selectedBuoyancyId() === buoyancy.id\"\n        >\n          <div class=\"buoyancy-header\" (click)=\"selectBuoyancy(buoyancy.id)\">\n            <span class=\"buoyancy-name\">{{ buoyancy.name }}</span>\n            <button class=\"delete-btn small\" (click)=\"deleteBuoyancy(buoyancy.id); $event.stopPropagation()\"></button>\n          </div>\n          <div class=\"buoyancy-summary\">\n            {{ buoyancy.numberOfModules }}x {{ (buoyancy.length * 1000).toFixed(0) }}mm @ {{ buoyancy.spacing }}m\n          </div>\n\n          @if (selectedBuoyancyId() === buoyancy.id) {\n            <div class=\"buoyancy-editor\" (click)=\"$event.stopPropagation()\">\n              <div class=\"form-group\">\n                <label>Name</label>\n                <input type=\"text\" [ngModel]=\"buoyancy.name\"\n                  (ngModelChange)=\"updateBuoyancy(buoyancy, 'name', $event)\" />\n              </div>\n\n              <div class=\"section-title\">Module Dimensions</div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>OD (mm)</label>\n                  <input type=\"number\" [ngModel]=\"buoyancy.outerDiameter * 1000\"\n                    (ngModelChange)=\"updateBuoyancy(buoyancy, 'outerDiameter', $event / 1000)\" step=\"1\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Length (mm)</label>\n                  <input type=\"number\" [ngModel]=\"buoyancy.length * 1000\"\n                    (ngModelChange)=\"updateBuoyancy(buoyancy, 'length', $event / 1000)\" step=\"10\" />\n                </div>\n              </div>\n\n              <div class=\"section-title\">Mass Properties (per module)</div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Mass in Air (kg)</label>\n                  <input type=\"number\" [ngModel]=\"buoyancy.dryMass\"\n                    (ngModelChange)=\"updateBuoyancy(buoyancy, 'dryMass', $event)\" step=\"0.1\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Apparent Mass in Water (kg)</label>\n                  <input type=\"number\" [ngModel]=\"buoyancy.apparentMassInWater\"\n                    (ngModelChange)=\"updateBuoyancy(buoyancy, 'apparentMassInWater', $event)\" step=\"1\" />\n                </div>\n              </div>\n              <div class=\"form-group\">\n                <label>Net Buoyancy (N/module)</label>\n                <input type=\"number\" [value]=\"getModuleBuoyancy(buoyancy)\" disabled class=\"calculated-input\" />\n                <span class=\"calc-hint\">Calculated from apparent mass</span>\n              </div>\n\n              <div class=\"section-title\">Installation</div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Number of Modules</label>\n                  <input type=\"number\" [ngModel]=\"buoyancy.numberOfModules\"\n                    (ngModelChange)=\"updateBuoyancy(buoyancy, 'numberOfModules', $event)\" min=\"1\" step=\"1\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Spacing (m)</label>\n                  <input type=\"number\" [ngModel]=\"buoyancy.spacing\"\n                    (ngModelChange)=\"updateBuoyancy(buoyancy, 'spacing', $event)\" step=\"0.5\" min=\"0\" />\n                </div>\n              </div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Section Length (m)</label>\n                  <input type=\"number\" [value]=\"getSectionLength(buoyancy)\" disabled class=\"calculated-input\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Buoyancy/m (N/m)</label>\n                  <input type=\"number\" [value]=\"getBuoyancyPerMeter(buoyancy)\" disabled class=\"calculated-input\" />\n                </div>\n              </div>\n            </div>\n          }\n        </div>\n      }\n\n      @if (addingBuoyancy()) {\n        <div class=\"buoyancy-item new-item\">\n          <div class=\"buoyancy-editor\">\n            <div class=\"form-group\">\n              <label>Name</label>\n              <input type=\"text\" [(ngModel)]=\"newBuoyancy.name\" placeholder=\"Module name\" />\n            </div>\n            <div class=\"form-row\">\n              <div class=\"form-group half\">\n                <label>OD (mm)</label>\n                <input type=\"number\" [(ngModel)]=\"newBuoyancyODmm\" step=\"1\" />\n              </div>\n              <div class=\"form-group half\">\n                <label>Length (mm)</label>\n                <input type=\"number\" [(ngModel)]=\"newBuoyancyLengthmm\" step=\"10\" />\n              </div>\n            </div>\n            <div class=\"form-row\">\n              <div class=\"form-group half\">\n                <label>Number of Modules</label>\n                <input type=\"number\" [(ngModel)]=\"newBuoyancy.numberOfModules\" min=\"1\" step=\"1\" />\n              </div>\n              <div class=\"form-group half\">\n                <label>Spacing (m)</label>\n                <input type=\"number\" [(ngModel)]=\"newBuoyancy.spacing\" step=\"0.5\" />\n              </div>\n            </div>\n            <div class=\"action-buttons\">\n              <button class=\"btn save\" (click)=\"saveNewBuoyancy()\">Add</button>\n              <button class=\"btn cancel\" (click)=\"cancelAddBuoyancy()\">Cancel</button>\n            </div>\n          </div>\n        </div>\n      }\n\n      <!-- Import Dialogs -->\n      <orcaflex-line-types-import-dialog\n        [(visible)]=\"showLineTypesImportDialog\"\n        (import)=\"handleLineTypesImport($event)\"\n      />\n      <orcaflex-buoyancy-modules-import-dialog\n        [(visible)]=\"showBuoyancyImportDialog\"\n        (import)=\"handleBuoyancyModulesImport($event)\"\n      />\n    </div>\n  `,\n  styles: [`\n    .section-content {\n      padding: 0;\n    }\n\n    .subsection-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 8px 12px;\n      background: var(--caris-bg-subtle, #f5f5f5);\n      border-bottom: 1px solid var(--caris-border-light, #eee);\n      font-size: 10px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .subsection-header.buoyancy {\n      margin-top: 8px;\n    }\n\n    .header-actions {\n      display: flex;\n      gap: 4px;\n      align-items: center;\n    }\n\n    .import-btn {\n      padding: 2px 6px;\n      border: 1px solid var(--caris-primary, #1976d2);\n      border-radius: 3px;\n      background: transparent;\n      color: var(--caris-primary, #1976d2);\n      font-size: 9px;\n      cursor: pointer;\n      text-transform: none;\n      font-weight: 500;\n    }\n\n    .import-btn:hover {\n      background: var(--caris-primary, #1976d2);\n      color: white;\n    }\n\n    .section-title {\n      font-size: 10px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: var(--caris-text-secondary, #666);\n      margin: 12px 0 8px;\n      padding-top: 8px;\n      border-top: 1px solid var(--caris-border-light, #eee);\n    }\n\n    .section-title:first-of-type {\n      margin-top: 8px;\n      padding-top: 0;\n      border-top: none;\n    }\n\n    .add-btn {\n      width: 20px;\n      height: 20px;\n      border: 1px dashed var(--caris-border-light, #ccc);\n      border-radius: 3px;\n      background: transparent;\n      color: var(--caris-text-secondary, #666);\n      font-size: 14px;\n      cursor: pointer;\n    }\n\n    .add-btn:hover {\n      border-color: var(--caris-primary, #1976d2);\n      color: var(--caris-primary, #1976d2);\n    }\n\n    .line-type-item,\n    .buoyancy-item {\n      margin: 8px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      overflow: hidden;\n      cursor: pointer;\n    }\n\n    .line-type-item:hover,\n    .buoyancy-item:hover {\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .line-type-item.selected,\n    .buoyancy-item.selected {\n      border-color: var(--caris-primary, #1976d2);\n      background: var(--caris-bg-selected, #e3f2fd);\n    }\n\n    .line-type-item.new-item,\n    .buoyancy-item.new-item {\n      border-style: dashed;\n      cursor: default;\n    }\n\n    .line-type-header,\n    .buoyancy-header {\n      padding: 8px 12px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .line-type-name,\n    .buoyancy-name {\n      font-weight: 500;\n      font-size: 12px;\n    }\n\n    .line-type-summary,\n    .buoyancy-summary {\n      padding: 0 12px 8px;\n      font-size: 11px;\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .delete-btn {\n      width: 20px;\n      height: 20px;\n      border: none;\n      background: transparent;\n      color: var(--caris-text-secondary, #999);\n      font-size: 16px;\n      cursor: pointer;\n      border-radius: 3px;\n    }\n\n    .delete-btn:hover {\n      background: #ffebee;\n      color: var(--caris-error, #f44336);\n    }\n\n    .delete-btn.small {\n      width: 18px;\n      height: 18px;\n      font-size: 14px;\n    }\n\n    .line-type-editor,\n    .buoyancy-editor {\n      padding: 12px;\n      border-top: 1px solid var(--caris-border-light, #eee);\n      background: var(--caris-bg-subtle, #fafafa);\n    }\n\n    .form-group {\n      margin-bottom: 10px;\n    }\n\n    .form-group:last-child {\n      margin-bottom: 0;\n    }\n\n    .form-group label {\n      display: block;\n      font-size: 10px;\n      color: var(--caris-text-secondary, #666);\n      margin-bottom: 2px;\n    }\n\n    .form-group input {\n      width: 100%;\n      padding: 5px 6px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      font-size: 11px;\n      background: white;\n    }\n\n    .form-group input:focus {\n      outline: none;\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .form-group input.calculated-input {\n      background: var(--caris-bg-subtle, #f9f9f9);\n    }\n\n    .calc-hint {\n      display: block;\n      font-size: 9px;\n      color: var(--caris-text-tertiary, #999);\n      margin-top: 2px;\n      font-style: italic;\n    }\n\n    .form-row {\n      display: flex;\n      gap: 8px;\n    }\n\n    .form-group.half {\n      flex: 1;\n    }\n\n    .action-buttons {\n      display: flex;\n      gap: 8px;\n      margin-top: 12px;\n    }\n\n    .btn {\n      flex: 1;\n      padding: 6px 12px;\n      border-radius: 4px;\n      font-size: 11px;\n      cursor: pointer;\n    }\n\n    .btn.save {\n      background: var(--caris-primary, #1976d2);\n      color: white;\n      border: none;\n    }\n\n    .btn.save:hover {\n      background: var(--caris-primary-dark, #1565c0);\n    }\n\n    .btn.cancel {\n      background: white;\n      border: 1px solid var(--caris-border-light, #ddd);\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .btn.cancel:hover {\n      background: var(--caris-bg-subtle, #f5f5f5);\n    }\n  `]\n})\nexport class LineTypesSectionComponent {\n  private modelState = inject(ModelStateService);\n\n  lineTypes = this.modelState.lineTypes;\n  buoyancyModules = this.modelState.buoyancyModules;\n\n  selectedLineTypeId = signal<string | null>(null);\n  selectedBuoyancyId = signal<string | null>(null);\n\n  addingLineType = signal(false);\n  addingBuoyancy = signal(false);\n\n  newLineType: Partial<LineTypeConfig> = this.getDefaultNewLineType();\n  newLineTypeODmm = 355.6;\n  newLineTypeIDmm = 254;\n\n  newBuoyancy: Partial<BuoyancyModuleConfig> = this.getDefaultNewBuoyancy();\n  newBuoyancyODmm = 1450;\n  newBuoyancyLengthmm = 1600;\n\n  // Import dialog state\n  showLineTypesImportDialog = false;\n  showBuoyancyImportDialog = false;\n\n  formatDiameter(meters: number): string {\n    const mm = meters * 1000;\n    const inches = meters * 39.37;\n    return `${mm.toFixed(1)}mm (${inches.toFixed(1)}\")`;\n  }\n\n  getWetMass(lineType: LineTypeConfig): number {\n    const waterDensity = this.modelState.environment().sea.waterDensity;\n    return Math.round(calculateWetMass(lineType, waterDensity) * 100) / 100;\n  }\n\n  getPipeDensity(lineType: LineTypeConfig): number {\n    return Math.round(calculatePipeDensity(lineType));\n  }\n\n  // Line type selection\n  selectLineType(id: string): void {\n    this.selectedLineTypeId.set(this.selectedLineTypeId() === id ? null : id);\n    this.selectedBuoyancyId.set(null);\n  }\n\n  selectBuoyancy(id: string): void {\n    this.selectedBuoyancyId.set(this.selectedBuoyancyId() === id ? null : id);\n    this.selectedLineTypeId.set(null);\n  }\n\n  // Line type updates\n  updateLineType(lineType: LineTypeConfig, field: keyof LineTypeConfig, value: any): void {\n    this.modelState.updateLineType({ ...lineType, [field]: value });\n  }\n\n  updateDryMass(lineType: LineTypeConfig, dryMass: number): void {\n    this.modelState.updateLineType({ ...lineType, dryMass });\n  }\n\n  updateWetMass(lineType: LineTypeConfig, wetMass: number): void {\n    const waterDensity = this.modelState.environment().sea.waterDensity;\n    const dryMass = calculateDryMass(wetMass, lineType.outerDiameter, waterDensity);\n    this.modelState.updateLineType({ ...lineType, dryMass });\n  }\n\n  updatePipeDensity(lineType: LineTypeConfig, density: number): void {\n    const dryMass = calculateDryMassFromDensity(\n      density,\n      lineType.outerDiameter,\n      lineType.innerDiameter\n    );\n    this.modelState.updateLineType({ ...lineType, dryMass, pipeDensity: density });\n  }\n\n  updateDragCoeff(lineType: LineTypeConfig, axis: 'normal' | 'axial', value: number): void {\n    this.modelState.updateLineType({\n      ...lineType,\n      dragCoefficients: { ...lineType.dragCoefficients, [axis]: value },\n    });\n  }\n\n  deleteLineType(id: string): void {\n    this.modelState.deleteLineType(id);\n  }\n\n  startAddLineType(): void {\n    this.addingLineType.set(true);\n    this.newLineType = this.getDefaultNewLineType();\n    this.newLineTypeODmm = 355.6;\n    this.newLineTypeIDmm = 254;\n  }\n\n  saveNewLineType(): void {\n    if (!this.newLineType.name) return;\n\n    const lineType: LineTypeConfig = {\n      id: crypto.randomUUID(),\n      name: this.newLineType.name || 'New Line Type',\n      outerDiameter: this.newLineTypeODmm / 1000,\n      innerDiameter: this.newLineTypeIDmm / 1000,\n      dryMass: this.newLineType.dryMass || 184.23,\n      bendingStiffness: 124.87,\n      axialStiffness: 711200,\n      torsionalStiffness: 10,\n      poissonRatio: 0.5,\n      allowableTension: 5000,\n      minBendRadius: 3.675,\n      dragCoefficients: { normal: 1.2, axial: 0.008 },\n      addedMassCoefficients: { normal: 1.0, axial: 0.0 },\n    };\n    this.modelState.addLineType(lineType);\n    this.addingLineType.set(false);\n  }\n\n  cancelAddLineType(): void {\n    this.addingLineType.set(false);\n  }\n\n  // Buoyancy CRUD\n  updateBuoyancy(buoyancy: BuoyancyModuleConfig, field: keyof BuoyancyModuleConfig, value: any): void {\n    this.modelState.updateBuoyancyModule({ ...buoyancy, [field]: value });\n  }\n\n  deleteBuoyancy(buoyancyId: string): void {\n    this.modelState.deleteBuoyancyModule(buoyancyId);\n  }\n\n  // Buoyancy calculation helpers\n  getModuleBuoyancy(buoyancy: BuoyancyModuleConfig): number {\n    return Math.round(calculateModuleBuoyancy(buoyancy));\n  }\n\n  getSectionLength(buoyancy: BuoyancyModuleConfig): number {\n    return Math.round(calculateBuoyancySectionLength(buoyancy) * 10) / 10;\n  }\n\n  getBuoyancyPerMeter(buoyancy: BuoyancyModuleConfig): number {\n    return Math.round(calculateBuoyancyWeightPerMeter(buoyancy));\n  }\n\n  startAddBuoyancy(): void {\n    this.addingBuoyancy.set(true);\n    this.newBuoyancy = this.getDefaultNewBuoyancy();\n    this.newBuoyancyODmm = 1450;\n    this.newBuoyancyLengthmm = 1600;\n  }\n\n  saveNewBuoyancy(): void {\n    if (!this.newBuoyancy.name) return;\n\n    const buoyancy: BuoyancyModuleConfig = {\n      id: crypto.randomUUID(),\n      name: this.newBuoyancy.name || 'New Buoyancy',\n      outerDiameter: this.newBuoyancyODmm / 1000,\n      length: this.newBuoyancyLengthmm / 1000,\n      dryMass: 855.7,\n      apparentMassInWater: -1220,\n      dragCoefficient: 0.8,\n      numberOfModules: this.newBuoyancy.numberOfModules || 6,\n      spacing: this.newBuoyancy.spacing || 12,\n    };\n    this.modelState.addBuoyancyModule(buoyancy);\n    this.addingBuoyancy.set(false);\n  }\n\n  cancelAddBuoyancy(): void {\n    this.addingBuoyancy.set(false);\n  }\n\n  private getDefaultNewLineType(): Partial<LineTypeConfig> {\n    return {\n      name: '',\n      outerDiameter: 0.3556,\n      innerDiameter: 0.254,\n      dryMass: 184.23,\n    };\n  }\n\n  private getDefaultNewBuoyancy(): Partial<BuoyancyModuleConfig> {\n    return {\n      name: '',\n      outerDiameter: 1.45,\n      length: 1.6,\n      numberOfModules: 6,\n      spacing: 12,\n    };\n  }\n\n  // Import handlers\n  handleLineTypesImport(lineTypes: LineTypeConfig[]): void {\n    for (const lineType of lineTypes) {\n      this.modelState.addLineType(lineType);\n    }\n    this.modelState.addLog('success', `Imported ${lineTypes.length} line type(s)`);\n  }\n\n  handleBuoyancyModulesImport(modules: BuoyancyModuleConfig[]): void {\n    for (const module of modules) {\n      this.modelState.addBuoyancyModule(module);\n    }\n    this.modelState.addLog('success', `Imported ${modules.length} buoyancy module(s)`);\n  }\n}\n","import { Component, EventEmitter, Input, Output, signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { DialogModule } from 'primeng/dialog';\nimport { TableModule } from 'primeng/table';\nimport { ButtonModule } from 'primeng/button';\nimport { InputTextModule } from 'primeng/inputtext';\nimport { BuoyancyModuleConfig } from '../../types';\n\ninterface BuoyancyModuleRow {\n  name: string;\n  outerDiameter: number;      // mm\n  length: number;             // mm\n  dryMass: number;            // kg\n  apparentMassInWater: number; // kg\n  numberOfModules: number;\n  spacing: number;            // m\n}\n\n@Component({\n  selector: 'orcaflex-buoyancy-modules-import-dialog',\n  standalone: true,\n  imports: [\n    CommonModule,\n    FormsModule,\n    DialogModule,\n    TableModule,\n    ButtonModule,\n    InputTextModule,\n  ],\n  template: `\n    <p-dialog\n      header=\"Import Buoyancy Modules\"\n      [visible]=\"visible\"\n      [modal]=\"true\"\n      [closable]=\"true\"\n      [draggable]=\"false\"\n      [resizable]=\"false\"\n      [style]=\"{ width: '900px' }\"\n      styleClass=\"import-dialog\"\n      (onHide)=\"onCancel()\"\n    >\n      <div class=\"dialog-content\">\n        <div class=\"paste-instructions\">\n          <p>Paste data from Excel with columns: <strong>Name, OD (mm), Length (mm), Mass in Air (kg), Apparent Mass (kg), Count, Spacing (m)</strong></p>\n          <p class=\"hint\">Click in the table and press Ctrl+V (Cmd+V on Mac) to paste. Apparent mass is negative for buoyant modules.</p>\n        </div>\n\n        <div\n          class=\"table-container\"\n          tabindex=\"0\"\n          (paste)=\"handlePaste($event)\"\n          (keydown)=\"handleKeydown($event)\"\n        >\n          <p-table [value]=\"rows()\" [tableStyle]=\"{ 'min-width': '100%' }\" [scrollable]=\"true\" scrollHeight=\"300px\">\n            <ng-template pTemplate=\"header\">\n              <tr>\n                <th style=\"width: 16%\">Name</th>\n                <th style=\"width: 12%\">OD (mm)</th>\n                <th style=\"width: 12%\">Length (mm)</th>\n                <th style=\"width: 14%\">Mass Air (kg)</th>\n                <th style=\"width: 14%\">Apparent (kg)</th>\n                <th style=\"width: 10%\">Count</th>\n                <th style=\"width: 12%\">Spacing (m)</th>\n              </tr>\n            </ng-template>\n            <ng-template pTemplate=\"body\" let-row let-rowIndex=\"rowIndex\">\n              <tr>\n                <td>\n                  <input\n                    type=\"text\"\n                    pInputText\n                    [(ngModel)]=\"row.name\"\n                    placeholder=\"Name\"\n                    class=\"table-input\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.outerDiameter\"\n                    placeholder=\"1450\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.length\"\n                    placeholder=\"1600\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.dryMass\"\n                    placeholder=\"855.7\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.apparentMassInWater\"\n                    placeholder=\"-1220\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.numberOfModules\"\n                    placeholder=\"6\"\n                    class=\"table-input coord\"\n                    min=\"1\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.spacing\"\n                    placeholder=\"12\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n              </tr>\n            </ng-template>\n            <ng-template pTemplate=\"emptymessage\">\n              <tr>\n                <td colspan=\"7\" class=\"empty-message\">\n                  Paste Excel data here or add rows manually\n                </td>\n              </tr>\n            </ng-template>\n          </p-table>\n        </div>\n\n        <div class=\"row-actions\">\n          <button class=\"action-btn add\" (click)=\"addRow()\">+ Add Row</button>\n          <button class=\"action-btn clear\" (click)=\"clearRows()\">Clear All</button>\n        </div>\n      </div>\n\n      <ng-template pTemplate=\"footer\">\n        <div class=\"dialog-footer\">\n          <button class=\"btn-secondary\" (click)=\"onCancel()\">Cancel</button>\n          <button class=\"btn-primary\" (click)=\"onImport()\" [disabled]=\"!hasValidData()\">\n            Import {{ getValidRowCount() }} Module{{ getValidRowCount() !== 1 ? 's' : '' }}\n          </button>\n        </div>\n      </ng-template>\n    </p-dialog>\n  `,\n  styles: [`\n    :host ::ng-deep .import-dialog .p-dialog {\n      background: white;\n    }\n\n    :host ::ng-deep .import-dialog .p-dialog-header {\n      background: white;\n      border-bottom: 1px solid #eee;\n      padding: 16px 20px;\n    }\n\n    :host ::ng-deep .import-dialog .p-dialog-content {\n      background: white;\n      padding: 20px;\n    }\n\n    :host ::ng-deep .import-dialog .p-dialog-footer {\n      background: white;\n      border-top: 1px solid #eee;\n      padding: 16px 20px;\n    }\n\n    :host ::ng-deep .p-dialog-mask {\n      background: rgba(0, 0, 0, 0.5);\n    }\n\n    .dialog-content {\n      padding: 0;\n    }\n\n    .paste-instructions {\n      margin-bottom: 16px;\n      padding: 12px;\n      background: #f5f5f5;\n      border-radius: 4px;\n    }\n\n    .paste-instructions p {\n      margin: 0;\n      font-size: 12px;\n      color: #333;\n    }\n\n    .paste-instructions .hint {\n      margin-top: 4px;\n      font-size: 11px;\n      color: #666;\n    }\n\n    .table-container {\n      border: 2px dashed #ddd;\n      border-radius: 4px;\n      padding: 4px;\n      outline: none;\n      transition: border-color 0.2s;\n      background: white;\n    }\n\n    .table-container:focus {\n      border-color: #1976d2;\n    }\n\n    :host ::ng-deep .p-datatable {\n      background: white;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-thead > tr > th {\n      background: #fafafa;\n      font-size: 10px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: #666;\n      padding: 8px 4px;\n      border: none;\n      border-bottom: 1px solid #eee;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-tbody > tr {\n      background: white;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-tbody > tr > td {\n      padding: 4px 2px;\n      border: none;\n      border-bottom: 1px solid #f0f0f0;\n      background: white;\n    }\n\n    .table-input {\n      width: 100%;\n      padding: 6px 4px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      font-size: 11px;\n      background: white;\n    }\n\n    .table-input:focus {\n      outline: none;\n      border-color: #1976d2;\n    }\n\n    .table-input.coord {\n      text-align: right;\n    }\n\n    .empty-message {\n      text-align: center;\n      padding: 24px;\n      color: #999;\n      font-style: italic;\n      background: white;\n    }\n\n    .row-actions {\n      display: flex;\n      gap: 8px;\n      margin-top: 12px;\n    }\n\n    .action-btn {\n      padding: 6px 12px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      background: white;\n      font-size: 11px;\n      cursor: pointer;\n    }\n\n    .action-btn:hover {\n      background: #f5f5f5;\n    }\n\n    .action-btn.add {\n      color: #1976d2;\n      border-color: #1976d2;\n    }\n\n    .action-btn.clear {\n      color: #666;\n    }\n\n    .dialog-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 8px;\n    }\n\n    .btn-secondary {\n      padding: 8px 16px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      background: white;\n      font-size: 12px;\n      cursor: pointer;\n    }\n\n    .btn-secondary:hover {\n      background: #f5f5f5;\n    }\n\n    .btn-primary {\n      padding: 8px 16px;\n      border: none;\n      border-radius: 4px;\n      background: #1976d2;\n      color: white;\n      font-size: 12px;\n      cursor: pointer;\n    }\n\n    .btn-primary:hover:not(:disabled) {\n      background: #1565c0;\n    }\n\n    .btn-primary:disabled {\n      background: #ddd;\n      cursor: not-allowed;\n    }\n  `]\n})\nexport class BuoyancyModulesImportDialogComponent {\n  @Input() visible = false;\n  @Output() visibleChange = new EventEmitter<boolean>();\n  @Output() import = new EventEmitter<BuoyancyModuleConfig[]>();\n\n  rows = signal<BuoyancyModuleRow[]>([\n    { name: '', outerDiameter: 1450, length: 1600, dryMass: 855.7, apparentMassInWater: -1220, numberOfModules: 6, spacing: 12 }\n  ]);\n\n  handlePaste(event: ClipboardEvent): void {\n    event.preventDefault();\n    const clipboardData = event.clipboardData;\n    if (!clipboardData) return;\n\n    const text = clipboardData.getData('text');\n    if (!text) return;\n\n    const parsedRows = this.parseExcelData(text);\n    if (parsedRows.length > 0) {\n      this.rows.set(parsedRows);\n    }\n  }\n\n  handleKeydown(event: KeyboardEvent): void {\n    if ((event.ctrlKey || event.metaKey) && event.key === 'v') {\n      return;\n    }\n  }\n\n  parseExcelData(text: string): BuoyancyModuleRow[] {\n    const rows: BuoyancyModuleRow[] = [];\n    const lines = text.trim().split('\\n');\n\n    for (const line of lines) {\n      const cells = line.split(/\\t|(?:  +)/);\n\n      if (cells.length >= 1 && cells[0]?.trim()) {\n        rows.push({\n          name: cells[0]?.trim() || '',\n          outerDiameter: parseFloat(cells[1]) || 1450,\n          length: parseFloat(cells[2]) || 1600,\n          dryMass: parseFloat(cells[3]) || 855.7,\n          apparentMassInWater: parseFloat(cells[4]) || -1220,\n          numberOfModules: parseInt(cells[5]) || 6,\n          spacing: parseFloat(cells[6]) || 12,\n        });\n      }\n    }\n\n    return rows;\n  }\n\n  addRow(): void {\n    const currentRows = this.rows();\n    this.rows.set([\n      ...currentRows,\n      { name: '', outerDiameter: 1450, length: 1600, dryMass: 855.7, apparentMassInWater: -1220, numberOfModules: 6, spacing: 12 }\n    ]);\n  }\n\n  clearRows(): void {\n    this.rows.set([{ name: '', outerDiameter: 1450, length: 1600, dryMass: 855.7, apparentMassInWater: -1220, numberOfModules: 6, spacing: 12 }]);\n  }\n\n  hasValidData(): boolean {\n    return this.rows().some(row => row.name.trim() !== '');\n  }\n\n  getValidRowCount(): number {\n    return this.rows().filter(row => row.name.trim() !== '').length;\n  }\n\n  onImport(): void {\n    const validRows = this.rows().filter(row => row.name.trim() !== '');\n\n    const modules: BuoyancyModuleConfig[] = validRows.map(row => ({\n      id: crypto.randomUUID(),\n      name: row.name.trim(),\n      outerDiameter: row.outerDiameter / 1000,  // mm to m\n      length: row.length / 1000,                // mm to m\n      dryMass: row.dryMass,\n      apparentMassInWater: row.apparentMassInWater,\n      dragCoefficient: 0.8,\n      numberOfModules: row.numberOfModules,\n      spacing: row.spacing,\n    }));\n\n    this.import.emit(modules);\n    this.close();\n  }\n\n  onCancel(): void {\n    this.close();\n  }\n\n  private close(): void {\n    this.visible = false;\n    this.visibleChange.emit(false);\n    this.rows.set([{ name: '', outerDiameter: 1450, length: 1600, dryMass: 855.7, apparentMassInWater: -1220, numberOfModules: 6, spacing: 12 }]);\n  }\n}\n","/**\n * Grid helper creator\n */\n\nimport * as THREE from 'three';\nimport { COLORS } from '../config';\n\nexport interface GridOptions {\n  size?: number;\n  divisions?: number;\n  colorCenter?: number;\n  colorGrid?: number;\n}\n\n/**\n * Create a grid on the XY plane (water surface)\n */\nexport function createGrid(options: GridOptions = {}): THREE.GridHelper {\n  const {\n    size = 1000,\n    divisions = 20,\n    colorCenter = COLORS.grid,\n    colorGrid = 0xcccccc,\n  } = options;\n\n  const grid = new THREE.GridHelper(size, divisions, colorCenter, colorGrid);\n  // Rotate to lie on XY plane (water surface)\n  grid.rotation.x = Math.PI / 2;\n  grid.position.set(0, 0, 0);\n\n  return grid;\n}\n\n/**\n * Create axis arrows for coordinate system visualization\n */\nexport function createAxisArrows(\n  length: number = 20,\n  position: { x: number; y: number; z: number } = { x: 0, y: 0, z: 0 }\n): THREE.Group {\n  const group = new THREE.Group();\n  group.name = 'AxisArrows';\n\n  const headLength = length * 0.2;\n  const headWidth = length * 0.1;\n\n  // X axis (red)\n  const xArrow = new THREE.ArrowHelper(\n    new THREE.Vector3(1, 0, 0),\n    new THREE.Vector3(0, 0, 0),\n    length,\n    0xff0000,\n    headLength,\n    headWidth\n  );\n  group.add(xArrow);\n\n  // Y axis (green)\n  const yArrow = new THREE.ArrowHelper(\n    new THREE.Vector3(0, 1, 0),\n    new THREE.Vector3(0, 0, 0),\n    length,\n    0x00ff00,\n    headLength,\n    headWidth\n  );\n  group.add(yArrow);\n\n  // Z axis (blue)\n  const zArrow = new THREE.ArrowHelper(\n    new THREE.Vector3(0, 0, 1),\n    new THREE.Vector3(0, 0, 0),\n    length,\n    0x0000ff,\n    headLength,\n    headWidth\n  );\n  group.add(zArrow);\n\n  group.position.set(position.x, position.y, position.z);\n\n  return group;\n}\n","import { Component, inject, OnInit, OnDestroy } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ModelStateService } from '../services/model-state.service';\nimport { OrcaFlexApiService } from '../services/orcaflex-api.service';\nimport {\n  EnvironmentSectionComponent,\n  VesselSectionComponent,\n  LineTypesSectionComponent,\n  RisersSectionComponent,\n  ResultsSectionComponent,\n  LogsSectionComponent,\n} from '../sidebar';\nimport { ThreeViewComponent } from './three-view';\nimport { GenerateOrcaflexDialogComponent } from './generate-orcaflex-dialog/generate-orcaflex-dialog.component';\nimport { RiserConfig, CatenaryRequest, LazyWaveRequest, calculateEffectiveWeight, calculateBuoyancyWeightPerMeter } from '../types';\n\n@Component({\n  selector: 'orcaflex-riser-module',\n  standalone: true,\n  imports: [\n    CommonModule,\n    EnvironmentSectionComponent,\n    VesselSectionComponent,\n    LineTypesSectionComponent,\n    RisersSectionComponent,\n    ResultsSectionComponent,\n    LogsSectionComponent,\n    ThreeViewComponent,\n    GenerateOrcaflexDialogComponent,\n  ],\n  template: `\n    <div class=\"orcaflex-workspace\">\n      <!-- Left Sidebar -->\n      <aside class=\"sidebar left\">\n        <div class=\"sidebar-section\">\n          <div class=\"section-header\" (click)=\"toggleSection('environment')\">\n            <span class=\"section-title\">Environment</span>\n            <span class=\"toggle-icon\">{{ expandedSections.environment ? '' : '+' }}</span>\n          </div>\n          @if (expandedSections.environment) {\n            <orcaflex-environment-section />\n          }\n        </div>\n\n        <div class=\"sidebar-section\">\n          <div class=\"section-header\" (click)=\"toggleSection('vessel')\">\n            <span class=\"section-title\">Vessel</span>\n            <span class=\"toggle-icon\">{{ expandedSections.vessel ? '' : '+' }}</span>\n          </div>\n          @if (expandedSections.vessel) {\n            <orcaflex-vessel-section />\n          }\n        </div>\n\n        <div class=\"sidebar-section\">\n          <div class=\"section-header\" (click)=\"toggleSection('lineTypes')\">\n            <span class=\"section-title\">Line Types</span>\n            <span class=\"toggle-icon\">{{ expandedSections.lineTypes ? '' : '+' }}</span>\n          </div>\n          @if (expandedSections.lineTypes) {\n            <orcaflex-line-types-section />\n          }\n        </div>\n      </aside>\n\n      <!-- Main Content - 3D View -->\n      <main class=\"main-content\">\n        <div class=\"view-container\">\n          <orcaflex-three-view />\n        </div>\n\n        <!-- Status bar -->\n        <div class=\"status-bar\">\n          <div class=\"status-left\">\n            <span class=\"status-item\">\n              Water Depth: {{ modelState.environment().sea.waterDepth }}m\n            </span>\n            <span class=\"status-item\">\n              Risers: {{ modelState.riserCount() }}\n            </span>\n            @if (modelState.isCalculating()) {\n              <span class=\"status-item calculating\">\n                Calculating...\n              </span>\n            }\n            @if (modelState.isDirty()) {\n              <span class=\"status-item modified\">\n                Modified\n              </span>\n            }\n          </div>\n          <div class=\"status-right\">\n            <button class=\"generate-btn\" (click)=\"showGenerateDialog = true\">\n              Generate OrcaFlex Models\n            </button>\n          </div>\n        </div>\n      </main>\n\n      <!-- Right Sidebar -->\n      <aside class=\"sidebar right\">\n        <div class=\"sidebar-section\">\n          <div class=\"section-header\" (click)=\"toggleSection('risers')\">\n            <span class=\"section-title\">Risers</span>\n            <span class=\"toggle-icon\">{{ expandedSections.risers ? '' : '+' }}</span>\n          </div>\n          @if (expandedSections.risers) {\n            <orcaflex-risers-section (onCalculateRequest)=\"calculateRiser($event)\" />\n          }\n        </div>\n\n        <div class=\"sidebar-section\">\n          <div class=\"section-header\" (click)=\"toggleSection('results')\">\n            <span class=\"section-title\">Results</span>\n            <span class=\"toggle-icon\">{{ expandedSections.results ? '' : '+' }}</span>\n          </div>\n          @if (expandedSections.results) {\n            <orcaflex-results-section />\n          }\n        </div>\n\n        <div class=\"sidebar-section\">\n          <div class=\"section-header\" (click)=\"toggleSection('logs')\">\n            <span class=\"section-title\">Logs</span>\n            <span class=\"toggle-icon\">{{ expandedSections.logs ? '' : '+' }}</span>\n          </div>\n          @if (expandedSections.logs) {\n            <orcaflex-logs-section />\n          }\n        </div>\n      </aside>\n\n      <!-- Generate OrcaFlex Dialog -->\n      <orcaflex-generate-dialog\n        [(visible)]=\"showGenerateDialog\"\n      />\n    </div>\n  `,\n  styles: [`\n    :host {\n      display: block;\n      width: 100%;\n      height: 100%;\n    }\n\n    .orcaflex-workspace {\n      display: flex;\n      height: 100%;\n      background: var(--caris-bg-workspace, #f5f5f5);\n    }\n\n    .sidebar {\n      width: 280px;\n      background: var(--caris-bg-sidebar, #fff);\n      border-right: 1px solid var(--caris-border-light, #e0e0e0);\n      overflow-y: auto;\n      flex-shrink: 0;\n    }\n\n    .sidebar.right {\n      border-right: none;\n      border-left: 1px solid var(--caris-border-light, #e0e0e0);\n    }\n\n    .sidebar-section {\n      border-bottom: 1px solid var(--caris-border-light, #e0e0e0);\n    }\n\n    .section-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 12px 16px;\n      background: var(--caris-bg-section-header, #fafafa);\n      cursor: pointer;\n      user-select: none;\n    }\n\n    .section-header:hover {\n      background: var(--caris-bg-hover, #f0f0f0);\n    }\n\n    .section-title {\n      font-size: 12px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .toggle-icon {\n      color: var(--caris-text-tertiary, #999);\n      font-weight: bold;\n    }\n\n    .main-content {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      min-width: 0;\n    }\n\n    .view-container {\n      flex: 1;\n      position: relative;\n    }\n\n    .status-bar {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 8px 16px;\n      background: var(--caris-bg-statusbar, #263238);\n      color: var(--caris-text-statusbar, #b0bec5);\n      font-size: 11px;\n    }\n\n    .status-left {\n      display: flex;\n      gap: 16px;\n    }\n\n    .status-right {\n      display: flex;\n      gap: 8px;\n    }\n\n    .status-item {\n      display: flex;\n      align-items: center;\n      gap: 4px;\n    }\n\n    .status-item.calculating {\n      color: var(--caris-warning, #ffc107);\n    }\n\n    .status-item.modified {\n      color: var(--caris-accent, #ff9800);\n    }\n\n    .generate-btn {\n      padding: 6px 14px;\n      border: none;\n      border-radius: 4px;\n      background: #4caf50;\n      color: white;\n      font-size: 11px;\n      font-weight: 500;\n      cursor: pointer;\n      transition: background 0.2s;\n    }\n\n    .generate-btn:hover {\n      background: #43a047;\n    }\n  `]\n})\nexport class OrcaFlexRiserComponent implements OnInit, OnDestroy {\n  modelState = inject(ModelStateService);\n  private apiService = inject(OrcaFlexApiService);\n\n  showGenerateDialog = false;\n\n  expandedSections: Record<string, boolean> = {\n    environment: true,\n    vessel: true,\n    lineTypes: false,\n    risers: true,\n    results: true,\n    logs: false,\n  };\n\n  ngOnInit(): void {\n    this.modelState.addLog('info', 'OrcaFlex Riser Module initialized');\n  }\n\n  ngOnDestroy(): void {\n    // Cleanup will be handled here\n  }\n\n  toggleSection(section: string): void {\n    this.expandedSections[section] = !this.expandedSections[section];\n  }\n\n  async calculateRiser(riser: RiserConfig): Promise<void> {\n    console.log('calculateRiser called', riser);\n    this.modelState.setCalculating(true);\n    this.modelState.addLog('info', `Calculating riser \"${riser.name}\"...`);\n\n    try {\n      if (riser.geometry.type === 'catenary') {\n        const lineType = this.modelState.lineTypes().find(lt => lt.id === riser.lineTypeId);\n        if (!lineType) {\n          throw new Error('Line type not found');\n        }\n\n        const env = this.modelState.environment();\n        const waterDepth = env.sea.waterDepth;\n        const hangoffZ = Math.abs(riser.geometry.hangoffPoint.z);\n        const height = waterDepth - hangoffZ;\n\n        // Get active content density for wet weight calculation\n        const activeContent = riser.contents?.find(c => c.id === riser.activeContentId);\n        const contentDensity = activeContent?.density ?? 0;\n\n        // Calculate effective weight (wet weight with content)\n        const effectiveWeight = calculateEffectiveWeight(lineType, contentDensity, env.sea.waterDensity);\n\n        // Send snake_case field names to backend\n        const request = {\n          method: 'point_angle',\n          weight: effectiveWeight,  // Wet weight with content (N/m)\n          height: height,\n          departure_angle: riser.geometry.departureAngle,\n          num_points: 100,\n        };\n\n        const result = await this.apiService.calculateCatenary(request as CatenaryRequest);\n\n        // Map snake_case backend response to frontend model\n        const apiResult = result as any;\n        // Map API points {x, y, z} to frontend format {x, y} where y is vertical (API's z)\n        const mappedPoints = (apiResult.points || []).map((p: any) => ({\n          x: p.x,\n          y: p.z,  // API's z is vertical height\n          s: 0,\n          angle: 0,\n        }));\n        console.log('Catenary result:', apiResult);\n        console.log('Mapped points:', mappedPoints.length, mappedPoints.slice(0, 3));\n\n        this.modelState.updateRiser({\n          ...riser,\n          calculationResults: {\n            totalLength: apiResult.arc_length,\n            tdpPosition: { x: apiResult.horizontal_distance, y: 0, z: -waterDepth },\n            maxTension: apiResult.horizontal_tension / Math.cos(apiResult.end_angle_rad),\n            minTension: apiResult.horizontal_tension,\n            points: mappedPoints,\n          },\n        });\n\n        this.modelState.addLog('success', `Riser \"${riser.name}\" calculated successfully`);\n      } else if (riser.geometry.type === 'lazy-wave') {\n        const lineType = this.modelState.lineTypes().find(lt => lt.id === riser.lineTypeId);\n        const buoyancyModule = this.modelState.model().buoyancyModules.find(\n          bm => bm.id === riser.buoyancyModuleId\n        );\n\n        if (!lineType) {\n          throw new Error('Line type not found');\n        }\n\n        const env = this.modelState.environment();\n        const geom = riser.geometry;\n\n        // Get connection point z to calculate effective water depth\n        const vessel = this.modelState.vessels().find(v => v.id === riser.vesselId);\n        const connectionPoint = vessel?.connectionPoints.find(cp => cp.id === riser.connectionPointId);\n        const hangoffZ = Math.abs(connectionPoint?.z ?? 0);\n        const effectiveWaterDepth = env.sea.waterDepth - hangoffZ;\n\n        // Get active content density for wet weight calculation\n        const activeContent = riser.contents?.find(c => c.id === riser.activeContentId);\n        const contentDensity = activeContent?.density ?? 0;\n\n        // Calculate effective weight (wet weight with content)\n        const effectiveWeight = calculateEffectiveWeight(lineType, contentDensity, env.sea.waterDensity);\n\n        // Calculate buoyancy weight per meter from module configuration\n        const buoyancyWeightPerMeter = buoyancyModule\n          ? calculateBuoyancyWeightPerMeter(buoyancyModule)\n          : 0;\n\n        // Send snake_case field names to backend\n        const request = {\n          water_depth: effectiveWaterDepth,\n          line_weight: effectiveWeight,  // Wet weight with content (N/m)\n          buoyancy_weight: buoyancyWeightPerMeter,  // Buoyancy per meter (N/m)\n          sag: geom.sagBend,\n          hog: geom.hogBend,\n          departure_angle: geom.departureAngle,\n        };\n\n        console.log('Lazy wave request:', request);\n        const result = await this.apiService.calculateLazyWave(request as unknown as LazyWaveRequest);\n\n        // Map snake_case backend response to frontend model\n        const apiResult = result as any;\n        console.log('Lazy wave API result:', apiResult);\n        console.log('Lazy wave points count:', apiResult.points?.length || 0);\n\n        // Extract buoyancy section info from API result\n        const buoyancySectionStart = apiResult.buoyancy_section_start || apiResult.results?.buoyancy_section_start;\n        const buoyancySectionEnd = apiResult.buoyancy_section_end || apiResult.results?.buoyancy_section_end;\n\n        this.modelState.updateRiser({\n          ...riser,\n          calculationResults: {\n            totalLength: apiResult.tdp_length || 500,\n            tdpPosition: { x: apiResult.tdp_horizontal_distance || 200, y: 0, z: -env.sea.waterDepth },\n            maxTension: apiResult.horizontal_tension || 50000,\n            minTension: (apiResult.horizontal_tension || 50000) * 0.3,\n            sagBendRadius: 100,\n            hogBendRadius: 100,\n            points: apiResult.points || [],\n            buoyancyStart: buoyancySectionStart,\n            buoyancyEnd: buoyancySectionEnd,\n          },\n        });\n\n        this.modelState.addLog('success', `Lazy wave riser \"${riser.name}\" calculated with ${apiResult.points?.length || 0} points`);\n      }\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.modelState.addLog('error', `Calculation failed: ${message}`);\n    } finally {\n      this.modelState.setCalculating(false);\n    }\n  }\n}\n","import { Component, inject, Output, EventEmitter } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { ModelStateService } from '../../services/model-state.service';\nimport {\n  RiserConfig,\n  RiserType,\n  CatenaryConfig,\n  LazyWaveConfig,\n  ConnectionPoint,\n  ContentConfig,\n  DEFAULT_CONTENTS,\n} from '../../types';\n\n// Predefined colors for contents\nconst CONTENT_COLORS = [\n  0x4a90d9, // Blue (empty/air)\n  0x2e7d32, // Green (seawater)\n  0x8b4513, // Brown (oil)\n  0xf57c00, // Orange\n  0x9c27b0, // Purple\n  0x00bcd4, // Cyan\n];\n\n@Component({\n  selector: 'orcaflex-risers-section',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  template: `\n    <div class=\"section-content\">\n      <div class=\"toolbar\">\n        <button class=\"add-btn\" (click)=\"addRiser()\">\n          <span class=\"icon\">+</span> Add Riser\n        </button>\n      </div>\n\n      @for (riser of risers(); track riser.id) {\n        <div\n          class=\"riser-item\"\n          [class.selected]=\"selectedRiserId() === riser.id\"\n        >\n          <div class=\"riser-header\" (click)=\"selectRiser(riser.id)\">\n            <span class=\"riser-name\">{{ riser.name }}</span>\n            <div class=\"header-right\">\n              <span class=\"riser-type\" [class.catenary]=\"riser.geometry.type === 'catenary'\"\n                [class.lazy-wave]=\"riser.geometry.type === 'lazy-wave'\">\n                {{ riser.geometry.type }}\n              </span>\n              <button class=\"delete-btn\" (click)=\"deleteRiser(riser.id); $event.stopPropagation()\"></button>\n            </div>\n          </div>\n\n          <div class=\"riser-info\">\n            <span class=\"info-item\">\n              {{ riser.geometry.departureAngle }} | {{ riser.geometry.azimuth }}\n            </span>\n            @if (riser.calculationResults) {\n              <span class=\"info-item calculated\">\n                {{ riser.calculationResults.totalLength | number:'1.0-0' }}m\n              </span>\n            } @else {\n              <span class=\"info-item pending\">Not calculated</span>\n            }\n          </div>\n\n          @if (selectedRiserId() === riser.id) {\n            <div class=\"riser-editor\" (click)=\"$event.stopPropagation()\">\n              <!-- Basic Info -->\n              <div class=\"form-group\">\n                <label>Name</label>\n                <input type=\"text\" [ngModel]=\"riser.name\"\n                  (ngModelChange)=\"updateRiserName(riser, $event)\" />\n              </div>\n\n              <!-- Connection -->\n              <div class=\"subsection-title\">Connection</div>\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Vessel</label>\n                  <select [ngModel]=\"riser.vesselId\"\n                    (ngModelChange)=\"updateRiserVessel(riser, $event)\">\n                    @for (vessel of vessels(); track vessel.id) {\n                      <option [value]=\"vessel.id\">{{ vessel.name }}</option>\n                    }\n                  </select>\n                </div>\n                <div class=\"form-group half\">\n                  <label>Connection Point</label>\n                  <select [ngModel]=\"riser.connectionPointId\"\n                    (ngModelChange)=\"updateRiserConnectionPoint(riser, $event)\">\n                    @for (cp of getConnectionPoints(riser.vesselId); track cp.id) {\n                      <option [value]=\"cp.id\">{{ cp.name }}</option>\n                    }\n                  </select>\n                </div>\n              </div>\n\n              <!-- Line Type -->\n              <div class=\"form-group\">\n                <label>Line Type</label>\n                <select [ngModel]=\"riser.lineTypeId\"\n                  (ngModelChange)=\"updateRiserLineType(riser, $event)\">\n                  @for (lt of lineTypes(); track lt.id) {\n                    <option [value]=\"lt.id\">{{ lt.name }}</option>\n                  }\n                </select>\n              </div>\n\n              <!-- Contents Section -->\n              <div class=\"subsection-title\">Contents</div>\n              <div class=\"contents-list\">\n                @for (content of riser.contents; track content.id; let i = $index) {\n                  <div class=\"content-item\" [class.active]=\"riser.activeContentId === content.id\">\n                    <div class=\"content-color\" [style.background-color]=\"getColorHex(content.color)\"></div>\n                    <div class=\"content-info\">\n                      <input type=\"text\" class=\"content-name\" [ngModel]=\"content.name\"\n                        (ngModelChange)=\"updateContentName(riser, content.id, $event)\" />\n                      <div class=\"content-density\">\n                        <input type=\"number\" [ngModel]=\"content.density\"\n                          (ngModelChange)=\"updateContentDensity(riser, content.id, $event)\"\n                          step=\"1\" min=\"0\" />\n                        <span class=\"unit\">kg/m</span>\n                      </div>\n                    </div>\n                    <div class=\"content-actions\">\n                      <button class=\"select-btn\"\n                        [class.selected]=\"riser.activeContentId === content.id\"\n                        (click)=\"selectContent(riser, content.id)\"\n                        title=\"Use for calculation\">\n                        {{ riser.activeContentId === content.id ? '' : '' }}\n                      </button>\n                      <button class=\"remove-btn\"\n                        (click)=\"removeContent(riser, content.id)\"\n                        [disabled]=\"riser.contents.length <= 1\"\n                        title=\"Remove content\"></button>\n                    </div>\n                  </div>\n                }\n                <button class=\"add-content-btn\" (click)=\"addContent(riser)\">\n                  + Add Content\n                </button>\n              </div>\n\n              <!-- Riser Type -->\n              <div class=\"subsection-title\">Geometry</div>\n              <div class=\"type-selector\">\n                <button\n                  class=\"type-btn\"\n                  [class.active]=\"riser.geometry.type === 'catenary'\"\n                  (click)=\"setRiserType(riser, 'catenary'); $event.stopPropagation()\"\n                >\n                  Catenary\n                </button>\n                <button\n                  class=\"type-btn\"\n                  [class.active]=\"riser.geometry.type === 'lazy-wave'\"\n                  (click)=\"setRiserType(riser, 'lazy-wave'); $event.stopPropagation()\"\n                >\n                  Lazy Wave\n                </button>\n              </div>\n\n              <!-- Common Geometry -->\n              <div class=\"form-row\">\n                <div class=\"form-group half\">\n                  <label>Azimuth ()</label>\n                  <input type=\"number\" [ngModel]=\"riser.geometry.azimuth\"\n                    (ngModelChange)=\"updateGeometry(riser, 'azimuth', $event)\"\n                    min=\"0\" max=\"360\" step=\"5\" />\n                </div>\n                <div class=\"form-group half\">\n                  <label>Departure Angle ()</label>\n                  <input type=\"number\" [ngModel]=\"riser.geometry.departureAngle\"\n                    (ngModelChange)=\"updateGeometry(riser, 'departureAngle', $event)\"\n                    min=\"0\" max=\"90\" step=\"1\" />\n                </div>\n              </div>\n\n              <!-- Catenary-specific -->\n              @if (riser.geometry.type === 'catenary') {\n                <div class=\"form-group\">\n                  <label>Layback (m) - optional</label>\n                  <input type=\"number\" [ngModel]=\"asCatenary(riser.geometry).layback\"\n                    (ngModelChange)=\"updateGeometry(riser, 'layback', $event)\"\n                    min=\"0\" step=\"10\" />\n                </div>\n              }\n\n              <!-- Lazy Wave-specific -->\n              @if (riser.geometry.type === 'lazy-wave') {\n                <div class=\"form-row\">\n                  <div class=\"form-group half\">\n                    <label>Sag Bend (m)</label>\n                    <input type=\"number\" [ngModel]=\"asLazyWave(riser.geometry).sagBend\"\n                      (ngModelChange)=\"updateGeometry(riser, 'sagBend', $event)\"\n                      min=\"0\" step=\"1\" />\n                  </div>\n                  <div class=\"form-group half\">\n                    <label>Hog Bend (m)</label>\n                    <input type=\"number\" [ngModel]=\"asLazyWave(riser.geometry).hogBend\"\n                      (ngModelChange)=\"updateGeometry(riser, 'hogBend', $event)\"\n                      min=\"0\" step=\"1\" />\n                  </div>\n                </div>\n\n                <div class=\"form-group\">\n                  <label>Buoyancy Module</label>\n                  <select [ngModel]=\"riser.buoyancyModuleId\"\n                    (ngModelChange)=\"updateRiserBuoyancy(riser, $event)\">\n                    <option [value]=\"undefined\">None</option>\n                    @for (bm of buoyancyModules(); track bm.id) {\n                      <option [value]=\"bm.id\">{{ bm.name }}</option>\n                    }\n                  </select>\n                </div>\n              }\n\n              <!-- Results Summary -->\n              @if (riser.calculationResults) {\n                <div class=\"results-summary\">\n                  <div class=\"result-row\">\n                    <span class=\"label\">Total Length:</span>\n                    <span class=\"value\">{{ riser.calculationResults.totalLength | number:'1.1-1' }} m</span>\n                  </div>\n                  <div class=\"result-row\">\n                    <span class=\"label\">TDP Position:</span>\n                    <span class=\"value\">\n                      ({{ riser.calculationResults.tdpPosition.x | number:'1.0-0' }},\n                       {{ riser.calculationResults.tdpPosition.y | number:'1.0-0' }})\n                    </span>\n                  </div>\n                  <div class=\"result-row\">\n                    <span class=\"label\">Max Tension:</span>\n                    <span class=\"value\">{{ riser.calculationResults.maxTension | number:'1.0-0' }} N</span>\n                  </div>\n                </div>\n              }\n\n              <!-- Actions -->\n              <div class=\"riser-actions\">\n                <button class=\"action-btn primary\" (click)=\"calculateRiser(riser); $event.stopPropagation()\">\n                  Calculate\n                </button>\n              </div>\n            </div>\n          }\n        </div>\n      }\n\n      @if (risers().length === 0) {\n        <div class=\"empty-state\">\n          <p>No risers defined</p>\n          <p class=\"hint\">Click \"Add Riser\" to create one</p>\n        </div>\n      }\n    </div>\n  `,\n  styles: [`\n    .section-content {\n      padding: 8px;\n    }\n\n    .toolbar {\n      margin-bottom: 12px;\n    }\n\n    .add-btn {\n      width: 100%;\n      padding: 8px 12px;\n      background: var(--caris-primary, #1976d2);\n      color: white;\n      border: none;\n      border-radius: 4px;\n      font-size: 12px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 6px;\n    }\n\n    .add-btn:hover {\n      background: var(--caris-primary-dark, #1565c0);\n    }\n\n    .icon {\n      font-weight: bold;\n    }\n\n    .riser-item {\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      margin-bottom: 8px;\n      transition: all 0.2s;\n      overflow: hidden;\n    }\n\n    .riser-item:hover {\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .riser-item.selected {\n      border-color: var(--caris-primary, #1976d2);\n      background: var(--caris-bg-selected, #e3f2fd);\n    }\n\n    .riser-header {\n      padding: 8px 12px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      cursor: pointer;\n    }\n\n    .riser-header:hover {\n      background: rgba(0, 0, 0, 0.02);\n    }\n\n    .header-right {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .riser-name {\n      font-weight: 500;\n      font-size: 12px;\n    }\n\n    .riser-type {\n      font-size: 9px;\n      padding: 2px 6px;\n      background: var(--caris-bg-subtle, #f0f0f0);\n      border-radius: 10px;\n      text-transform: uppercase;\n      font-weight: 600;\n    }\n\n    .riser-type.catenary {\n      background: #e3f2fd;\n      color: #1976d2;\n    }\n\n    .riser-type.lazy-wave {\n      background: #fff3e0;\n      color: #f57c00;\n    }\n\n    .delete-btn {\n      width: 18px;\n      height: 18px;\n      border: none;\n      background: transparent;\n      color: var(--caris-text-tertiary, #bbb);\n      font-size: 16px;\n      cursor: pointer;\n      border-radius: 3px;\n    }\n\n    .delete-btn:hover {\n      background: #ffebee;\n      color: var(--caris-error, #f44336);\n    }\n\n    .riser-info {\n      padding: 4px 12px 8px;\n      display: flex;\n      justify-content: space-between;\n      font-size: 11px;\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .info-item.calculated {\n      color: var(--caris-success, #4caf50);\n      font-weight: 500;\n    }\n\n    .info-item.pending {\n      color: var(--caris-text-tertiary, #999);\n      font-style: italic;\n    }\n\n    .riser-editor {\n      padding: 12px;\n      border-top: 1px solid var(--caris-border-light, #eee);\n      background: var(--caris-bg-subtle, #fafafa);\n    }\n\n    .form-group {\n      margin-bottom: 10px;\n    }\n\n    .form-group label {\n      display: block;\n      font-size: 10px;\n      color: var(--caris-text-secondary, #666);\n      margin-bottom: 2px;\n    }\n\n    .form-group input,\n    .form-group select {\n      width: 100%;\n      padding: 5px 6px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      font-size: 11px;\n      background: white;\n    }\n\n    .form-group input:focus,\n    .form-group select:focus {\n      outline: none;\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .form-row {\n      display: flex;\n      gap: 8px;\n    }\n\n    .form-group.half {\n      flex: 1;\n    }\n\n    .subsection-title {\n      font-size: 10px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: var(--caris-text-secondary, #666);\n      margin: 12px 0 8px 0;\n      padding-top: 8px;\n      border-top: 1px solid var(--caris-border-light, #eee);\n    }\n\n    /* Contents section styles */\n    .contents-list {\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n    }\n\n    .content-item {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 6px 8px;\n      background: white;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n    }\n\n    .content-item.active {\n      border-color: var(--caris-primary, #1976d2);\n      background: #e3f2fd;\n    }\n\n    .content-color {\n      width: 12px;\n      height: 24px;\n      border-radius: 2px;\n      flex-shrink: 0;\n    }\n\n    .content-info {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      gap: 2px;\n    }\n\n    .content-name {\n      border: none !important;\n      background: transparent !important;\n      padding: 2px 4px !important;\n      font-size: 11px !important;\n      font-weight: 500;\n    }\n\n    .content-name:focus {\n      background: white !important;\n      border: 1px solid var(--caris-primary, #1976d2) !important;\n    }\n\n    .content-density {\n      display: flex;\n      align-items: center;\n      gap: 4px;\n    }\n\n    .content-density input {\n      width: 60px !important;\n      padding: 2px 4px !important;\n      font-size: 10px !important;\n      text-align: right;\n    }\n\n    .content-density .unit {\n      font-size: 9px;\n      color: var(--caris-text-tertiary, #999);\n    }\n\n    .content-actions {\n      display: flex;\n      gap: 4px;\n    }\n\n    .select-btn {\n      width: 20px;\n      height: 20px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 50%;\n      background: white;\n      font-size: 10px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .select-btn.selected {\n      background: var(--caris-primary, #1976d2);\n      color: white;\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .remove-btn {\n      width: 20px;\n      height: 20px;\n      border: none;\n      background: transparent;\n      color: var(--caris-text-tertiary, #bbb);\n      font-size: 14px;\n      cursor: pointer;\n      border-radius: 3px;\n    }\n\n    .remove-btn:hover:not(:disabled) {\n      background: #ffebee;\n      color: var(--caris-error, #f44336);\n    }\n\n    .remove-btn:disabled {\n      opacity: 0.3;\n      cursor: not-allowed;\n    }\n\n    .add-content-btn {\n      padding: 6px;\n      border: 1px dashed var(--caris-border-light, #ccc);\n      border-radius: 4px;\n      background: transparent;\n      font-size: 10px;\n      color: var(--caris-text-secondary, #666);\n      cursor: pointer;\n    }\n\n    .add-content-btn:hover {\n      border-color: var(--caris-primary, #1976d2);\n      color: var(--caris-primary, #1976d2);\n    }\n\n    .type-selector {\n      display: flex;\n      gap: 4px;\n      margin-bottom: 12px;\n    }\n\n    .type-btn {\n      flex: 1;\n      padding: 6px 12px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      background: white;\n      font-size: 11px;\n      cursor: pointer;\n    }\n\n    .type-btn:hover {\n      background: var(--caris-bg-hover, #f0f0f0);\n    }\n\n    .type-btn.active {\n      background: var(--caris-primary, #1976d2);\n      color: white;\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .results-summary {\n      margin-top: 12px;\n      padding: 10px;\n      background: white;\n      border: 1px solid var(--caris-border-light, #eee);\n      border-radius: 4px;\n    }\n\n    .result-row {\n      display: flex;\n      justify-content: space-between;\n      font-size: 11px;\n      padding: 3px 0;\n    }\n\n    .result-row .label {\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .result-row .value {\n      font-weight: 500;\n      font-family: monospace;\n    }\n\n    .riser-actions {\n      margin-top: 12px;\n      display: flex;\n      gap: 8px;\n    }\n\n    .action-btn {\n      flex: 1;\n      padding: 8px 12px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      background: white;\n      font-size: 11px;\n      cursor: pointer;\n    }\n\n    .action-btn:hover {\n      background: var(--caris-bg-subtle, #f5f5f5);\n    }\n\n    .action-btn.primary {\n      background: var(--caris-primary, #1976d2);\n      color: white;\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .action-btn.primary:hover {\n      background: var(--caris-primary-dark, #1565c0);\n    }\n\n    .empty-state {\n      text-align: center;\n      padding: 24px;\n      color: var(--caris-text-secondary, #999);\n    }\n\n    .empty-state p {\n      margin: 0 0 4px 0;\n      font-size: 12px;\n    }\n\n    .empty-state .hint {\n      font-size: 11px;\n      color: var(--caris-text-tertiary, #bbb);\n    }\n  `]\n})\nexport class RisersSectionComponent {\n  private modelState = inject(ModelStateService);\n\n  risers = this.modelState.risers;\n  vessels = this.modelState.vessels;\n  lineTypes = this.modelState.lineTypes;\n  buoyancyModules = this.modelState.buoyancyModules;\n  selectedRiserId = this.modelState.selectedRiserId;\n\n  @Output() onCalculateRequest = new EventEmitter<RiserConfig>();\n\n  selectRiser(id: string): void {\n    this.modelState.selectRiser(\n      this.selectedRiserId() === id ? null : id\n    );\n  }\n\n  getConnectionPoints(vesselId: string): ConnectionPoint[] {\n    const vessel = this.vessels().find(v => v.id === vesselId);\n    return vessel?.connectionPoints ?? [];\n  }\n\n  getColorHex(color: number | undefined): string {\n    const c = color ?? 0x4a90d9;\n    return '#' + c.toString(16).padStart(6, '0');\n  }\n\n  addRiser(): void {\n    const count = this.risers().length + 1;\n    const vessel = this.vessels()[0];\n    const newRiser: RiserConfig = {\n      id: crypto.randomUUID(),\n      name: `Riser ${count}`,\n      lineTypeId: this.lineTypes()[0]?.id ?? '',\n      vesselId: vessel?.id ?? '',\n      connectionPointId: vessel?.connectionPoints[0]?.id ?? '',\n      geometry: {\n        type: 'catenary',\n        hangoffPoint: { x: 50, y: 0, z: -10 },\n        azimuth: 180,\n        departureAngle: 80,\n      },\n      contents: [...DEFAULT_CONTENTS],\n      activeContentId: 'empty',\n    };\n    this.modelState.addRiser(newRiser);\n    this.modelState.selectRiser(newRiser.id);\n  }\n\n  deleteRiser(id: string): void {\n    this.modelState.deleteRiser(id);\n  }\n\n  updateRiserName(riser: RiserConfig, name: string): void {\n    this.modelState.updateRiser({ ...riser, name });\n  }\n\n  updateRiserVessel(riser: RiserConfig, vesselId: string): void {\n    const vessel = this.vessels().find(v => v.id === vesselId);\n    const connectionPointId = vessel?.connectionPoints[0]?.id ?? '';\n    this.modelState.updateRiser({ ...riser, vesselId, connectionPointId });\n  }\n\n  updateRiserConnectionPoint(riser: RiserConfig, connectionPointId: string): void {\n    this.modelState.updateRiser({ ...riser, connectionPointId });\n  }\n\n  updateRiserLineType(riser: RiserConfig, lineTypeId: string): void {\n    this.modelState.updateRiser({ ...riser, lineTypeId });\n  }\n\n  updateRiserBuoyancy(riser: RiserConfig, buoyancyModuleId: string | undefined): void {\n    this.modelState.updateRiser({ ...riser, buoyancyModuleId });\n  }\n\n  // Content management\n  addContent(riser: RiserConfig): void {\n    const colorIndex = riser.contents.length % CONTENT_COLORS.length;\n    const newContent: ContentConfig = {\n      id: crypto.randomUUID(),\n      name: `Content ${riser.contents.length + 1}`,\n      density: 0,\n      color: CONTENT_COLORS[colorIndex],\n    };\n    this.modelState.updateRiser({\n      ...riser,\n      contents: [...riser.contents, newContent],\n    });\n  }\n\n  removeContent(riser: RiserConfig, contentId: string): void {\n    if (riser.contents.length <= 1) return;\n    const newContents = riser.contents.filter(c => c.id !== contentId);\n    const activeContentId = riser.activeContentId === contentId\n      ? newContents[0]?.id\n      : riser.activeContentId;\n    this.modelState.updateRiser({\n      ...riser,\n      contents: newContents,\n      activeContentId,\n    });\n  }\n\n  selectContent(riser: RiserConfig, contentId: string): void {\n    this.modelState.updateRiser({\n      ...riser,\n      activeContentId: contentId,\n    });\n  }\n\n  updateContentName(riser: RiserConfig, contentId: string, name: string): void {\n    const contents = riser.contents.map(c =>\n      c.id === contentId ? { ...c, name } : c\n    );\n    this.modelState.updateRiser({ ...riser, contents });\n  }\n\n  updateContentDensity(riser: RiserConfig, contentId: string, density: number): void {\n    const contents = riser.contents.map(c =>\n      c.id === contentId ? { ...c, density } : c\n    );\n    this.modelState.updateRiser({ ...riser, contents });\n  }\n\n  setRiserType(riser: RiserConfig, type: RiserType): void {\n    if (type === riser.geometry.type) return;\n\n    let geometry: RiserConfig['geometry'];\n    if (type === 'catenary') {\n      geometry = {\n        type: 'catenary',\n        hangoffPoint: riser.geometry.hangoffPoint,\n        azimuth: riser.geometry.azimuth,\n        departureAngle: riser.geometry.departureAngle,\n      };\n    } else {\n      geometry = {\n        type: 'lazy-wave',\n        hangoffPoint: riser.geometry.hangoffPoint,\n        azimuth: riser.geometry.azimuth,\n        departureAngle: riser.geometry.departureAngle,\n        sagBend: 30,\n        hogBend: 50,\n      };\n    }\n\n    this.modelState.updateRiser({\n      ...riser,\n      geometry,\n      calculationResults: undefined,\n    });\n  }\n\n  updateGeometry(riser: RiserConfig, field: string, value: number): void {\n    this.modelState.updateRiser({\n      ...riser,\n      geometry: { ...riser.geometry, [field]: value } as any,\n      calculationResults: undefined,\n    });\n  }\n\n  calculateRiser(riser: RiserConfig): void {\n    console.log('RiserSection: calculateRiser clicked, emitting', riser.name);\n    this.onCalculateRequest.emit(riser);\n  }\n\n  // Type guards for template\n  asCatenary(geometry: RiserConfig['geometry']): CatenaryConfig {\n    return geometry as CatenaryConfig;\n  }\n\n  asLazyWave(geometry: RiserConfig['geometry']): LazyWaveConfig {\n    return geometry as LazyWaveConfig;\n  }\n}\n","import * as THREE from 'three';\n\n/**\n * ViewHelper - Interactive orientation indicator based on Three.js editor ViewHelper\n * Displays an interactive 3D axes indicator that shows camera orientation\n * and allows clicking on axes to snap to standard views\n */\nexport class ViewHelper extends THREE.Object3D {\n  animating = false;\n  controls: { center: THREE.Vector3 } | null = null;\n\n  private camera: THREE.OrthographicCamera;\n  private dim = 128;\n  private turnRate = 2 * Math.PI;\n\n  private interactiveObjects: THREE.Sprite[] = [];\n  private raycaster = new THREE.Raycaster();\n  private mouse = new THREE.Vector2();\n  private dummy = new THREE.Object3D();\n\n  private posXAxisHelper: THREE.Sprite;\n  private posYAxisHelper: THREE.Sprite;\n  private posZAxisHelper: THREE.Sprite;\n  private negXAxisHelper: THREE.Sprite;\n  private negYAxisHelper: THREE.Sprite;\n  private negZAxisHelper: THREE.Sprite;\n\n  private point = new THREE.Vector3();\n  private targetPosition = new THREE.Vector3();\n  private targetQuaternion = new THREE.Quaternion();\n  private q1 = new THREE.Quaternion();\n  private q2 = new THREE.Quaternion();\n  private radius = 0;\n\n  private editorCamera: THREE.Camera;\n\n  constructor(editorCamera: THREE.Camera) {\n    super();\n\n    this.editorCamera = editorCamera;\n\n    // Axis colors\n    const color1 = new THREE.Color('#ff3653'); // X - Red\n    const color2 = new THREE.Color('#8adb00'); // Y - Green\n    const color3 = new THREE.Color('#2c8fff'); // Z - Blue\n\n    // Create orthographic camera for the helper\n    this.camera = new THREE.OrthographicCamera(-2, 2, 2, -2, 0, 4);\n    this.camera.position.set(0, 0, 2);\n\n    // Create axis geometry\n    const geometry = new THREE.BoxGeometry(0.8, 0.05, 0.05).translate(0.4, 0, 0);\n\n    const xAxis = new THREE.Mesh(geometry, this.getAxisMaterial(color1));\n    const yAxis = new THREE.Mesh(geometry, this.getAxisMaterial(color2));\n    const zAxis = new THREE.Mesh(geometry, this.getAxisMaterial(color3));\n\n    yAxis.rotation.z = Math.PI / 2;\n    zAxis.rotation.y = -Math.PI / 2;\n\n    this.add(xAxis);\n    this.add(zAxis);\n    this.add(yAxis);\n\n    // Create sprite helpers for positive axes (with labels)\n    this.posXAxisHelper = new THREE.Sprite(this.getSpriteMaterial(color1, 'X'));\n    this.posXAxisHelper.userData.type = 'posX';\n    this.posYAxisHelper = new THREE.Sprite(this.getSpriteMaterial(color2, 'Y'));\n    this.posYAxisHelper.userData.type = 'posY';\n    this.posZAxisHelper = new THREE.Sprite(this.getSpriteMaterial(color3, 'Z'));\n    this.posZAxisHelper.userData.type = 'posZ';\n\n    // Create sprite helpers for negative axes (without labels)\n    this.negXAxisHelper = new THREE.Sprite(this.getSpriteMaterial(color1));\n    this.negXAxisHelper.userData.type = 'negX';\n    this.negYAxisHelper = new THREE.Sprite(this.getSpriteMaterial(color2));\n    this.negYAxisHelper.userData.type = 'negY';\n    this.negZAxisHelper = new THREE.Sprite(this.getSpriteMaterial(color3));\n    this.negZAxisHelper.userData.type = 'negZ';\n\n    // Position sprites\n    this.posXAxisHelper.position.x = 1;\n    this.posYAxisHelper.position.y = 1;\n    this.posZAxisHelper.position.z = 1;\n    this.negXAxisHelper.position.x = -1;\n    this.negXAxisHelper.scale.setScalar(0.8);\n    this.negYAxisHelper.position.y = -1;\n    this.negYAxisHelper.scale.setScalar(0.8);\n    this.negZAxisHelper.position.z = -1;\n    this.negZAxisHelper.scale.setScalar(0.8);\n\n    this.add(this.posXAxisHelper);\n    this.add(this.posYAxisHelper);\n    this.add(this.posZAxisHelper);\n    this.add(this.negXAxisHelper);\n    this.add(this.negYAxisHelper);\n    this.add(this.negZAxisHelper);\n\n    // Add to interactive objects for raycasting\n    this.interactiveObjects.push(this.posXAxisHelper);\n    this.interactiveObjects.push(this.posYAxisHelper);\n    this.interactiveObjects.push(this.posZAxisHelper);\n    this.interactiveObjects.push(this.negXAxisHelper);\n    this.interactiveObjects.push(this.negYAxisHelper);\n    this.interactiveObjects.push(this.negZAxisHelper);\n  }\n\n  /**\n   * Render the view helper to a viewport in the main renderer\n   */\n  render(renderer: THREE.WebGLRenderer, containerWidth: number, _containerHeight: number): void {\n    this.updateOpacity();\n\n    // Render in corner - save and restore autoClear state\n    const x = containerWidth - this.dim;\n    const autoClear = renderer.autoClear;\n    renderer.autoClear = false;\n\n    renderer.setViewport(x, 0, this.dim, this.dim);\n    renderer.clearDepth();\n    renderer.render(this, this.camera);\n\n    renderer.autoClear = autoClear;\n  }\n\n  /**\n   * Render the view helper to a separate canvas/renderer\n   */\n  renderToCanvas(renderer: THREE.WebGLRenderer): void {\n    this.updateOpacity();\n\n    // Render to the full canvas\n    renderer.render(this, this.camera);\n  }\n\n  /**\n   * Update opacity based on camera orientation\n   */\n  private updateOpacity(): void {\n    // Update orientation to match editor camera\n    this.quaternion.copy(this.editorCamera.quaternion).invert();\n    this.updateMatrixWorld();\n\n    // Update opacity based on camera direction\n    this.point.set(0, 0, 1);\n    this.point.applyQuaternion(this.editorCamera.quaternion);\n\n    if (this.point.x >= 0) {\n      this.posXAxisHelper.material.opacity = 1;\n      this.negXAxisHelper.material.opacity = 0.5;\n    } else {\n      this.posXAxisHelper.material.opacity = 0.5;\n      this.negXAxisHelper.material.opacity = 1;\n    }\n\n    if (this.point.y >= 0) {\n      this.posYAxisHelper.material.opacity = 1;\n      this.negYAxisHelper.material.opacity = 0.5;\n    } else {\n      this.posYAxisHelper.material.opacity = 0.5;\n      this.negYAxisHelper.material.opacity = 1;\n    }\n\n    if (this.point.z >= 0) {\n      this.posZAxisHelper.material.opacity = 1;\n      this.negZAxisHelper.material.opacity = 0.5;\n    } else {\n      this.posZAxisHelper.material.opacity = 0.5;\n      this.negZAxisHelper.material.opacity = 1;\n    }\n  }\n\n  /**\n   * Handle click on the view helper\n   * Returns true if a click was handled\n   */\n  handleClick(event: MouseEvent, container: HTMLElement): boolean {\n    if (this.animating) return false;\n\n    const rect = container.getBoundingClientRect();\n    const offsetX = rect.right - this.dim;\n    const offsetY = rect.bottom - this.dim;\n\n    // Check if click is in the helper area\n    if (event.clientX < offsetX || event.clientY < offsetY) {\n      return false;\n    }\n\n    // Convert to normalized device coordinates for the helper viewport\n    this.mouse.x = ((event.clientX - offsetX) / this.dim) * 2 - 1;\n    this.mouse.y = -((event.clientY - offsetY) / this.dim) * 2 + 1;\n\n    this.raycaster.setFromCamera(this.mouse, this.camera);\n    const intersects = this.raycaster.intersectObjects(this.interactiveObjects);\n\n    if (intersects.length > 0) {\n      const intersection = intersects[0];\n      const object = intersection.object;\n\n      if (this.controls) {\n        this.prepareAnimationData(object, this.controls.center);\n        this.animating = true;\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Update animation (call in render loop)\n   */\n  update(delta: number): void {\n    if (!this.animating) return;\n\n    const step = delta * this.turnRate;\n    const focusPoint = this.controls?.center || new THREE.Vector3();\n\n    this.q1.rotateTowards(this.q2, step);\n\n    if (this.editorCamera instanceof THREE.PerspectiveCamera ||\n        this.editorCamera instanceof THREE.OrthographicCamera) {\n      this.editorCamera.position.set(0, 0, 1)\n        .applyQuaternion(this.q1)\n        .multiplyScalar(this.radius)\n        .add(focusPoint);\n\n      this.editorCamera.quaternion.rotateTowards(this.targetQuaternion, step);\n    }\n\n    if (this.q1.angleTo(this.q2) === 0) {\n      this.animating = false;\n    }\n  }\n\n  /**\n   * Set the dimension of the helper\n   */\n  setDimension(dim: number): void {\n    this.dim = dim;\n  }\n\n  private prepareAnimationData(object: THREE.Object3D, focusPoint: THREE.Vector3): void {\n    switch (object.userData.type) {\n      case 'posX':\n        this.targetPosition.set(1, 0, 0);\n        this.targetQuaternion.setFromEuler(new THREE.Euler(0, Math.PI * 0.5, 0));\n        break;\n      case 'posY':\n        this.targetPosition.set(0, 1, 0);\n        this.targetQuaternion.setFromEuler(new THREE.Euler(-Math.PI * 0.5, 0, 0));\n        break;\n      case 'posZ':\n        this.targetPosition.set(0, 0, 1);\n        this.targetQuaternion.setFromEuler(new THREE.Euler());\n        break;\n      case 'negX':\n        this.targetPosition.set(-1, 0, 0);\n        this.targetQuaternion.setFromEuler(new THREE.Euler(0, -Math.PI * 0.5, 0));\n        break;\n      case 'negY':\n        this.targetPosition.set(0, -1, 0);\n        this.targetQuaternion.setFromEuler(new THREE.Euler(Math.PI * 0.5, 0, 0));\n        break;\n      case 'negZ':\n        this.targetPosition.set(0, 0, -1);\n        this.targetQuaternion.setFromEuler(new THREE.Euler(0, Math.PI, 0));\n        break;\n      default:\n        console.error('ViewHelper: Invalid axis.');\n    }\n\n    this.radius = this.editorCamera.position.distanceTo(focusPoint);\n    this.targetPosition.multiplyScalar(this.radius).add(focusPoint);\n\n    this.dummy.position.copy(focusPoint);\n    this.dummy.lookAt(this.editorCamera.position);\n    this.q1.copy(this.dummy.quaternion);\n\n    this.dummy.lookAt(this.targetPosition);\n    this.q2.copy(this.dummy.quaternion);\n  }\n\n  private getAxisMaterial(color: THREE.Color): THREE.MeshBasicMaterial {\n    return new THREE.MeshBasicMaterial({ color: color, toneMapped: false });\n  }\n\n  private getSpriteMaterial(color: THREE.Color, text: string | null = null): THREE.SpriteMaterial {\n    const canvas = document.createElement('canvas');\n    canvas.width = 64;\n    canvas.height = 64;\n\n    const context = canvas.getContext('2d')!;\n    context.beginPath();\n    context.arc(32, 32, 16, 0, 2 * Math.PI);\n    context.closePath();\n    context.fillStyle = color.getStyle();\n    context.fill();\n\n    if (text !== null) {\n      context.font = '24px Arial';\n      context.textAlign = 'center';\n      context.fillStyle = '#000000';\n      context.fillText(text, 32, 41);\n    }\n\n    const texture = new THREE.CanvasTexture(canvas);\n\n    return new THREE.SpriteMaterial({ map: texture, toneMapped: false, transparent: true });\n  }\n\n  dispose(): void {\n    // Dispose of geometries and materials\n    this.traverse((object) => {\n      if (object instanceof THREE.Mesh) {\n        object.geometry.dispose();\n        if (object.material instanceof THREE.Material) {\n          object.material.dispose();\n        }\n      }\n      if (object instanceof THREE.Sprite) {\n        if (object.material.map) {\n          object.material.map.dispose();\n        }\n        object.material.dispose();\n      }\n    });\n  }\n}\n","import { Component, inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ModelStateService } from '../../services/model-state.service';\n\n@Component({\n  selector: 'orcaflex-logs-section',\n  standalone: true,\n  imports: [CommonModule],\n  template: `\n    <div class=\"section-content\">\n      <div class=\"toolbar\">\n        <button class=\"clear-btn\" (click)=\"clearLogs()\" [disabled]=\"logs().length === 0\">\n          Clear Logs\n        </button>\n      </div>\n\n      <div class=\"logs-container\">\n        @for (log of logs(); track log.id) {\n          <div class=\"log-entry\" [class]=\"log.level\">\n            <span class=\"timestamp\">{{ formatTime(log.timestamp) }}</span>\n            <span class=\"level-badge\">{{ log.level }}</span>\n            <span class=\"message\">{{ log.message }}</span>\n            @if (log.details) {\n              <div class=\"details\">{{ log.details }}</div>\n            }\n          </div>\n        }\n\n        @if (logs().length === 0) {\n          <div class=\"empty-state\">\n            No log entries\n          </div>\n        }\n      </div>\n    </div>\n  `,\n  styles: [`\n    .section-content {\n      padding: 8px;\n    }\n\n    .toolbar {\n      margin-bottom: 8px;\n    }\n\n    .clear-btn {\n      padding: 4px 8px;\n      font-size: 11px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      background: white;\n      cursor: pointer;\n    }\n\n    .clear-btn:hover:not(:disabled) {\n      background: var(--caris-bg-subtle, #f5f5f5);\n    }\n\n    .clear-btn:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n\n    .logs-container {\n      max-height: 300px;\n      overflow-y: auto;\n      border: 1px solid var(--caris-border-light, #eee);\n      border-radius: 4px;\n      background: var(--caris-bg-subtle, #fafafa);\n    }\n\n    .log-entry {\n      padding: 6px 8px;\n      border-bottom: 1px solid var(--caris-border-light, #eee);\n      font-size: 11px;\n      font-family: monospace;\n    }\n\n    .log-entry:last-child {\n      border-bottom: none;\n    }\n\n    .timestamp {\n      color: var(--caris-text-tertiary, #999);\n      margin-right: 8px;\n    }\n\n    .level-badge {\n      display: inline-block;\n      padding: 1px 4px;\n      border-radius: 3px;\n      font-size: 10px;\n      text-transform: uppercase;\n      margin-right: 8px;\n    }\n\n    .log-entry.info .level-badge {\n      background: #e3f2fd;\n      color: #1976d2;\n    }\n\n    .log-entry.success .level-badge {\n      background: #e8f5e9;\n      color: #388e3c;\n    }\n\n    .log-entry.warning .level-badge {\n      background: #fff3e0;\n      color: #f57c00;\n    }\n\n    .log-entry.error .level-badge {\n      background: #ffebee;\n      color: #d32f2f;\n    }\n\n    .message {\n      color: var(--caris-text-primary, #333);\n    }\n\n    .details {\n      margin-top: 4px;\n      padding: 4px 8px;\n      background: rgba(0,0,0,0.03);\n      border-radius: 2px;\n      color: var(--caris-text-secondary, #666);\n      white-space: pre-wrap;\n      word-break: break-all;\n    }\n\n    .empty-state {\n      padding: 20px;\n      text-align: center;\n      color: var(--caris-text-tertiary, #bbb);\n      font-size: 12px;\n    }\n  `]\n})\nexport class LogsSectionComponent {\n  private modelState = inject(ModelStateService);\n\n  logs = this.modelState.logs;\n\n  formatTime(date: Date): string {\n    return new Date(date).toLocaleTimeString('en-US', {\n      hour12: false,\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n    });\n  }\n\n  clearLogs(): void {\n    this.modelState.clearLogs();\n  }\n}\n","import { Component, inject, signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { ModelStateService } from '../../services/model-state.service';\nimport { OrcaFlexApiService } from '../../services/orcaflex-api.service';\nimport { VesselConfig, ConnectionPoint, DEFAULT_VESSEL } from '../../types';\nimport { ConnectionPointsImportDialogComponent } from './connection-points-import-dialog.component';\n\n@Component({\n  selector: 'orcaflex-vessel-section',\n  standalone: true,\n  imports: [CommonModule, FormsModule, ConnectionPointsImportDialogComponent],\n  template: `\n    <div class=\"section-content\">\n      <!-- Toolbar -->\n      <div class=\"toolbar\">\n        <button class=\"toolbar-btn\" (click)=\"addVessel()\" title=\"Add new vessel\">\n          <span class=\"icon\">+</span> Add\n        </button>\n        <button class=\"toolbar-btn\" (click)=\"fileInput.click()\" title=\"Import vessel from OrcaFlex YAML\">\n          Import\n        </button>\n        <input\n          #fileInput\n          type=\"file\"\n          accept=\".yml,.yaml\"\n          style=\"display: none\"\n          (change)=\"onFileSelected($event)\"\n        />\n      </div>\n\n      <!-- Vessel List -->\n      @for (vessel of vessels(); track vessel.id) {\n        <div\n          class=\"vessel-item\"\n          [class.selected]=\"selectedVesselId() === vessel.id\"\n        >\n          <div class=\"vessel-header\" (click)=\"selectVessel(vessel.id)\">\n            <span class=\"vessel-name\">{{ vessel.name }}</span>\n            <button class=\"delete-btn\" (click)=\"deleteVessel(vessel.id); $event.stopPropagation()\" title=\"Delete vessel\"></button>\n          </div>\n          <div class=\"vessel-dims\">\n            {{ vessel.length }}m  {{ vessel.breadth }}m  {{ vessel.depth }}m\n          </div>\n\n          @if (selectedVesselId() === vessel.id) {\n            <div class=\"vessel-details\" (click)=\"$event.stopPropagation()\">\n              <!-- Name -->\n              <div class=\"form-group\">\n                <label>Name</label>\n                <input type=\"text\" [ngModel]=\"vessel.name\"\n                  (ngModelChange)=\"updateVesselName(vessel, $event)\" />\n              </div>\n\n              <!-- Dimensions -->\n              <div class=\"form-row\">\n                <div class=\"form-group third\">\n                  <label>Length (m)</label>\n                  <input type=\"number\" [ngModel]=\"vessel.length\"\n                    (ngModelChange)=\"updateVesselDimension(vessel, 'length', $event)\" />\n                </div>\n                <div class=\"form-group third\">\n                  <label>Breadth (m)</label>\n                  <input type=\"number\" [ngModel]=\"vessel.breadth\"\n                    (ngModelChange)=\"updateVesselDimension(vessel, 'breadth', $event)\" />\n                </div>\n                <div class=\"form-group third\">\n                  <label>Depth (m)</label>\n                  <input type=\"number\" [ngModel]=\"vessel.depth\"\n                    (ngModelChange)=\"updateVesselDimension(vessel, 'depth', $event)\" />\n                </div>\n              </div>\n\n              <div class=\"form-group\">\n                <label>Draft (m)</label>\n                <input type=\"number\" [ngModel]=\"vessel.draft\"\n                  (ngModelChange)=\"updateVesselDimension(vessel, 'draft', $event)\" />\n              </div>\n\n              <!-- Position -->\n              <div class=\"subsection-title\">Position</div>\n              <div class=\"form-row\">\n                <div class=\"form-group third\">\n                  <label>X</label>\n                  <input type=\"number\" [ngModel]=\"vessel.position.x\"\n                    (ngModelChange)=\"updateVesselPosition(vessel, 'x', $event)\" />\n                </div>\n                <div class=\"form-group third\">\n                  <label>Y</label>\n                  <input type=\"number\" [ngModel]=\"vessel.position.y\"\n                    (ngModelChange)=\"updateVesselPosition(vessel, 'y', $event)\" />\n                </div>\n                <div class=\"form-group third\">\n                  <label>Z</label>\n                  <input type=\"number\" [ngModel]=\"vessel.position.z\"\n                    (ngModelChange)=\"updateVesselPosition(vessel, 'z', $event)\" />\n                </div>\n              </div>\n\n              <!-- Orientation -->\n              <div class=\"subsection-title\">Orientation</div>\n              <div class=\"form-row\">\n                <div class=\"form-group third\">\n                  <label>Heading ()</label>\n                  <input type=\"number\" [ngModel]=\"vessel.orientation.heading\"\n                    (ngModelChange)=\"updateVesselOrientation(vessel, 'heading', $event)\" />\n                </div>\n                <div class=\"form-group third\">\n                  <label>Roll ()</label>\n                  <input type=\"number\" [ngModel]=\"vessel.orientation.roll\"\n                    (ngModelChange)=\"updateVesselOrientation(vessel, 'roll', $event)\" />\n                </div>\n                <div class=\"form-group third\">\n                  <label>Pitch ()</label>\n                  <input type=\"number\" [ngModel]=\"vessel.orientation.pitch\"\n                    (ngModelChange)=\"updateVesselOrientation(vessel, 'pitch', $event)\" />\n                </div>\n              </div>\n\n              <!-- Connection Points -->\n              <div class=\"connection-points\">\n                <div class=\"cp-header\">\n                  <span>Connection Points</span>\n                  <div class=\"cp-actions\">\n                    <button class=\"import-cp-btn\" (click)=\"openImportDialog(vessel); $event.stopPropagation()\" title=\"Import from Excel\">\n                      Import\n                    </button>\n                    <button class=\"add-cp-btn\" (click)=\"addConnectionPoint(vessel); $event.stopPropagation()\">+</button>\n                  </div>\n                </div>\n                @for (cp of vessel.connectionPoints; track cp.id; let idx = $index) {\n                  <div class=\"cp-row\" [class.editing]=\"editingCpIdx() === idx\">\n                    @if (editingCpIdx() === idx) {\n                      <input type=\"text\" class=\"cp-input name\" [(ngModel)]=\"editingCp.name\" placeholder=\"Name\" />\n                      <input type=\"number\" class=\"cp-input coord\" [(ngModel)]=\"editingCp.x\" placeholder=\"X\" />\n                      <input type=\"number\" class=\"cp-input coord\" [(ngModel)]=\"editingCp.y\" placeholder=\"Y\" />\n                      <input type=\"number\" class=\"cp-input coord\" [(ngModel)]=\"editingCp.z\" placeholder=\"Z\" />\n                      <button class=\"icon-btn save\" (click)=\"saveCpEdit(vessel, idx); $event.stopPropagation()\"></button>\n                      <button class=\"icon-btn cancel\" (click)=\"cancelCpEdit(); $event.stopPropagation()\"></button>\n                    } @else {\n                      <span class=\"cp-name\">{{ cp.name }}</span>\n                      <span class=\"cp-coords\">({{ cp.x }}, {{ cp.y }}, {{ cp.z }})</span>\n                      <button class=\"icon-btn edit\" (click)=\"startCpEdit(idx, cp); $event.stopPropagation()\"></button>\n                      <button class=\"icon-btn delete\" (click)=\"deleteCp(vessel, idx); $event.stopPropagation()\"></button>\n                    }\n                  </div>\n                }\n                @if (vessel.connectionPoints.length === 0) {\n                  <div class=\"no-cp\">No connection points defined</div>\n                }\n              </div>\n            </div>\n          }\n        </div>\n      }\n\n      @if (vessels().length === 0) {\n        <div class=\"empty-state\">\n          <p>No vessels defined</p>\n          <p class=\"hint\">Add a vessel or import from OrcaFlex YAML</p>\n        </div>\n      }\n\n      <!-- Import status -->\n      @if (importing()) {\n        <div class=\"import-status\">\n          Importing vessel from YAML...\n        </div>\n      }\n\n      <!-- Connection Points Import Dialog -->\n      <orcaflex-connection-points-import-dialog\n        [(visible)]=\"showImportDialog\"\n        (import)=\"handleConnectionPointsImport($event)\"\n      />\n    </div>\n  `,\n  styles: [`\n    .section-content {\n      padding: 8px;\n    }\n\n    .toolbar {\n      display: flex;\n      gap: 8px;\n      margin-bottom: 12px;\n    }\n\n    .toolbar-btn {\n      flex: 1;\n      padding: 6px 12px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      background: white;\n      font-size: 11px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 4px;\n    }\n\n    .toolbar-btn:hover {\n      background: var(--caris-bg-subtle, #f5f5f5);\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .toolbar-btn .icon {\n      font-weight: bold;\n    }\n\n    .vessel-item {\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      margin-bottom: 8px;\n      cursor: pointer;\n      transition: border-color 0.2s;\n      overflow: hidden;\n    }\n\n    .vessel-item:hover {\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .vessel-item.selected {\n      border-color: var(--caris-primary, #1976d2);\n      background: var(--caris-bg-selected, #e3f2fd);\n    }\n\n    .vessel-header {\n      padding: 8px 12px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .vessel-name {\n      font-weight: 500;\n      font-size: 12px;\n    }\n\n    .delete-btn {\n      width: 20px;\n      height: 20px;\n      border: none;\n      background: transparent;\n      color: var(--caris-text-secondary, #999);\n      font-size: 16px;\n      cursor: pointer;\n      border-radius: 3px;\n    }\n\n    .delete-btn:hover {\n      background: #ffebee;\n      color: var(--caris-error, #f44336);\n    }\n\n    .vessel-dims {\n      padding: 0 12px 8px;\n      font-size: 11px;\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .vessel-details {\n      padding: 12px;\n      border-top: 1px solid var(--caris-border-light, #eee);\n      background: var(--caris-bg-subtle, #fafafa);\n    }\n\n    .form-group {\n      margin-bottom: 10px;\n    }\n\n    .form-group label {\n      display: block;\n      font-size: 10px;\n      color: var(--caris-text-secondary, #666);\n      margin-bottom: 2px;\n    }\n\n    .form-group input {\n      width: 100%;\n      padding: 5px 6px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      font-size: 12px;\n      background: white;\n    }\n\n    .form-group input:focus {\n      outline: none;\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .form-row {\n      display: flex;\n      gap: 6px;\n    }\n\n    .form-group.third {\n      flex: 1;\n    }\n\n    .subsection-title {\n      font-size: 10px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: var(--caris-text-secondary, #666);\n      margin: 12px 0 6px 0;\n      padding-top: 8px;\n      border-top: 1px solid var(--caris-border-light, #eee);\n    }\n\n    .connection-points {\n      margin-top: 12px;\n      padding-top: 8px;\n      border-top: 1px solid var(--caris-border-light, #eee);\n    }\n\n    .cp-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      font-size: 10px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: var(--caris-text-secondary, #666);\n      margin-bottom: 8px;\n    }\n\n    .cp-actions {\n      display: flex;\n      gap: 4px;\n      align-items: center;\n    }\n\n    .import-cp-btn {\n      padding: 2px 6px;\n      border: 1px solid var(--caris-primary, #1976d2);\n      border-radius: 3px;\n      background: transparent;\n      color: var(--caris-primary, #1976d2);\n      font-size: 9px;\n      cursor: pointer;\n      text-transform: none;\n      font-weight: 500;\n    }\n\n    .import-cp-btn:hover {\n      background: var(--caris-primary, #1976d2);\n      color: white;\n    }\n\n    .add-cp-btn {\n      width: 20px;\n      height: 20px;\n      border: 1px dashed var(--caris-border-light, #ddd);\n      border-radius: 3px;\n      background: transparent;\n      color: var(--caris-text-secondary, #666);\n      font-size: 14px;\n      cursor: pointer;\n    }\n\n    .add-cp-btn:hover {\n      border-color: var(--caris-primary, #1976d2);\n      color: var(--caris-primary, #1976d2);\n    }\n\n    .cp-row {\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      padding: 4px 0;\n      font-size: 11px;\n    }\n\n    .cp-row.editing {\n      padding: 6px 0;\n    }\n\n    .cp-name {\n      flex: 1;\n      font-weight: 500;\n    }\n\n    .cp-coords {\n      color: var(--caris-text-secondary, #666);\n      font-family: monospace;\n      font-size: 10px;\n    }\n\n    .cp-input {\n      padding: 3px 4px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 3px;\n      font-size: 10px;\n    }\n\n    .cp-input.name {\n      width: 60px;\n    }\n\n    .cp-input.coord {\n      width: 40px;\n      text-align: right;\n    }\n\n    .icon-btn {\n      width: 18px;\n      height: 18px;\n      padding: 0;\n      border: none;\n      border-radius: 3px;\n      background: transparent;\n      cursor: pointer;\n      font-size: 12px;\n      line-height: 1;\n    }\n\n    .icon-btn:hover {\n      background: var(--caris-bg-hover, #f0f0f0);\n    }\n\n    .icon-btn.edit {\n      color: var(--caris-primary, #1976d2);\n    }\n\n    .icon-btn.delete {\n      color: var(--caris-error, #f44336);\n    }\n\n    .icon-btn.save {\n      color: var(--caris-success, #4caf50);\n    }\n\n    .icon-btn.cancel {\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .no-cp {\n      font-size: 11px;\n      color: var(--caris-text-tertiary, #999);\n      font-style: italic;\n      padding: 4px 0;\n    }\n\n    .empty-state {\n      text-align: center;\n      padding: 24px;\n      color: var(--caris-text-secondary, #999);\n    }\n\n    .empty-state p {\n      margin: 0 0 4px 0;\n      font-size: 12px;\n    }\n\n    .empty-state .hint {\n      font-size: 11px;\n      color: var(--caris-text-tertiary, #bbb);\n    }\n\n    .import-status {\n      text-align: center;\n      padding: 8px;\n      background: var(--caris-bg-subtle, #f5f5f5);\n      border-radius: 4px;\n      font-size: 11px;\n      color: var(--caris-text-secondary, #666);\n    }\n  `]\n})\nexport class VesselSectionComponent {\n  private modelState = inject(ModelStateService);\n  private apiService = inject(OrcaFlexApiService);\n\n  vessels = this.modelState.vessels;\n  selectedVesselId = this.modelState.selectedVesselId;\n\n  importing = signal(false);\n\n  // Connection point editing state\n  editingCpIdx = signal<number | null>(null);\n  editingCp: ConnectionPoint = { id: '', name: '', x: 0, y: 0, z: 0 };\n\n  // Connection points import dialog state\n  showImportDialog = false;\n  importTargetVesselId: string | null = null;\n\n  selectVessel(id: string): void {\n    this.modelState.selectVessel(\n      this.selectedVesselId() === id ? null : id\n    );\n  }\n\n  addVessel(): void {\n    const count = this.vessels().length + 1;\n    const newVessel: VesselConfig = {\n      ...DEFAULT_VESSEL,\n      id: crypto.randomUUID(),\n      name: `Vessel ${count}`,\n      connectionPoints: [\n        { id: crypto.randomUUID(), name: 'CP1', x: 0, y: 0, z: -10 },\n      ],\n    };\n    this.modelState.addVessel(newVessel);\n    this.modelState.selectVessel(newVessel.id);\n  }\n\n  deleteVessel(id: string): void {\n    this.modelState.deleteVessel(id);\n  }\n\n  async onFileSelected(event: Event): Promise<void> {\n    const input = event.target as HTMLInputElement;\n    if (!input.files?.length) return;\n\n    const file = input.files[0];\n    this.importing.set(true);\n\n    try {\n      const result = await this.apiService.parseVesselFromYaml(file);\n      if (result.vessels && result.vessels.length > 0) {\n        for (const vessel of result.vessels) {\n          const newVessel: VesselConfig = {\n            id: crypto.randomUUID(),\n            name: vessel.name,\n            length: vessel.length || 250,\n            breadth: vessel.breadth || 50,\n            depth: vessel.depth || 30,\n            draft: vessel.draft || 15,\n            position: {\n              x: (vessel as any).initialX || 0,\n              y: (vessel as any).initialY || 0,\n              z: (vessel as any).initialZ || 0,\n            },\n            orientation: {\n              heading: (vessel as any).initialHeading || 0,\n              roll: (vessel as any).initialHeel || 0,\n              pitch: (vessel as any).initialTrim || 0,\n            },\n            connectionPoints: (vessel.connectionPoints || []).map((cp: any) => ({\n              id: crypto.randomUUID(),\n              name: cp.name || 'CP',\n              x: cp.x || 0,\n              y: cp.y || 0,\n              z: cp.z || 0,\n            })),\n          };\n          this.modelState.addVessel(newVessel);\n        }\n        this.modelState.addLog('success', `Imported ${result.vessels.length} vessel(s) from YAML`);\n      } else {\n        this.modelState.addLog('warning', 'No vessels found in YAML file');\n      }\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.modelState.addLog('error', `Failed to import vessel: ${message}`);\n    } finally {\n      this.importing.set(false);\n      input.value = '';\n    }\n  }\n\n  updateVesselName(vessel: VesselConfig, name: string): void {\n    this.modelState.updateVessel({ ...vessel, name });\n  }\n\n  updateVesselDimension(vessel: VesselConfig, dim: 'length' | 'breadth' | 'depth' | 'draft', value: number): void {\n    this.modelState.updateVessel({ ...vessel, [dim]: value });\n  }\n\n  updateVesselPosition(vessel: VesselConfig, axis: 'x' | 'y' | 'z', value: number): void {\n    this.modelState.updateVessel({\n      ...vessel,\n      position: { ...vessel.position, [axis]: value }\n    });\n  }\n\n  updateVesselOrientation(vessel: VesselConfig, param: 'heading' | 'roll' | 'pitch', value: number): void {\n    this.modelState.updateVessel({\n      ...vessel,\n      orientation: { ...vessel.orientation, [param]: value }\n    });\n  }\n\n  // Connection point management\n  addConnectionPoint(vessel: VesselConfig): void {\n    const count = vessel.connectionPoints.length + 1;\n    const newCp: ConnectionPoint = {\n      id: crypto.randomUUID(),\n      name: `CP${count}`,\n      x: 0,\n      y: 0,\n      z: -10,\n    };\n    this.modelState.updateVessel({\n      ...vessel,\n      connectionPoints: [...vessel.connectionPoints, newCp],\n    });\n  }\n\n  startCpEdit(idx: number, cp: ConnectionPoint): void {\n    this.editingCpIdx.set(idx);\n    this.editingCp = { ...cp };\n  }\n\n  saveCpEdit(vessel: VesselConfig, idx: number): void {\n    const connectionPoints = [...vessel.connectionPoints];\n    connectionPoints[idx] = { ...this.editingCp };\n    this.modelState.updateVessel({ ...vessel, connectionPoints });\n    this.editingCpIdx.set(null);\n  }\n\n  cancelCpEdit(): void {\n    this.editingCpIdx.set(null);\n  }\n\n  deleteCp(vessel: VesselConfig, idx: number): void {\n    const connectionPoints = vessel.connectionPoints.filter((_, i) => i !== idx);\n    this.modelState.updateVessel({ ...vessel, connectionPoints });\n  }\n\n  // Connection points import dialog methods\n  openImportDialog(vessel: VesselConfig): void {\n    this.importTargetVesselId = vessel.id;\n    this.showImportDialog = true;\n  }\n\n  handleConnectionPointsImport(connectionPoints: ConnectionPoint[]): void {\n    if (!this.importTargetVesselId) return;\n\n    const vessel = this.vessels().find(v => v.id === this.importTargetVesselId);\n    if (!vessel) return;\n\n    // Add imported connection points to the vessel\n    this.modelState.updateVessel({\n      ...vessel,\n      connectionPoints: [...vessel.connectionPoints, ...connectionPoints],\n    });\n\n    this.modelState.addLog('success', `Imported ${connectionPoints.length} connection point(s)`);\n    this.importTargetVesselId = null;\n  }\n}\n","/**\n * Three.js scene configuration types and defaults for OrcaFlex module\n */\n\nexport interface Vector3 {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport interface SceneBounds {\n  min: Vector3;\n  max: Vector3;\n}\n\nexport interface CameraPosition {\n  position: Vector3;\n  up: Vector3;\n}\n\nexport interface CameraPositions {\n  side: CameraPosition;\n  top: CameraPosition;\n  front: CameraPosition;\n  iso: CameraPosition;\n}\n\nexport interface VesselDimensions {\n  length: number;\n  breadth: number;\n  depth: number;\n  draft: number;\n}\n\nexport interface SceneConfig {\n  waterDepth: number;\n  vesselPosition: Vector3;\n  vesselDimensions: VesselDimensions;\n  sceneBounds: SceneBounds;\n  backgroundColor: number;\n}\n\n// Default scene bounds for FPSO/riser visualization\nexport const DEFAULT_SCENE_BOUNDS: SceneBounds = {\n  min: { x: -200, y: -100, z: -300 },\n  max: { x: 400, y: 100, z: 50 }\n};\n\n// Camera positions for different views\nexport const DEFAULT_CAMERA_POSITIONS: CameraPositions = {\n  side: { position: { x: 500, y: 0, z: 0 }, up: { x: 0, y: 0, z: 1 } },\n  top: { position: { x: 0, y: 0, z: 500 }, up: { x: 0, y: 1, z: 0 } },\n  front: { position: { x: 0, y: -500, z: 0 }, up: { x: 0, y: 0, z: 1 } },\n  iso: { position: { x: 400, y: -400, z: 300 }, up: { x: 0, y: 0, z: 1 } }\n};\n\n// Default scene configuration\nexport const DEFAULT_SCENE_CONFIG: SceneConfig = {\n  waterDepth: 100,\n  vesselPosition: { x: 0, y: 0, z: 0 },\n  vesselDimensions: {\n    length: 280,\n    breadth: 60,\n    depth: 30,\n    draft: 22\n  },\n  sceneBounds: DEFAULT_SCENE_BOUNDS,\n  backgroundColor: 0x1a237e // Deep blue gradient start\n};\n\n// Color palette for risers\nexport const RISER_COLORS = [\n  0xff6b35, // Orange\n  0x00bcd4, // Cyan\n  0x4caf50, // Green\n  0xff9800, // Amber\n  0x9c27b0, // Purple\n  0x2196f3, // Blue\n];\n\n// Material colors\nexport const COLORS = {\n  water: 0x006994,\n  seabed: 0x8b7355,\n  vessel: 0x808080,\n  vesselCOG: 0xff3366,\n  cdp: 0x0000ff,\n  tdp: 0xffeb3b,\n  grid: 0x888888,\n  catenary: 0xff0000,\n  buoyancy: 0x00ff00,\n};\n","import { Injectable, signal, computed } from '@angular/core';\nimport {\n  OrcaFlexModel,\n  EnvironmentConfig,\n  VesselConfig,\n  LineTypeConfig,\n  RiserConfig,\n  UndoableAction,\n  LogEntry,\n  ModelValidationResult,\n  DEFAULT_ENVIRONMENT,\n  DEFAULT_VESSEL,\n  DEFAULT_LINE_TYPES,\n  DEFAULT_BUOYANCY_MODULE,\n} from '../types';\n\n@Injectable({ providedIn: 'root' })\nexport class ModelStateService {\n  // Core model state\n  private readonly _model = signal<OrcaFlexModel>(this.createEmptyModel());\n  private readonly _selectedRiserId = signal<string | null>(null);\n  private readonly _selectedVesselId = signal<string | null>(null);\n  private readonly _isCalculating = signal<boolean>(false);\n  private readonly _isDirty = signal<boolean>(false);\n\n  // Undo/Redo stacks\n  private readonly _undoStack = signal<UndoableAction[]>([]);\n  private readonly _redoStack = signal<UndoableAction[]>([]);\n  private readonly MAX_HISTORY = 50;\n\n  // Logs\n  private readonly _logs = signal<LogEntry[]>([]);\n\n  // Validation\n  private readonly _validationResult = signal<ModelValidationResult | null>(null);\n\n  // Public readonly signals\n  readonly model = this._model.asReadonly();\n  readonly selectedRiserId = this._selectedRiserId.asReadonly();\n  readonly selectedVesselId = this._selectedVesselId.asReadonly();\n  readonly isCalculating = this._isCalculating.asReadonly();\n  readonly isDirty = this._isDirty.asReadonly();\n  readonly logs = this._logs.asReadonly();\n  readonly validationResult = this._validationResult.asReadonly();\n\n  // Computed values\n  readonly environment = computed(() => this._model().environment);\n  readonly vessels = computed(() => this._model().vessels);\n  readonly lineTypes = computed(() => this._model().lineTypes);\n  readonly buoyancyModules = computed(() => this._model().buoyancyModules);\n  readonly risers = computed(() => this._model().risers);\n\n  readonly selectedRiser = computed(() => {\n    const id = this._selectedRiserId();\n    return id ? this._model().risers.find(r => r.id === id) ?? null : null;\n  });\n\n  readonly selectedVessel = computed(() => {\n    const id = this._selectedVesselId();\n    return id ? this._model().vessels.find(v => v.id === id) ?? null : null;\n  });\n\n  readonly canUndo = computed(() => this._undoStack().length > 0);\n  readonly canRedo = computed(() => this._redoStack().length > 0);\n\n  readonly riserCount = computed(() => this._model().risers.length);\n  readonly vesselCount = computed(() => this._model().vessels.length);\n\n  // Model operations\n  newModel(): void {\n    this._model.set(this.createEmptyModel());\n    this._selectedRiserId.set(null);\n    this._selectedVesselId.set(null);\n    this._undoStack.set([]);\n    this._redoStack.set([]);\n    this._isDirty.set(false);\n    this.addLog('info', 'New model created');\n  }\n\n  loadModel(model: OrcaFlexModel): void {\n    this._model.set(model);\n    this._selectedRiserId.set(null);\n    this._selectedVesselId.set(null);\n    this._undoStack.set([]);\n    this._redoStack.set([]);\n    this._isDirty.set(false);\n    this.addLog('success', `Model \"${model.name}\" loaded`);\n  }\n\n  // Environment operations\n  updateEnvironment(env: EnvironmentConfig): void {\n    const previous = this._model().environment;\n    this.pushUndoAction({ type: 'UPDATE_ENVIRONMENT', previous, current: env });\n    this._model.update(m => ({ ...m, environment: env, updatedAt: new Date() }));\n    this._isDirty.set(true);\n  }\n\n  // Vessel operations\n  addVessel(vessel: VesselConfig): void {\n    this.pushUndoAction({ type: 'ADD_VESSEL', vessel });\n    this._model.update(m => ({\n      ...m,\n      vessels: [...m.vessels, vessel],\n      updatedAt: new Date(),\n    }));\n    this._isDirty.set(true);\n    this.addLog('info', `Vessel \"${vessel.name}\" added`);\n  }\n\n  updateVessel(vessel: VesselConfig): void {\n    const previous = this._model().vessels.find(v => v.id === vessel.id);\n    if (previous) {\n      this.pushUndoAction({ type: 'UPDATE_VESSEL', previous, current: vessel });\n    }\n    this._model.update(m => ({\n      ...m,\n      vessels: m.vessels.map(v => (v.id === vessel.id ? vessel : v)),\n      updatedAt: new Date(),\n    }));\n    this._isDirty.set(true);\n  }\n\n  deleteVessel(vesselId: string): void {\n    const vessel = this._model().vessels.find(v => v.id === vesselId);\n    if (vessel) {\n      this.pushUndoAction({ type: 'DELETE_VESSEL', vessel });\n      this._model.update(m => ({\n        ...m,\n        vessels: m.vessels.filter(v => v.id !== vesselId),\n        updatedAt: new Date(),\n      }));\n      if (this._selectedVesselId() === vesselId) {\n        this._selectedVesselId.set(null);\n      }\n      this._isDirty.set(true);\n      this.addLog('info', `Vessel \"${vessel.name}\" deleted`);\n    }\n  }\n\n  // Line type operations\n  addLineType(lineType: LineTypeConfig): void {\n    this.pushUndoAction({ type: 'ADD_LINE_TYPE', lineType });\n    this._model.update(m => ({\n      ...m,\n      lineTypes: [...m.lineTypes, lineType],\n      updatedAt: new Date(),\n    }));\n    this._isDirty.set(true);\n    this.addLog('info', `Line type \"${lineType.name}\" added`);\n  }\n\n  updateLineType(lineType: LineTypeConfig): void {\n    const previous = this._model().lineTypes.find(lt => lt.id === lineType.id);\n    if (previous) {\n      this.pushUndoAction({ type: 'UPDATE_LINE_TYPE', previous, current: lineType });\n    }\n    this._model.update(m => ({\n      ...m,\n      lineTypes: m.lineTypes.map(lt => (lt.id === lineType.id ? lineType : lt)),\n      updatedAt: new Date(),\n    }));\n    this._isDirty.set(true);\n  }\n\n  deleteLineType(lineTypeId: string): void {\n    const lineType = this._model().lineTypes.find(lt => lt.id === lineTypeId);\n    if (lineType) {\n      this.pushUndoAction({ type: 'DELETE_LINE_TYPE', lineType });\n      this._model.update(m => ({\n        ...m,\n        lineTypes: m.lineTypes.filter(lt => lt.id !== lineTypeId),\n        updatedAt: new Date(),\n      }));\n      this._isDirty.set(true);\n      this.addLog('info', `Line type \"${lineType.name}\" deleted`);\n    }\n  }\n\n  // Buoyancy module operations\n  addBuoyancyModule(buoyancy: any): void {\n    this._model.update(m => ({\n      ...m,\n      buoyancyModules: [...m.buoyancyModules, buoyancy],\n      updatedAt: new Date(),\n    }));\n    this._isDirty.set(true);\n    this.addLog('info', `Buoyancy module \"${buoyancy.name}\" added`);\n  }\n\n  updateBuoyancyModule(buoyancy: any): void {\n    this._model.update(m => ({\n      ...m,\n      buoyancyModules: m.buoyancyModules.map(bm => (bm.id === buoyancy.id ? buoyancy : bm)),\n      updatedAt: new Date(),\n    }));\n    this._isDirty.set(true);\n  }\n\n  deleteBuoyancyModule(buoyancyId: string): void {\n    const buoyancy = this._model().buoyancyModules.find(bm => bm.id === buoyancyId);\n    if (buoyancy) {\n      this._model.update(m => ({\n        ...m,\n        buoyancyModules: m.buoyancyModules.filter(bm => bm.id !== buoyancyId),\n        updatedAt: new Date(),\n      }));\n      this._isDirty.set(true);\n      this.addLog('info', `Buoyancy module \"${buoyancy.name}\" deleted`);\n    }\n  }\n\n  // Riser operations\n  addRiser(riser: RiserConfig): void {\n    this.pushUndoAction({ type: 'ADD_RISER', riser });\n    this._model.update(m => ({\n      ...m,\n      risers: [...m.risers, riser],\n      updatedAt: new Date(),\n    }));\n    this._isDirty.set(true);\n    this.addLog('info', `Riser \"${riser.name}\" added`);\n  }\n\n  updateRiser(riser: RiserConfig): void {\n    const previous = this._model().risers.find(r => r.id === riser.id);\n    if (previous) {\n      this.pushUndoAction({ type: 'UPDATE_RISER', previous, current: riser });\n    }\n    this._model.update(m => ({\n      ...m,\n      risers: m.risers.map(r => (r.id === riser.id ? riser : r)),\n      updatedAt: new Date(),\n    }));\n    this._isDirty.set(true);\n  }\n\n  deleteRiser(riserId: string): void {\n    const riser = this._model().risers.find(r => r.id === riserId);\n    if (riser) {\n      this.pushUndoAction({ type: 'DELETE_RISER', riser });\n      this._model.update(m => ({\n        ...m,\n        risers: m.risers.filter(r => r.id !== riserId),\n        updatedAt: new Date(),\n      }));\n      if (this._selectedRiserId() === riserId) {\n        this._selectedRiserId.set(null);\n      }\n      this._isDirty.set(true);\n      this.addLog('info', `Riser \"${riser.name}\" deleted`);\n    }\n  }\n\n  // Selection\n  selectRiser(riserId: string | null): void {\n    this._selectedRiserId.set(riserId);\n  }\n\n  selectVessel(vesselId: string | null): void {\n    this._selectedVesselId.set(vesselId);\n  }\n\n  // Undo/Redo\n  undo(): void {\n    const stack = this._undoStack();\n    if (stack.length === 0) return;\n\n    const action = stack[stack.length - 1];\n    this._undoStack.update(s => s.slice(0, -1));\n    this._redoStack.update(s => [...s, action]);\n\n    this.applyUndoAction(action);\n    this._isDirty.set(true);\n    this.addLog('info', 'Undo performed');\n  }\n\n  redo(): void {\n    const stack = this._redoStack();\n    if (stack.length === 0) return;\n\n    const action = stack[stack.length - 1];\n    this._redoStack.update(s => s.slice(0, -1));\n    this._undoStack.update(s => [...s, action]);\n\n    this.applyRedoAction(action);\n    this._isDirty.set(true);\n    this.addLog('info', 'Redo performed');\n  }\n\n  // Calculation state\n  setCalculating(calculating: boolean): void {\n    this._isCalculating.set(calculating);\n  }\n\n  // Validation\n  setValidationResult(result: ModelValidationResult | null): void {\n    this._validationResult.set(result);\n  }\n\n  // Logging\n  addLog(level: LogEntry['level'], message: string, details?: string): void {\n    const entry: LogEntry = {\n      id: crypto.randomUUID(),\n      timestamp: new Date(),\n      level,\n      message,\n      details,\n    };\n    this._logs.update(logs => [...logs.slice(-99), entry]);\n  }\n\n  clearLogs(): void {\n    this._logs.set([]);\n  }\n\n  // Private helpers\n  private createEmptyModel(): OrcaFlexModel {\n    return {\n      id: crypto.randomUUID(),\n      name: 'New Model',\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      environment: { ...DEFAULT_ENVIRONMENT },\n      vessels: [{ ...DEFAULT_VESSEL }],\n      lineTypes: DEFAULT_LINE_TYPES.map(lt => ({ ...lt })),\n      buoyancyModules: [{ ...DEFAULT_BUOYANCY_MODULE }],\n      risers: [],\n    };\n  }\n\n  private pushUndoAction(action: UndoableAction): void {\n    this._undoStack.update(stack => {\n      const newStack = [...stack, action];\n      if (newStack.length > this.MAX_HISTORY) {\n        return newStack.slice(-this.MAX_HISTORY);\n      }\n      return newStack;\n    });\n    this._redoStack.set([]);\n  }\n\n  private applyUndoAction(action: UndoableAction): void {\n    switch (action.type) {\n      case 'UPDATE_ENVIRONMENT':\n        this._model.update(m => ({ ...m, environment: action.previous }));\n        break;\n      case 'ADD_VESSEL':\n        this._model.update(m => ({\n          ...m,\n          vessels: m.vessels.filter(v => v.id !== action.vessel.id),\n        }));\n        break;\n      case 'UPDATE_VESSEL':\n        this._model.update(m => ({\n          ...m,\n          vessels: m.vessels.map(v => (v.id === action.previous.id ? action.previous : v)),\n        }));\n        break;\n      case 'DELETE_VESSEL':\n        this._model.update(m => ({ ...m, vessels: [...m.vessels, action.vessel] }));\n        break;\n      case 'ADD_LINE_TYPE':\n        this._model.update(m => ({\n          ...m,\n          lineTypes: m.lineTypes.filter(lt => lt.id !== action.lineType.id),\n        }));\n        break;\n      case 'UPDATE_LINE_TYPE':\n        this._model.update(m => ({\n          ...m,\n          lineTypes: m.lineTypes.map(lt => (lt.id === action.previous.id ? action.previous : lt)),\n        }));\n        break;\n      case 'DELETE_LINE_TYPE':\n        this._model.update(m => ({ ...m, lineTypes: [...m.lineTypes, action.lineType] }));\n        break;\n      case 'ADD_RISER':\n        this._model.update(m => ({\n          ...m,\n          risers: m.risers.filter(r => r.id !== action.riser.id),\n        }));\n        break;\n      case 'UPDATE_RISER':\n        this._model.update(m => ({\n          ...m,\n          risers: m.risers.map(r => (r.id === action.previous.id ? action.previous : r)),\n        }));\n        break;\n      case 'DELETE_RISER':\n        this._model.update(m => ({ ...m, risers: [...m.risers, action.riser] }));\n        break;\n    }\n  }\n\n  private applyRedoAction(action: UndoableAction): void {\n    switch (action.type) {\n      case 'UPDATE_ENVIRONMENT':\n        this._model.update(m => ({ ...m, environment: action.current }));\n        break;\n      case 'ADD_VESSEL':\n        this._model.update(m => ({ ...m, vessels: [...m.vessels, action.vessel] }));\n        break;\n      case 'UPDATE_VESSEL':\n        this._model.update(m => ({\n          ...m,\n          vessels: m.vessels.map(v => (v.id === action.current.id ? action.current : v)),\n        }));\n        break;\n      case 'DELETE_VESSEL':\n        this._model.update(m => ({\n          ...m,\n          vessels: m.vessels.filter(v => v.id !== action.vessel.id),\n        }));\n        break;\n      case 'ADD_LINE_TYPE':\n        this._model.update(m => ({ ...m, lineTypes: [...m.lineTypes, action.lineType] }));\n        break;\n      case 'UPDATE_LINE_TYPE':\n        this._model.update(m => ({\n          ...m,\n          lineTypes: m.lineTypes.map(lt => (lt.id === action.current.id ? action.current : lt)),\n        }));\n        break;\n      case 'DELETE_LINE_TYPE':\n        this._model.update(m => ({\n          ...m,\n          lineTypes: m.lineTypes.filter(lt => lt.id !== action.lineType.id),\n        }));\n        break;\n      case 'ADD_RISER':\n        this._model.update(m => ({ ...m, risers: [...m.risers, action.riser] }));\n        break;\n      case 'UPDATE_RISER':\n        this._model.update(m => ({\n          ...m,\n          risers: m.risers.map(r => (r.id === action.current.id ? action.current : r)),\n        }));\n        break;\n      case 'DELETE_RISER':\n        this._model.update(m => ({\n          ...m,\n          risers: m.risers.filter(r => r.id !== action.riser.id),\n        }));\n        break;\n    }\n  }\n}\n","import { Type, Injector, ApplicationRef, EnvironmentInjector } from '@angular/core';\nimport { OrcaFlexRiserComponent } from './components/orcaflex-riser.component';\nimport { ModelStateService } from './services/model-state.service';\nimport { OrcaFlexApiService } from './services/orcaflex-api.service';\n\n/**\n * CarisModule interface implementation for OrcaFlex Riser Module.\n * This is the entry point that CARIS Pro uses to load and manage the module.\n */\nexport interface CarisModuleContext {\n  injector: Injector;\n  environmentInjector: EnvironmentInjector;\n  applicationRef: ApplicationRef;\n  services: {\n    api: any;\n    storage: any;\n    notifications: any;\n    dialogs: any;\n  };\n  config?: Record<string, any>;\n}\n\nexport interface CarisModule {\n  readonly name: string;\n  readonly version: string;\n  readonly component: Type<any>;\n\n  onInit(context: CarisModuleContext): Promise<void>;\n  onDestroy(): Promise<void>;\n  onActivate?(): void;\n  onDeactivate?(): void;\n  onRibbonAction?(action: string): void;\n  onSidebarAction?(section: string, action: string): void;\n}\n\nexport class OrcaFlexRiserModule implements CarisModule {\n  readonly name = 'orcaflex-riser-module';\n  readonly version = '1.0.0';\n  readonly component = OrcaFlexRiserComponent;\n\n  private context: CarisModuleContext | null = null;\n  private modelState: ModelStateService | null = null;\n  private apiService: OrcaFlexApiService | null = null;\n\n  async onInit(context: CarisModuleContext): Promise<void> {\n    this.context = context;\n\n    // Get services from injector\n    this.modelState = context.injector.get(ModelStateService);\n    this.apiService = context.injector.get(OrcaFlexApiService);\n\n    // Initialize API service with CARIS API\n    this.apiService.setApiService(context.services.api);\n\n    // Apply module configuration\n    if (context.config) {\n      this.applyConfig(context.config);\n    }\n\n    console.log('[OrcaFlex Module] Initialized');\n  }\n\n  async onDestroy(): Promise<void> {\n    // Cleanup resources\n    this.context = null;\n    this.modelState = null;\n    this.apiService = null;\n\n    console.log('[OrcaFlex Module] Destroyed');\n  }\n\n  onActivate(): void {\n    console.log('[OrcaFlex Module] Activated');\n  }\n\n  onDeactivate(): void {\n    console.log('[OrcaFlex Module] Deactivated');\n  }\n\n  onRibbonAction(action: string): void {\n    if (!this.modelState || !this.context) return;\n\n    switch (action) {\n      case 'newModel':\n        this.modelState.newModel();\n        this.context.services.notifications.info('New model created');\n        break;\n\n      case 'importYaml':\n        this.handleImportYaml();\n        break;\n\n      case 'exportYaml':\n        this.handleExportYaml();\n        break;\n\n      case 'undo':\n        if (this.modelState.canUndo()) {\n          this.modelState.undo();\n        }\n        break;\n\n      case 'redo':\n        if (this.modelState.canRedo()) {\n          this.modelState.redo();\n        }\n        break;\n\n      case 'calculateAll':\n        this.handleCalculateAll();\n        break;\n\n      case 'validateModel':\n        this.handleValidateModel();\n        break;\n\n      case 'goalSeek':\n        this.handleGoalSeek();\n        break;\n\n      case 'resetView':\n      case 'topView':\n      case 'sideView':\n      case 'frontView':\n      case 'zoomToFit':\n        // These will be handled by Three.js service in Phase 3\n        console.log(`[OrcaFlex Module] View action: ${action}`);\n        break;\n\n      case 'openDocs':\n        window.open('https://docs.carispro.com/modules/orcaflex-riser', '_blank');\n        break;\n\n      case 'showAbout':\n        this.showAboutDialog();\n        break;\n\n      case 'closeModule':\n        // Handle close - check for unsaved changes\n        if (this.modelState.isDirty()) {\n          this.context.services.dialogs.confirm({\n            title: 'Unsaved Changes',\n            message: 'You have unsaved changes. Are you sure you want to close?',\n          }).then((confirmed: boolean) => {\n            if (confirmed) {\n              // Close module\n            }\n          });\n        }\n        break;\n\n      default:\n        console.warn(`[OrcaFlex Module] Unknown ribbon action: ${action}`);\n    }\n  }\n\n  onSidebarAction(section: string, action: string): void {\n    console.log(`[OrcaFlex Module] Sidebar action: ${section}/${action}`);\n  }\n\n  private applyConfig(config: Record<string, any>): void {\n    if (!this.modelState) return;\n\n    // Apply default water depth\n    if (config['defaultWaterDepth']) {\n      const env = this.modelState.environment();\n      this.modelState.updateEnvironment({\n        ...env,\n        sea: { ...env.sea, waterDepth: config['defaultWaterDepth'] }\n      });\n    }\n\n    // Apply debug mode\n    if (config['showDebugInfo']) {\n      this.modelState.addLog('info', 'Debug mode enabled');\n    }\n  }\n\n  private async handleImportYaml(): Promise<void> {\n    // File input will be handled by dialog service\n    const result = await this.context?.services.dialogs.fileUpload({\n      title: 'Import OrcaFlex YAML',\n      accept: '.yml,.yaml',\n    });\n\n    if (result?.file) {\n      const content = await result.file.text();\n      try {\n        const response = await this.apiService!.parseYaml(content);\n        if (response.success && response.model) {\n          // Apply parsed data to model\n          this.context?.services.notifications.success('YAML imported successfully');\n        } else {\n          this.context?.services.notifications.error('Failed to parse YAML');\n        }\n      } catch (error) {\n        this.context?.services.notifications.error('Import failed');\n      }\n    }\n  }\n\n  private async handleExportYaml(): Promise<void> {\n    if (!this.modelState || !this.apiService) return;\n\n    try {\n      const model = this.modelState.model();\n      const blob = await this.apiService.downloadYaml({ model });\n\n      // Create download link\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = `${model.name.replace(/\\s+/g, '_')}.yml`;\n      a.click();\n      URL.revokeObjectURL(url);\n\n      this.context?.services.notifications.success('YAML exported successfully');\n    } catch (error) {\n      this.context?.services.notifications.error('Export failed');\n    }\n  }\n\n  private async handleCalculateAll(): Promise<void> {\n    if (!this.modelState) return;\n\n    const risers = this.modelState.risers();\n    this.modelState.addLog('info', `Calculating ${risers.length} risers...`);\n\n    // Calculation will be triggered through component\n    this.context?.services.notifications.info('Starting calculations...');\n  }\n\n  private async handleValidateModel(): Promise<void> {\n    if (!this.modelState || !this.apiService) return;\n\n    try {\n      const model = this.modelState.model();\n      const result = await this.apiService.validateModel(model);\n\n      this.modelState.setValidationResult(result);\n\n      if (result.valid) {\n        this.context?.services.notifications.success('Model is valid');\n      } else {\n        this.context?.services.notifications.warning(\n          `Model has ${result.errors.length} errors and ${result.warnings.length} warnings`\n        );\n      }\n    } catch (error) {\n      this.context?.services.notifications.error('Validation failed');\n    }\n  }\n\n  private handleGoalSeek(): void {\n    // Goal seek dialog will be implemented in Phase 5\n    this.context?.services.notifications.info('Goal Seek coming in Phase 5');\n  }\n\n  private showAboutDialog(): void {\n    this.context?.services.dialogs.info({\n      title: 'About OrcaFlex Riser Analysis',\n      message: `\nOrcaFlex Riser Analysis Module v${this.version}\n\nAutomated OrcaFlex model generation for riser analysis.\nProvides interactive 3D visualization, parameter-driven input,\ngoal-seeking calculations, and direct export to OrcaFlex YAML format.\n\n 2024 CARIS Pro. All rights reserved.\n      `.trim(),\n    });\n  }\n}\n\n// Default export for Module Federation\nexport default OrcaFlexRiserModule;\n","import { Component, EventEmitter, Input, Output, signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { DialogModule } from 'primeng/dialog';\nimport { TableModule } from 'primeng/table';\nimport { ButtonModule } from 'primeng/button';\nimport { InputTextModule } from 'primeng/inputtext';\nimport { ConnectionPoint } from '../../types';\n\ninterface ConnectionPointRow {\n  name: string;\n  x: number;\n  y: number;\n  z: number;\n}\n\n@Component({\n  selector: 'orcaflex-connection-points-import-dialog',\n  standalone: true,\n  imports: [\n    CommonModule,\n    FormsModule,\n    DialogModule,\n    TableModule,\n    ButtonModule,\n    InputTextModule,\n  ],\n  template: `\n    <p-dialog\n      header=\"Import Connection Points\"\n      [visible]=\"visible\"\n      [modal]=\"true\"\n      [closable]=\"true\"\n      [draggable]=\"false\"\n      [resizable]=\"false\"\n      [style]=\"{ width: '600px' }\"\n      styleClass=\"import-dialog\"\n      (onHide)=\"onCancel()\"\n    >\n      <div class=\"dialog-content\">\n        <div class=\"paste-instructions\">\n          <p>Paste data from Excel with 4 columns: <strong>Connection Name, X, Y, Z</strong></p>\n          <p class=\"hint\">Click in the table and press Ctrl+V (Cmd+V on Mac) to paste</p>\n        </div>\n\n        <div\n          class=\"table-container\"\n          tabindex=\"0\"\n          (paste)=\"handlePaste($event)\"\n          (keydown)=\"handleKeydown($event)\"\n        >\n          <p-table [value]=\"rows()\" [tableStyle]=\"{ 'min-width': '100%' }\">\n            <ng-template pTemplate=\"header\">\n              <tr>\n                <th style=\"width: 40%\">Connection Name</th>\n                <th style=\"width: 20%\">X (m)</th>\n                <th style=\"width: 20%\">Y (m)</th>\n                <th style=\"width: 20%\">Z (m)</th>\n              </tr>\n            </ng-template>\n            <ng-template pTemplate=\"body\" let-row let-rowIndex=\"rowIndex\">\n              <tr>\n                <td>\n                  <input\n                    type=\"text\"\n                    pInputText\n                    [(ngModel)]=\"row.name\"\n                    placeholder=\"CP Name\"\n                    class=\"table-input\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.x\"\n                    placeholder=\"0\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.y\"\n                    placeholder=\"0\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.z\"\n                    placeholder=\"0\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n              </tr>\n            </ng-template>\n            <ng-template pTemplate=\"emptymessage\">\n              <tr>\n                <td colspan=\"4\" class=\"empty-message\">\n                  Paste Excel data here or add rows manually\n                </td>\n              </tr>\n            </ng-template>\n          </p-table>\n        </div>\n\n        <div class=\"row-actions\">\n          <button class=\"action-btn add\" (click)=\"addRow()\">+ Add Row</button>\n          <button class=\"action-btn clear\" (click)=\"clearRows()\">Clear All</button>\n        </div>\n      </div>\n\n      <ng-template pTemplate=\"footer\">\n        <div class=\"dialog-footer\">\n          <button class=\"btn-secondary\" (click)=\"onCancel()\">Cancel</button>\n          <button class=\"btn-primary\" (click)=\"onImport()\" [disabled]=\"!hasValidData()\">\n            Import {{ getValidRowCount() }} Connection Point{{ getValidRowCount() !== 1 ? 's' : '' }}\n          </button>\n        </div>\n      </ng-template>\n    </p-dialog>\n  `,\n  styles: [`\n    :host ::ng-deep .import-dialog .p-dialog {\n      background: white;\n    }\n\n    :host ::ng-deep .import-dialog .p-dialog-header {\n      background: white;\n      border-bottom: 1px solid #eee;\n      padding: 16px 20px;\n    }\n\n    :host ::ng-deep .import-dialog .p-dialog-content {\n      background: white;\n      padding: 20px;\n    }\n\n    :host ::ng-deep .import-dialog .p-dialog-footer {\n      background: white;\n      border-top: 1px solid #eee;\n      padding: 16px 20px;\n    }\n\n    :host ::ng-deep .p-dialog-mask {\n      background: rgba(0, 0, 0, 0.5);\n    }\n\n    .dialog-content {\n      padding: 0;\n    }\n\n    .paste-instructions {\n      margin-bottom: 16px;\n      padding: 12px;\n      background: #f5f5f5;\n      border-radius: 4px;\n    }\n\n    .paste-instructions p {\n      margin: 0;\n      font-size: 12px;\n      color: #333;\n    }\n\n    .paste-instructions .hint {\n      margin-top: 4px;\n      font-size: 11px;\n      color: #666;\n    }\n\n    .table-container {\n      border: 2px dashed #ddd;\n      border-radius: 4px;\n      padding: 4px;\n      outline: none;\n      transition: border-color 0.2s;\n      background: white;\n    }\n\n    .table-container:focus {\n      border-color: #1976d2;\n    }\n\n    :host ::ng-deep .p-datatable {\n      background: white;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-header {\n      background: #fafafa;\n      border: none;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-thead > tr > th {\n      background: #fafafa;\n      font-size: 11px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: #666;\n      padding: 8px;\n      border: none;\n      border-bottom: 1px solid #eee;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-tbody > tr {\n      background: white;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-tbody > tr > td {\n      padding: 4px;\n      border: none;\n      border-bottom: 1px solid #f0f0f0;\n      background: white;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-tbody > tr:last-child > td {\n      border-bottom: none;\n    }\n\n    .table-input {\n      width: 100%;\n      padding: 6px 8px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      font-size: 12px;\n      background: white;\n    }\n\n    .table-input:focus {\n      outline: none;\n      border-color: #1976d2;\n    }\n\n    .table-input.coord {\n      text-align: right;\n    }\n\n    .empty-message {\n      text-align: center;\n      padding: 24px;\n      color: #999;\n      font-style: italic;\n      background: white;\n    }\n\n    .row-actions {\n      display: flex;\n      gap: 8px;\n      margin-top: 12px;\n    }\n\n    .action-btn {\n      padding: 6px 12px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      background: white;\n      font-size: 11px;\n      cursor: pointer;\n    }\n\n    .action-btn:hover {\n      background: #f5f5f5;\n    }\n\n    .action-btn.add {\n      color: #1976d2;\n      border-color: #1976d2;\n    }\n\n    .action-btn.clear {\n      color: #666;\n    }\n\n    .dialog-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 8px;\n    }\n\n    .btn-secondary {\n      padding: 8px 16px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      background: white;\n      font-size: 12px;\n      cursor: pointer;\n    }\n\n    .btn-secondary:hover {\n      background: #f5f5f5;\n    }\n\n    .btn-primary {\n      padding: 8px 16px;\n      border: none;\n      border-radius: 4px;\n      background: #1976d2;\n      color: white;\n      font-size: 12px;\n      cursor: pointer;\n    }\n\n    .btn-primary:hover:not(:disabled) {\n      background: #1565c0;\n    }\n\n    .btn-primary:disabled {\n      background: #ddd;\n      cursor: not-allowed;\n    }\n  `]\n})\nexport class ConnectionPointsImportDialogComponent {\n  @Input() visible = false;\n  @Output() visibleChange = new EventEmitter<boolean>();\n  @Output() import = new EventEmitter<ConnectionPoint[]>();\n\n  rows = signal<ConnectionPointRow[]>([\n    { name: '', x: 0, y: 0, z: 0 }\n  ]);\n\n  handlePaste(event: ClipboardEvent): void {\n    event.preventDefault();\n    const clipboardData = event.clipboardData;\n    if (!clipboardData) return;\n\n    const text = clipboardData.getData('text');\n    if (!text) return;\n\n    const parsedRows = this.parseExcelData(text);\n    if (parsedRows.length > 0) {\n      this.rows.set(parsedRows);\n    }\n  }\n\n  handleKeydown(event: KeyboardEvent): void {\n    // Allow Ctrl+V / Cmd+V to work when focused on container\n    if ((event.ctrlKey || event.metaKey) && event.key === 'v') {\n      // Let the paste event handle it\n      return;\n    }\n  }\n\n  parseExcelData(text: string): ConnectionPointRow[] {\n    const rows: ConnectionPointRow[] = [];\n    const lines = text.trim().split('\\n');\n\n    for (const line of lines) {\n      // Split by tab (Excel default) or multiple spaces\n      const cells = line.split(/\\t|(?:  +)/);\n\n      if (cells.length >= 4) {\n        const name = cells[0]?.trim() || '';\n        const x = parseFloat(cells[1]) || 0;\n        const y = parseFloat(cells[2]) || 0;\n        const z = parseFloat(cells[3]) || 0;\n\n        rows.push({ name, x, y, z });\n      } else if (cells.length >= 1 && cells[0]?.trim()) {\n        // Partial row - try to parse what we have\n        rows.push({\n          name: cells[0]?.trim() || '',\n          x: parseFloat(cells[1]) || 0,\n          y: parseFloat(cells[2]) || 0,\n          z: parseFloat(cells[3]) || 0,\n        });\n      }\n    }\n\n    return rows;\n  }\n\n  addRow(): void {\n    const currentRows = this.rows();\n    const count = currentRows.length + 1;\n    this.rows.set([\n      ...currentRows,\n      { name: `CP${count}`, x: 0, y: 0, z: 0 }\n    ]);\n  }\n\n  clearRows(): void {\n    this.rows.set([{ name: '', x: 0, y: 0, z: 0 }]);\n  }\n\n  hasValidData(): boolean {\n    return this.rows().some(row => row.name.trim() !== '');\n  }\n\n  getValidRowCount(): number {\n    return this.rows().filter(row => row.name.trim() !== '').length;\n  }\n\n  onImport(): void {\n    const validRows = this.rows().filter(row => row.name.trim() !== '');\n\n    const connectionPoints: ConnectionPoint[] = validRows.map(row => ({\n      id: crypto.randomUUID(),\n      name: row.name.trim(),\n      x: row.x,\n      y: row.y,\n      z: row.z,\n    }));\n\n    this.import.emit(connectionPoints);\n    this.close();\n  }\n\n  onCancel(): void {\n    this.close();\n  }\n\n  private close(): void {\n    this.visible = false;\n    this.visibleChange.emit(false);\n    // Reset to default state\n    this.rows.set([{ name: '', x: 0, y: 0, z: 0 }]);\n  }\n}\n","import {\n  Component,\n  ElementRef,\n  ViewChild,\n  OnInit,\n  OnDestroy,\n  AfterViewInit,\n  inject,\n  effect,\n  signal,\n} from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { ModelStateService } from '../../services/model-state.service';\nimport {\n  SceneManager,\n  CameraView,\n  createWaterPlane,\n  createSeabed,\n  createGrid,\n  createVesselGroup,\n  createConnectionPoint,\n  createCatenaryCable,\n  createLazyWaveFromPoints,\n  createTDPMarker,\n  createGlobalCoordinateSystem,\n  createVesselCoordinateSystem,\n  ViewHelper,\n  RISER_COLORS,\n} from '../../three';\nimport * as THREE from 'three';\n\n@Component({\n  selector: 'orcaflex-three-view',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  template: `\n    <div class=\"three-view-container\" #container>\n      <canvas #threeCanvas class=\"three-canvas\"></canvas>\n\n      <!-- ViewHelper canvas overlay -->\n      <canvas #viewHelperCanvas class=\"view-helper-canvas\" (click)=\"onViewHelperClick($event)\"></canvas>\n\n      <div class=\"view-controls\">\n        <button\n          [class.active]=\"currentView === 'iso'\"\n          (click)=\"setView('iso')\"\n          title=\"Isometric View\"\n        >\n          3D\n        </button>\n        <button\n          [class.active]=\"currentView === 'side'\"\n          (click)=\"setView('side')\"\n          title=\"Side View\"\n        >\n          Side\n        </button>\n        <button\n          [class.active]=\"currentView === 'top'\"\n          (click)=\"setView('top')\"\n          title=\"Top View\"\n        >\n          Top\n        </button>\n        <button\n          [class.active]=\"currentView === 'front'\"\n          (click)=\"setView('front')\"\n          title=\"Front View\"\n        >\n          Front\n        </button>\n        <button (click)=\"zoomToFit()\" title=\"Zoom to Fit (F)\">Fit</button>\n\n        <!-- Display options dropdown -->\n        <div class=\"dropdown\">\n          <button (click)=\"toggleDisplayMenu()\" title=\"Display Options\">\n            View\n          </button>\n          @if (displayMenuOpen()) {\n            <div class=\"dropdown-menu\">\n              <label class=\"menu-item\">\n                <input type=\"checkbox\" [checked]=\"showCoordinateSystems()\" (change)=\"toggleVisibility('coordinates')\" />\n                <span>Coordinate Systems</span>\n              </label>\n              <label class=\"menu-item\">\n                <input type=\"checkbox\" [checked]=\"showVessel()\" (change)=\"toggleVisibility('vessel')\" />\n                <span>Vessel</span>\n              </label>\n              <label class=\"menu-item\">\n                <input type=\"checkbox\" [checked]=\"showConnectionPoints()\" (change)=\"toggleVisibility('connectionPoints')\" />\n                <span>Connection Points</span>\n              </label>\n              <label class=\"menu-item\">\n                <input type=\"checkbox\" [checked]=\"showWater()\" (change)=\"toggleVisibility('water')\" />\n                <span>Water Surface</span>\n              </label>\n              <label class=\"menu-item\">\n                <input type=\"checkbox\" [checked]=\"showSeabed()\" (change)=\"toggleVisibility('seabed')\" />\n                <span>Seabed</span>\n              </label>\n              <label class=\"menu-item\">\n                <input type=\"checkbox\" [checked]=\"showGrid()\" (change)=\"toggleVisibility('grid')\" />\n                <span>Grid</span>\n              </label>\n            </div>\n          }\n        </div>\n      </div>\n    </div>\n  `,\n  styles: [`\n    :host {\n      display: block;\n      width: 100%;\n      height: 100%;\n    }\n\n    .three-view-container {\n      position: relative;\n      width: 100%;\n      height: 100%;\n    }\n\n    .three-canvas {\n      width: 100%;\n      height: 100%;\n      display: block;\n    }\n\n    .view-controls {\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      display: flex;\n      gap: 4px;\n      background: rgba(255, 255, 255, 0.9);\n      padding: 4px;\n      border-radius: 4px;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n    }\n\n    .view-controls button {\n      padding: 6px 10px;\n      border: 1px solid #ddd;\n      background: white;\n      border-radius: 3px;\n      font-size: 11px;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    .view-controls button:hover {\n      background: #f0f0f0;\n    }\n\n    .view-controls button.active {\n      background: var(--caris-primary, #1976d2);\n      color: white;\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .dropdown {\n      position: relative;\n    }\n\n    .dropdown-menu {\n      position: absolute;\n      top: 100%;\n      right: 0;\n      margin-top: 4px;\n      background: white;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      min-width: 160px;\n      z-index: 100;\n    }\n\n    .menu-item {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 8px 12px;\n      font-size: 11px;\n      cursor: pointer;\n      user-select: none;\n      border-bottom: 1px solid #eee;\n    }\n\n    .menu-item:last-child {\n      border-bottom: none;\n    }\n\n    .menu-item:hover {\n      background: #f5f5f5;\n    }\n\n    .menu-item input {\n      cursor: pointer;\n    }\n\n    .menu-item span {\n      color: #333;\n    }\n\n    .view-helper-canvas {\n      position: absolute;\n      bottom: 12px;\n      right: 12px;\n      width: 128px;\n      height: 128px;\n      cursor: pointer;\n    }\n  `]\n})\nexport class ThreeViewComponent implements OnInit, AfterViewInit, OnDestroy {\n  @ViewChild('threeCanvas', { static: true }) canvasRef!: ElementRef<HTMLCanvasElement>;\n  @ViewChild('container', { static: true }) containerRef!: ElementRef<HTMLDivElement>;\n  @ViewChild('viewHelperCanvas', { static: true }) viewHelperCanvasRef!: ElementRef<HTMLCanvasElement>;\n\n  private modelState = inject(ModelStateService);\n  private sceneManager: SceneManager | null = null;\n  private resizeObserver: ResizeObserver | null = null;\n\n  // ViewHelper with separate renderer\n  private viewHelper: ViewHelper | null = null;\n  private viewHelperRenderer: THREE.WebGLRenderer | null = null;\n  private clock = new THREE.Clock();\n\n  // Scene object references for visibility toggling\n  private globalCoordSystem: THREE.Group | null = null;\n  private vesselCoordSystems: THREE.Group[] = [];\n  private vesselGroups: THREE.Group[] = [];\n  private connectionPointGroups: THREE.Group[] = [];\n  private waterPlane: THREE.Mesh | null = null;\n  private seabedPlane: THREE.Mesh | null = null;\n  private gridHelper: THREE.GridHelper | null = null;\n\n  currentView: CameraView = 'iso';\n\n  // Display options\n  displayMenuOpen = signal<boolean>(false);\n  showCoordinateSystems = signal<boolean>(true);\n  showVessel = signal<boolean>(true);\n  showConnectionPoints = signal<boolean>(true);\n  showWater = signal<boolean>(true);\n  showSeabed = signal<boolean>(true);\n  showGrid = signal<boolean>(true);\n\n  constructor() {\n    // React to model state changes\n    effect(() => {\n      // Access signals to register as dependencies\n      void this.modelState.environment();\n      void this.modelState.vessels();\n      void this.modelState.risers();\n\n      // Rebuild scene when model changes\n      if (this.sceneManager) {\n        this.rebuildScene();\n      }\n    });\n  }\n\n  ngOnInit(): void {\n    // Initialize scene manager\n    this.sceneManager = new SceneManager();\n  }\n\n  ngAfterViewInit(): void {\n    const canvas = this.canvasRef.nativeElement;\n\n    // Initialize Three.js scene\n    this.sceneManager!.initialize(canvas);\n\n    // Setup resize observer\n    this.resizeObserver = new ResizeObserver(() => {\n      this.sceneManager?.onResize();\n    });\n    this.resizeObserver.observe(canvas.parentElement!);\n\n    // Setup ViewHelper with separate renderer\n    this.setupViewHelper();\n\n    // Build initial scene\n    this.rebuildScene();\n\n    // Start render loop with ViewHelper update\n    this.sceneManager!.startRenderLoop(() => {\n      this.renderViewHelper();\n    });\n\n    // Handle keyboard shortcuts\n    window.addEventListener('keydown', this.handleKeydown.bind(this));\n\n    // Close dropdown when clicking outside\n    document.addEventListener('click', this.closeMenuOnOutsideClick.bind(this));\n  }\n\n  ngOnDestroy(): void {\n    window.removeEventListener('keydown', this.handleKeydown.bind(this));\n    document.removeEventListener('click', this.closeMenuOnOutsideClick.bind(this));\n    this.resizeObserver?.disconnect();\n    this.sceneManager?.dispose();\n    this.viewHelper?.dispose();\n    this.viewHelperRenderer?.dispose();\n  }\n\n  /**\n   * Setup the ViewHelper with separate renderer\n   */\n  private setupViewHelper(): void {\n    if (!this.sceneManager) return;\n\n    const viewHelperCanvas = this.viewHelperCanvasRef.nativeElement;\n\n    // Create separate renderer for ViewHelper\n    this.viewHelperRenderer = new THREE.WebGLRenderer({\n      canvas: viewHelperCanvas,\n      alpha: true,\n      antialias: true,\n    });\n    this.viewHelperRenderer.setSize(128, 128);\n    this.viewHelperRenderer.setPixelRatio(window.devicePixelRatio);\n\n    // Create ViewHelper\n    const camera = this.sceneManager.getCamera();\n    this.viewHelper = new ViewHelper(camera);\n    this.viewHelper.controls = {\n      center: this.sceneManager.getControlsTarget()\n    };\n    this.viewHelper.setDimension(128);\n  }\n\n  /**\n   * Handle click on ViewHelper canvas\n   */\n  onViewHelperClick(event: MouseEvent): void {\n    if (!this.viewHelper || !this.sceneManager) return;\n\n    // Convert click to ViewHelper coordinates\n    const rect = (event.target as HTMLElement).getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n\n    // Create a fake event for the ViewHelper\n    const fakeEvent = {\n      clientX: rect.right - (128 - x),\n      clientY: rect.bottom - (128 - y),\n    } as MouseEvent;\n\n    this.viewHelper.handleClick(fakeEvent, this.viewHelperCanvasRef.nativeElement);\n  }\n\n  /**\n   * Render the ViewHelper (called in render loop)\n   */\n  private renderViewHelper(): void {\n    if (!this.viewHelper || !this.viewHelperRenderer) return;\n\n    // Update animation if active\n    if (this.viewHelper.animating) {\n      const delta = this.clock.getDelta();\n      this.viewHelper.update(delta);\n    }\n\n    // Render ViewHelper only if coordinate systems are visible\n    if (this.showCoordinateSystems()) {\n      // Render to the separate canvas\n      this.viewHelper.renderToCanvas(this.viewHelperRenderer);\n    } else {\n      this.viewHelperRenderer.clear();\n    }\n  }\n\n  /**\n   * Close dropdown menu when clicking outside\n   */\n  private closeMenuOnOutsideClick(event: MouseEvent): void {\n    const target = event.target as HTMLElement;\n    if (!target.closest('.dropdown')) {\n      this.displayMenuOpen.set(false);\n    }\n  }\n\n  /**\n   * Rebuild the 3D scene from current model state\n   */\n  private rebuildScene(): void {\n    if (!this.sceneManager) return;\n\n    // Clear existing objects and reset arrays\n    this.sceneManager.clearObjects();\n    this.vesselCoordSystems = [];\n    this.vesselGroups = [];\n    this.connectionPointGroups = [];\n\n    const env = this.modelState.environment();\n    const vessels = this.modelState.vessels();\n    const risers = this.modelState.risers();\n\n    // Add water surface\n    this.waterPlane = createWaterPlane() as THREE.Mesh;\n    this.waterPlane.visible = this.showWater();\n    this.sceneManager.add(this.waterPlane);\n\n    // Add seabed\n    this.seabedPlane = createSeabed(env.sea.waterDepth) as THREE.Mesh;\n    this.seabedPlane.visible = this.showSeabed();\n    this.sceneManager.add(this.seabedPlane);\n\n    // Add grid\n    this.gridHelper = createGrid() as THREE.GridHelper;\n    this.gridHelper.visible = this.showGrid();\n    this.sceneManager.add(this.gridHelper);\n\n    // Add global coordinate system at origin\n    this.globalCoordSystem = createGlobalCoordinateSystem(30);\n    this.globalCoordSystem.visible = this.showCoordinateSystems();\n    this.sceneManager.add(this.globalCoordSystem);\n\n    // Add vessels\n    vessels.forEach((vessel) => {\n      const vesselGroup = createVesselGroup(\n        {\n          length: vessel.length,\n          breadth: vessel.breadth,\n          depth: vessel.depth,\n          draft: vessel.draft,\n        },\n        vessel.position\n      );\n      // Apply vessel heading rotation\n      vesselGroup.rotation.z = (vessel.orientation?.heading ?? 0) * Math.PI / 180;\n      vesselGroup.visible = this.showVessel();\n      this.sceneManager!.add(vesselGroup);\n      this.vesselGroups.push(vesselGroup);\n\n      // Add vessel local coordinate system\n      const vesselCoordSys = createVesselCoordinateSystem(15);\n      vesselCoordSys.position.set(vessel.position.x, vessel.position.y, vessel.position.z);\n      vesselCoordSys.rotation.z = (vessel.orientation?.heading ?? 0) * Math.PI / 180;\n      vesselCoordSys.visible = this.showCoordinateSystems();\n      this.sceneManager!.add(vesselCoordSys);\n      this.vesselCoordSystems.push(vesselCoordSys);\n\n      // Add connection points (separate visibility from vessel)\n      vessel.connectionPoints.forEach((cp) => {\n        // Transform connection point by vessel heading\n        const headingRad = (vessel.orientation?.heading ?? 0) * Math.PI / 180;\n        const cosH = Math.cos(headingRad);\n        const sinH = Math.sin(headingRad);\n        const cpX = vessel.position.x + (cp.x * cosH - cp.y * sinH);\n        const cpY = vessel.position.y + (cp.x * sinH + cp.y * cosH);\n        const cpZ = vessel.position.z + cp.z;\n\n        const cpGroup = createConnectionPoint({ x: cpX, y: cpY, z: cpZ }, cp.name);\n        cpGroup.visible = this.showConnectionPoints();\n        this.sceneManager!.add(cpGroup);\n        this.connectionPointGroups.push(cpGroup);\n      });\n    });\n\n    // Add risers with calculation results\n    console.log('Rendering risers:', risers.length, risers.map(r => ({ name: r.name, hasResults: !!r.calculationResults, pointsCount: r.calculationResults?.points?.length })));\n    risers.forEach((riser, index) => {\n      if (!riser.calculationResults) {\n        console.log(`Riser ${riser.name}: no calculation results, skipping`);\n        return;\n      }\n\n      console.log(`Riser ${riser.name}: rendering with ${riser.calculationResults.points?.length || 0} points`);\n      // Use active content color, or fallback to default riser colors\n      const activeContent = riser.contents?.find(c => c.id === riser.activeContentId);\n      const color = activeContent?.color ?? RISER_COLORS[index % RISER_COLORS.length];\n\n      // Find vessel and connection point\n      const vessel = vessels.find((v) => v.id === riser.vesselId);\n      const cp = vessel?.connectionPoints.find((c) => c.id === riser.connectionPointId);\n\n      // Calculate vessel heading and riser azimuth\n      const vesselHeadingDeg = vessel?.orientation?.heading ?? 0;\n      const riserAzimuthDeg = riser.geometry.azimuth ?? 0;\n      // Total rotation: vessel heading + riser azimuth\n      // Azimuth 0 = vessel's local X direction, 90 = vessel's local Y direction\n      const totalRotationDeg = vesselHeadingDeg + riserAzimuthDeg;\n      const totalRotationRad = totalRotationDeg * Math.PI / 180;\n\n      // Calculate hangoff position in global coordinates\n      const vesselHeadingRad = vesselHeadingDeg * Math.PI / 180;\n      const cosH = Math.cos(vesselHeadingRad);\n      const sinH = Math.sin(vesselHeadingRad);\n      const hangoffX = (vessel?.position.x ?? 0) + ((cp?.x ?? 0) * cosH - (cp?.y ?? 0) * sinH);\n      const hangoffY = (vessel?.position.y ?? 0) + ((cp?.x ?? 0) * sinH + (cp?.y ?? 0) * cosH);\n      const hangoffZ = (vessel?.position.z ?? 0) + (cp?.z ?? 0);\n\n      if (riser.geometry.type === 'catenary' && riser.calculationResults.points.length > 0) {\n        // Create catenary cable\n        const cable = createCatenaryCable(riser.calculationResults.points, { color });\n        cable.position.set(hangoffX, hangoffY, hangoffZ);\n        // Rotate cable according to azimuth (0 = X direction, 90 = Y direction)\n        cable.rotation.z = totalRotationRad;\n        this.sceneManager!.add(cable);\n\n        // Add TDP marker at rotated position\n        if (riser.calculationResults.tdpPosition) {\n          const tdpLocalX = riser.calculationResults.tdpPosition.x;\n          const tdpLocalY = riser.calculationResults.tdpPosition.y;\n          const cosTot = Math.cos(totalRotationRad);\n          const sinTot = Math.sin(totalRotationRad);\n          const tdpGlobalX = hangoffX + (tdpLocalX * cosTot - tdpLocalY * sinTot);\n          const tdpGlobalY = hangoffY + (tdpLocalX * sinTot + tdpLocalY * cosTot);\n\n          const tdp = createTDPMarker(tdpGlobalX, tdpGlobalY, env.sea.waterDepth, color);\n          this.sceneManager!.add(tdp);\n        }\n      } else if (riser.geometry.type === 'lazy-wave' && riser.calculationResults.points && riser.calculationResults.points.length > 0) {\n        // Create lazy wave riser from points\n        // API returns points as {x, y, z} where z is depth (negative)\n        const allPoints = riser.calculationResults.points.map((p: any) => ({\n          x: p.x,\n          y: 0,\n          z: p.z, // z is already negative depth from API\n        }));\n\n        // Get buoyancy module configuration for visualization\n        const buoyancyModule = this.modelState.buoyancyModules().find(\n          bm => bm.id === riser.buoyancyModuleId\n        );\n\n        console.log('Rendering lazy wave with', allPoints.length, 'points');\n        const lazyWave = createLazyWaveFromPoints(allPoints, {\n          color,\n          buoyancyStartX: riser.geometry.buoyancyStart,\n          buoyancyEndX: riser.geometry.buoyancyEnd,\n          buoyancyStart: riser.calculationResults.buoyancyStart,\n          buoyancyEnd: riser.calculationResults.buoyancyEnd,\n          buoyancyModule: buoyancyModule ? {\n            outerDiameter: buoyancyModule.outerDiameter,\n            length: buoyancyModule.length,\n            numberOfModules: buoyancyModule.numberOfModules,\n            spacing: buoyancyModule.spacing,\n          } : undefined,\n        });\n        lazyWave.position.set(hangoffX, hangoffY, hangoffZ);\n        // Rotate lazy wave according to azimuth\n        lazyWave.rotation.z = totalRotationRad;\n        this.sceneManager!.add(lazyWave);\n\n        // Add TDP marker for lazy wave at rotated position\n        if (riser.calculationResults.tdpPosition) {\n          const tdpLocalX = riser.calculationResults.tdpPosition.x;\n          const tdpLocalY = riser.calculationResults.tdpPosition.y;\n          const cosTot = Math.cos(totalRotationRad);\n          const sinTot = Math.sin(totalRotationRad);\n          const tdpGlobalX = hangoffX + (tdpLocalX * cosTot - tdpLocalY * sinTot);\n          const tdpGlobalY = hangoffY + (tdpLocalX * sinTot + tdpLocalY * cosTot);\n\n          const tdp = createTDPMarker(tdpGlobalX, tdpGlobalY, env.sea.waterDepth, color);\n          this.sceneManager!.add(tdp);\n        }\n      }\n    });\n\n    // Update scene bounds based on water depth\n    this.sceneManager.updateSceneBounds({\n      min: { x: -100, y: -100, z: -env.sea.waterDepth - 50 },\n      max: { x: 400, y: 100, z: 50 },\n    });\n  }\n\n  /**\n   * Set camera view\n   */\n  setView(view: CameraView): void {\n    this.currentView = view;\n    this.sceneManager?.setCamera(view);\n  }\n\n  /**\n   * Zoom to fit all objects\n   */\n  zoomToFit(): void {\n    this.sceneManager?.zoomToFit();\n  }\n\n  /**\n   * Toggle display options menu\n   */\n  toggleDisplayMenu(): void {\n    this.displayMenuOpen.set(!this.displayMenuOpen());\n  }\n\n  /**\n   * Toggle visibility of scene elements\n   */\n  toggleVisibility(element: 'coordinates' | 'vessel' | 'connectionPoints' | 'water' | 'seabed' | 'grid'): void {\n    switch (element) {\n      case 'coordinates':\n        const coordVisible = !this.showCoordinateSystems();\n        this.showCoordinateSystems.set(coordVisible);\n        if (this.globalCoordSystem) {\n          this.globalCoordSystem.visible = coordVisible;\n        }\n        this.vesselCoordSystems.forEach(vcs => {\n          vcs.visible = coordVisible;\n        });\n        break;\n\n      case 'vessel':\n        const vesselVisible = !this.showVessel();\n        this.showVessel.set(vesselVisible);\n        this.vesselGroups.forEach(vg => {\n          vg.visible = vesselVisible;\n        });\n        break;\n\n      case 'connectionPoints':\n        const cpVisible = !this.showConnectionPoints();\n        this.showConnectionPoints.set(cpVisible);\n        this.connectionPointGroups.forEach(cp => {\n          cp.visible = cpVisible;\n        });\n        break;\n\n      case 'water':\n        const waterVisible = !this.showWater();\n        this.showWater.set(waterVisible);\n        if (this.waterPlane) {\n          this.waterPlane.visible = waterVisible;\n        }\n        break;\n\n      case 'seabed':\n        const seabedVisible = !this.showSeabed();\n        this.showSeabed.set(seabedVisible);\n        if (this.seabedPlane) {\n          this.seabedPlane.visible = seabedVisible;\n        }\n        break;\n\n      case 'grid':\n        const gridVisible = !this.showGrid();\n        this.showGrid.set(gridVisible);\n        if (this.gridHelper) {\n          this.gridHelper.visible = gridVisible;\n        }\n        break;\n    }\n  }\n\n  /**\n   * Handle keyboard shortcuts\n   */\n  private handleKeydown(event: KeyboardEvent): void {\n    // Only handle if canvas is focused or no input is focused\n    const activeElement = document.activeElement;\n    if (activeElement instanceof HTMLInputElement || activeElement instanceof HTMLTextAreaElement) {\n      return;\n    }\n\n    switch (event.key.toLowerCase()) {\n      case 'f':\n        this.zoomToFit();\n        break;\n      case '1':\n        this.setView('iso');\n        break;\n      case '2':\n        this.setView('side');\n        break;\n      case '3':\n        this.setView('top');\n        break;\n      case '4':\n        this.setView('front');\n        break;\n    }\n  }\n}\n","/**\n * Catenary cable creator\n */\n\nimport * as THREE from 'three';\nimport { RISER_COLORS } from '../config';\nimport { CatenaryPoint } from '../../types';\n\nexport interface CatenaryOptions {\n  color?: number;\n  lineRadius?: number;\n}\n\n/**\n * Create a catenary cable from calculated points\n */\nexport function createCatenaryCable(\n  points: CatenaryPoint[],\n  options: CatenaryOptions = {}\n): THREE.Group {\n  const { color = RISER_COLORS[0], lineRadius = 0.15 } = options;\n\n  const group = new THREE.Group();\n  group.name = 'CatenaryCable';\n  group.userData = {\n    type: 'catenaryCable',\n    pointCount: points.length,\n  };\n\n  const material = new THREE.MeshBasicMaterial({ color });\n\n  // Create thick line using cylinders between consecutive points\n  for (let i = 0; i < points.length - 1; i++) {\n    const start = new THREE.Vector3(points[i].x, 0, -points[i].y);\n    const end = new THREE.Vector3(points[i + 1].x, 0, -points[i + 1].y);\n\n    const direction = new THREE.Vector3().subVectors(end, start);\n    const distance = direction.length();\n\n    if (distance < 0.001) continue;\n\n    const geometry = new THREE.CylinderGeometry(lineRadius, lineRadius, distance, 8);\n    const cylinder = new THREE.Mesh(geometry, material);\n\n    // Position at midpoint\n    const midpoint = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);\n    cylinder.position.copy(midpoint);\n\n    // Orient along line direction\n    cylinder.lookAt(end);\n    cylinder.rotateX(Math.PI / 2);\n\n    group.add(cylinder);\n  }\n\n  return group;\n}\n\n/**\n * Create a catenary cable from 3D coordinate arrays\n */\nexport function createCatenaryFromCoords(\n  coords: Array<[number, number, number]>,\n  options: CatenaryOptions = {}\n): THREE.Group {\n  const { color = RISER_COLORS[0], lineRadius = 0.15 } = options;\n\n  const group = new THREE.Group();\n  group.name = 'CatenaryCable';\n  group.userData = {\n    type: 'catenaryCable',\n    pointCount: coords.length,\n  };\n\n  const material = new THREE.MeshBasicMaterial({ color });\n\n  for (let i = 0; i < coords.length - 1; i++) {\n    const start = new THREE.Vector3(coords[i][0], coords[i][1], coords[i][2]);\n    const end = new THREE.Vector3(coords[i + 1][0], coords[i + 1][1], coords[i + 1][2]);\n\n    const direction = new THREE.Vector3().subVectors(end, start);\n    const distance = direction.length();\n\n    if (distance < 0.001) continue;\n\n    const geometry = new THREE.CylinderGeometry(lineRadius, lineRadius, distance, 8);\n    const cylinder = new THREE.Mesh(geometry, material);\n\n    const midpoint = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);\n    cylinder.position.copy(midpoint);\n\n    cylinder.lookAt(end);\n    cylinder.rotateX(Math.PI / 2);\n\n    group.add(cylinder);\n  }\n\n  return group;\n}\n\n/**\n * Create TDP marker on seabed\n */\nexport function createTDPMarker(\n  x: number,\n  y: number,\n  depth: number,\n  color: number = 0xffeb3b\n): THREE.Mesh {\n  const geometry = new THREE.SphereGeometry(1.5, 16, 16);\n  const material = new THREE.MeshBasicMaterial({ color });\n\n  const mesh = new THREE.Mesh(geometry, material);\n  mesh.position.set(x, y, -depth);\n  mesh.userData = {\n    type: 'tdpMarker',\n    name: 'Touch Down Point',\n    position: { x, y, z: -depth },\n  };\n\n  return mesh;\n}\n","/**\n * Line type configuration for OrcaFlex model\n *\n * Units:\n * - Diameters: stored in meters, displayed in mm\n * - Masses: kg/m (mass per unit length)\n * - Stiffnesses: stored in kN (axial) or kNm (bending/torsional)\n * - Density: kg/m\n */\n\nexport interface LineTypeConfig {\n  id: string;\n  name: string;\n  category?: string;\n\n  // Geometry (stored in meters)\n  outerDiameter: number;  // m\n  innerDiameter: number;  // m\n\n  // Mass properties (kg/m)\n  dryMass: number;        // Mass per unit length in air (kg/m)\n  wetMass?: number;       // Apparent mass in water (kg/m) - calculated or input\n  pipeDensity?: number;   // Material density (kg/m) - calculated or input\n\n  // Stiffness properties\n  bendingStiffness: number;    // EI (kNm)\n  axialStiffness: number;      // EA (kN)\n  torsionalStiffness?: number; // GJ (kNm)\n  poissonRatio?: number;\n\n  // Limits\n  allowableTension?: number;   // kN\n  minBendRadius?: number;      // m\n\n  // Hydrodynamic coefficients\n  dragCoefficients: {\n    normal: number;\n    axial: number;\n  };\n  addedMassCoefficients: {\n    normal: number;\n    axial: number;\n  };\n}\n\nexport interface BuoyancyModuleConfig {\n  id: string;\n  name: string;\n  outerDiameter: number;     // m (outer diameter of module)\n  length: number;            // m (length of single module)\n  dryMass: number;           // kg (mass in air per module)\n  apparentMassInWater: number; // kg (negative = buoyant, per module)\n  dragCoefficient: number;\n  // Installation configuration\n  numberOfModules: number;   // Number of modules installed\n  spacing: number;           // m (center-to-center spacing between modules)\n}\n\n/**\n * Calculate net buoyancy force per module in Newtons\n * Negative apparent mass = positive buoyancy\n */\nexport function calculateModuleBuoyancy(module: BuoyancyModuleConfig): number {\n  return -module.apparentMassInWater * 9.81; // N per module\n}\n\n/**\n * Calculate total buoyancy section length\n * Length = (n-1) * spacing + n * module_length\n * But typically spacing is center-to-center, so:\n * Length = (n-1) * spacing + module_length (first to last module end)\n */\nexport function calculateBuoyancySectionLength(module: BuoyancyModuleConfig): number {\n  if (module.numberOfModules <= 0) return 0;\n  if (module.numberOfModules === 1) return module.length;\n  // Center-to-center: first module starts at 0, last module center at (n-1)*spacing\n  // Total length from first module start to last module end\n  return (module.numberOfModules - 1) * module.spacing + module.length;\n}\n\n/**\n * Calculate effective buoyancy weight per meter for API\n * This is the net upward force per unit length in the buoyancy section\n */\nexport function calculateBuoyancyWeightPerMeter(module: BuoyancyModuleConfig): number {\n  const totalBuoyancy = module.numberOfModules * calculateModuleBuoyancy(module);\n  const sectionLength = calculateBuoyancySectionLength(module);\n  if (sectionLength <= 0) return 0;\n  return totalBuoyancy / sectionLength; // N/m\n}\n\n/**\n * Calculate wet mass from dry mass and geometry\n * wetMass = dryMass - displaced_water_mass\n * displaced_water_mass = /4 * OD * waterDensity\n */\nexport function calculateWetMass(\n  lineType: LineTypeConfig,\n  waterDensity: number = 1025\n): number {\n  const outerArea = Math.PI * Math.pow(lineType.outerDiameter / 2, 2);\n  const displacedMass = outerArea * waterDensity; // kg/m\n  return lineType.dryMass - displacedMass;\n}\n\n/**\n * Calculate dry mass from wet mass and geometry\n * dryMass = wetMass + displaced_water_mass\n */\nexport function calculateDryMass(\n  wetMass: number,\n  outerDiameter: number,\n  waterDensity: number = 1025\n): number {\n  const outerArea = Math.PI * Math.pow(outerDiameter / 2, 2);\n  const displacedMass = outerArea * waterDensity; // kg/m\n  return wetMass + displacedMass;\n}\n\n/**\n * Calculate pipe material density from dry mass and geometry\n * density = dryMass / cross_section_area\n */\nexport function calculatePipeDensity(lineType: LineTypeConfig): number {\n  const outerArea = Math.PI * Math.pow(lineType.outerDiameter / 2, 2);\n  const innerArea = Math.PI * Math.pow(lineType.innerDiameter / 2, 2);\n  const crossSectionArea = outerArea - innerArea;\n  if (crossSectionArea <= 0) return 0;\n  return lineType.dryMass / crossSectionArea;\n}\n\n/**\n * Calculate dry mass from density and geometry\n */\nexport function calculateDryMassFromDensity(\n  density: number,\n  outerDiameter: number,\n  innerDiameter: number\n): number {\n  const outerArea = Math.PI * Math.pow(outerDiameter / 2, 2);\n  const innerArea = Math.PI * Math.pow(innerDiameter / 2, 2);\n  const crossSectionArea = outerArea - innerArea;\n  return density * crossSectionArea;\n}\n\n/**\n * Calculate submerged weight (N/m) from wet mass\n */\nexport function calculateSubmergedWeight(\n  lineType: LineTypeConfig,\n  waterDensity: number = 1025\n): number {\n  const wetMass = calculateWetMass(lineType, waterDensity);\n  return wetMass * 9.81; // Convert kg/m to N/m\n}\n\n/**\n * Calculate effective weight with content\n * Includes pipe weight, content weight, and buoyancy\n */\nexport function calculateEffectiveWeight(\n  lineType: LineTypeConfig,\n  contentDensity: number,\n  waterDensity: number = 1025\n): number {\n  const innerArea = Math.PI * Math.pow(lineType.innerDiameter / 2, 2);\n  const outerArea = Math.PI * Math.pow(lineType.outerDiameter / 2, 2);\n\n  // Weight of pipe\n  const pipeWeight = lineType.dryMass * 9.81;\n\n  // Weight of content\n  const contentMass = innerArea * contentDensity;\n  const contentWeight = contentMass * 9.81;\n\n  // Buoyancy (based on outer diameter)\n  const displacedMass = outerArea * waterDensity;\n  const buoyancy = displacedMass * 9.81;\n\n  return pipeWeight + contentWeight - buoyancy;\n}\n\n// Default 10\" Flexible Riser based on OrcaFlex specs\nexport const DEFAULT_LINE_TYPES: LineTypeConfig[] = [\n  {\n    id: 'flexible-riser',\n    name: '10\" Flexible Riser',\n    category: 'General',\n    outerDiameter: 0.3556,      // 355.6 mm\n    innerDiameter: 0.254,        // 254 mm (10\")\n    dryMass: 184.2262,           // kg/m\n    bendingStiffness: 124.87,    // kNm (EI)\n    axialStiffness: 711200,      // kN (EA = 711.2e3)\n    torsionalStiffness: 10,      // kNm (GJ)\n    poissonRatio: 0.5,\n    allowableTension: 5000,      // kN\n    minBendRadius: 3.675,        // m\n    dragCoefficients: { normal: 1.2, axial: 0.008 },\n    addedMassCoefficients: { normal: 1.0, axial: 0.0 },\n  },\n];\n\n// 10\" Buoyancy Module based on reference specifications\nexport const DEFAULT_BUOYANCY_MODULE: BuoyancyModuleConfig = {\n  id: 'buoyancy-1',\n  name: '10\" Buoyancy Module',\n  outerDiameter: 1.45,           // 1450 mm\n  length: 1.6,                   // 1600 mm\n  dryMass: 855.7,                // kg (mass in air)\n  apparentMassInWater: -1220,    // kg (negative = buoyant)\n  dragCoefficient: 0.8,\n  numberOfModules: 6,            // Default 6 modules\n  spacing: 12,                   // 12m center-to-center spacing\n};\n","import { Component, inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ModelStateService } from '../../services/model-state.service';\n\n@Component({\n  selector: 'orcaflex-results-section',\n  standalone: true,\n  imports: [CommonModule],\n  template: `\n    <div class=\"section-content\">\n      @if (selectedRiser(); as riser) {\n        @if (riser.calculationResults; as results) {\n          <div class=\"results-grid\">\n            <div class=\"result-item\">\n              <span class=\"label\">Total Length</span>\n              <span class=\"value\">{{ results.totalLength | number:'1.1-1' }} m</span>\n            </div>\n            <div class=\"result-item\">\n              <span class=\"label\">Max Tension</span>\n              <span class=\"value\">{{ results.maxTension | number:'1.0-0' }} kN</span>\n            </div>\n            <div class=\"result-item\">\n              <span class=\"label\">Min Tension</span>\n              <span class=\"value\">{{ results.minTension | number:'1.0-0' }} kN</span>\n            </div>\n            <div class=\"result-item\">\n              <span class=\"label\">TDP Position</span>\n              <span class=\"value\">\n                ({{ results.tdpPosition.x | number:'1.1-1' }},\n                {{ results.tdpPosition.y | number:'1.1-1' }})\n              </span>\n            </div>\n            @if (results.sagBendRadius) {\n              <div class=\"result-item\">\n                <span class=\"label\">Sag Bend Radius</span>\n                <span class=\"value\">{{ results.sagBendRadius | number:'1.0-0' }} m</span>\n              </div>\n            }\n            @if (results.hogBendRadius) {\n              <div class=\"result-item\">\n                <span class=\"label\">Hog Bend Radius</span>\n                <span class=\"value\">{{ results.hogBendRadius | number:'1.0-0' }} m</span>\n              </div>\n            }\n          </div>\n\n          @if (results.segments && results.segments.length > 0) {\n            <div class=\"segments-section\">\n              <h4>Segments</h4>\n              @for (segment of results.segments; track segment.name) {\n                <div class=\"segment-row\">\n                  <span class=\"segment-name\">{{ segment.name }}</span>\n                  <span class=\"segment-length\">{{ segment.length | number:'1.1-1' }} m</span>\n                </div>\n              }\n            </div>\n          }\n        } @else {\n          <div class=\"no-results\">\n            <p>No calculation results</p>\n            <p class=\"hint\">Click \"Calculate\" in the Risers panel</p>\n          </div>\n        }\n      } @else {\n        <div class=\"no-selection\">\n          Select a riser to view results\n        </div>\n      }\n    </div>\n  `,\n  styles: [`\n    .section-content {\n      padding: 8px;\n    }\n\n    .results-grid {\n      display: grid;\n      gap: 8px;\n    }\n\n    .result-item {\n      display: flex;\n      justify-content: space-between;\n      padding: 8px 12px;\n      background: var(--caris-bg-subtle, #f5f5f5);\n      border-radius: 4px;\n    }\n\n    .label {\n      font-size: 11px;\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .value {\n      font-size: 12px;\n      font-weight: 500;\n      font-family: monospace;\n    }\n\n    .segments-section {\n      margin-top: 16px;\n      padding-top: 12px;\n      border-top: 1px solid var(--caris-border-light, #eee);\n    }\n\n    .segments-section h4 {\n      font-size: 11px;\n      font-weight: 600;\n      color: var(--caris-text-secondary, #666);\n      margin: 0 0 8px 0;\n      text-transform: uppercase;\n    }\n\n    .segment-row {\n      display: flex;\n      justify-content: space-between;\n      padding: 6px 8px;\n      border-bottom: 1px solid var(--caris-border-light, #eee);\n      font-size: 12px;\n    }\n\n    .segment-row:last-child {\n      border-bottom: none;\n    }\n\n    .segment-name {\n      color: var(--caris-text-primary, #333);\n    }\n\n    .segment-length {\n      color: var(--caris-text-secondary, #666);\n      font-family: monospace;\n    }\n\n    .no-results, .no-selection {\n      text-align: center;\n      padding: 24px;\n      color: var(--caris-text-secondary, #999);\n    }\n\n    .no-results p {\n      margin: 0 0 4px 0;\n      font-size: 12px;\n    }\n\n    .hint {\n      font-size: 11px;\n      color: var(--caris-text-tertiary, #bbb);\n    }\n\n    .no-selection {\n      font-size: 12px;\n    }\n  `]\n})\nexport class ResultsSectionComponent {\n  private modelState = inject(ModelStateService);\n\n  selectedRiser = this.modelState.selectedRiser;\n}\n","/**\n * Riser configuration types for OrcaFlex model\n */\n\nexport type RiserType = 'catenary' | 'lazy-wave' | 'steep-wave' | 'pliant-wave';\n\nexport interface Point3D {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport interface CatenaryPoint {\n  x: number;\n  y: number;\n  s: number;\n  angle: number;\n}\n\nexport interface CatenaryConfig {\n  type: 'catenary';\n  hangoffPoint: Point3D;\n  azimuth: number;\n  departureAngle: number;\n  tdpX?: number;\n  tdpY?: number;\n  layback?: number;\n  totalLength?: number;\n}\n\nexport interface LazyWaveConfig {\n  type: 'lazy-wave';\n  hangoffPoint: Point3D;\n  azimuth: number;\n  departureAngle: number;\n  sagBend: number;\n  hogBend: number;\n  buoyancyStart?: number;\n  buoyancyEnd?: number;\n  tdpX?: number;\n  tdpY?: number;\n}\n\nexport type RiserGeometryConfig = CatenaryConfig | LazyWaveConfig;\n\n/**\n * Content configuration for a riser\n * Each content represents a different fill state (empty, seawater, oil, etc.)\n */\nexport interface ContentConfig {\n  id: string;\n  name: string;\n  density: number;  // kg/m (0 = empty/air, 1025 = seawater)\n  color?: number;   // Optional color override for visualization\n}\n\nexport interface RiserConfig {\n  id: string;\n  name: string;\n  lineTypeId: string;\n  buoyancyModuleId?: string;\n  vesselId: string;\n  connectionPointId: string;\n  geometry: RiserGeometryConfig;\n  contents: ContentConfig[];  // Multiple content configurations\n  activeContentId?: string;   // Currently selected content for calculation\n  calculationResults?: RiserCalculationResult;\n}\n\nexport interface RiserCalculationResult {\n  totalLength: number;\n  tdpPosition: Point3D;\n  maxTension: number;\n  minTension: number;\n  sagBendRadius?: number;\n  hogBendRadius?: number;\n  points: CatenaryPoint[];\n  segments?: RiserSegment[];\n  buoyancyStart?: { x: number; z: number };\n  buoyancyEnd?: { x: number; z: number };\n}\n\nexport interface RiserSegment {\n  name: string;\n  type: 'line' | 'buoyancy';\n  startPoint: Point3D;\n  endPoint: Point3D;\n  length: number;\n  points: CatenaryPoint[];\n}\n\nexport interface CatenaryRequest {\n  method: 'layback' | 'point_angle' | 'tdp_tension';\n  weight: number;\n  height: number;\n  horizontalDistance?: number;\n  departureAngle?: number;\n  tension?: number;\n  numPoints?: number;\n}\n\nexport interface CatenaryResult {\n  horizontalTension: number;\n  totalLength: number;\n  tdpPosition: { x: number; y: number };\n  departureAngle: number;\n  tdpAngle: number;\n  points: CatenaryPoint[];\n}\n\nexport interface LazyWaveRequest {\n  waterDepth: number;\n  lineWeight: number;\n  buoyancyWeight: number;\n  sag: number;\n  hog: number;\n  departureAngle?: number;\n  tdpDistance?: number;\n  pointsPerSegment?: number;\n}\n\nexport interface LazyWaveResult {\n  totalLength: number;\n  hangoffTension: number;\n  tdpPosition: { x: number; y: number };\n  sagBendPosition: { x: number; y: number };\n  hogBendPosition: { x: number; y: number };\n  buoyancyStart: number;\n  buoyancyEnd: number;\n  segments: RiserSegment[];\n}\n\n/**\n * Default content configurations\n */\nexport const DEFAULT_CONTENTS: ContentConfig[] = [\n  {\n    id: 'empty',\n    name: 'Empty (Air)',\n    density: 0,\n    color: 0x4a90d9,  // Blue\n  },\n  {\n    id: 'seawater',\n    name: 'Seawater',\n    density: 1025,\n    color: 0x2e7d32,  // Green\n  },\n];\n\nexport const DEFAULT_RISER: RiserConfig = {\n  id: 'riser-1',\n  name: 'Riser 1',\n  lineTypeId: 'flexible-riser',\n  vesselId: 'vessel-1',\n  connectionPointId: 'cp-1',\n  geometry: {\n    type: 'catenary',\n    hangoffPoint: { x: 50, y: 0, z: -10 },\n    azimuth: 180,\n    departureAngle: 80,\n  },\n  contents: DEFAULT_CONTENTS,\n  activeContentId: 'empty',\n};\n","/**\n * Scene Manager for Three.js visualization\n * Manages scene, camera, lights, and controls\n */\n\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport {\n  SceneBounds,\n  CameraPositions,\n  DEFAULT_CAMERA_POSITIONS,\n  DEFAULT_SCENE_BOUNDS,\n} from './config';\n\nexport type CameraView = 'side' | 'top' | 'front' | 'iso';\n\nexport class SceneManager {\n  private scene: THREE.Scene;\n  private camera: THREE.PerspectiveCamera;\n  private renderer: THREE.WebGLRenderer;\n  private controls: OrbitControls;\n  private animationId: number | null = null;\n\n  private cameraPositions: CameraPositions;\n  private sceneBounds: SceneBounds;\n  private currentView: CameraView = 'iso';\n\n  constructor() {\n    this.scene = new THREE.Scene();\n    this.camera = new THREE.PerspectiveCamera(45, 1, 1, 5000);\n    this.renderer = new THREE.WebGLRenderer({ antialias: true });\n    this.controls = null!;\n    this.cameraPositions = { ...DEFAULT_CAMERA_POSITIONS };\n    this.sceneBounds = { ...DEFAULT_SCENE_BOUNDS };\n  }\n\n  /**\n   * Initialize the scene with a canvas element\n   */\n  initialize(canvas: HTMLCanvasElement): void {\n    // Setup renderer\n    this.renderer = new THREE.WebGLRenderer({\n      canvas,\n      antialias: true,\n    });\n    this.renderer.setSize(canvas.clientWidth, canvas.clientHeight);\n    this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n    this.renderer.shadowMap.enabled = true;\n    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n\n    // Setup scene\n    this.scene = new THREE.Scene();\n    this.setupBackground();\n\n    // Setup camera\n    const aspect = canvas.clientWidth / canvas.clientHeight;\n    this.camera = new THREE.PerspectiveCamera(45, aspect, 1, 5000);\n\n    // Setup controls\n    this.controls = new OrbitControls(this.camera, this.renderer.domElement);\n    this.controls.enableDamping = true;\n    this.controls.dampingFactor = 0.05;\n    this.controls.screenSpacePanning = true;\n    this.controls.minDistance = 10;\n    this.controls.maxDistance = 2000;\n\n    // Setup lights\n    this.setupLights();\n\n    // Set initial camera position\n    this.setCamera('iso');\n  }\n\n  /**\n   * Setup scene background with gradient\n   */\n  private setupBackground(): void {\n    // Create gradient background\n    const canvas = document.createElement('canvas');\n    canvas.width = 2;\n    canvas.height = 512;\n    const ctx = canvas.getContext('2d')!;\n\n    const gradient = ctx.createLinearGradient(0, 0, 0, 512);\n    gradient.addColorStop(0, '#1a237e');   // Deep blue (sky)\n    gradient.addColorStop(0.5, '#0d47a1'); // Medium blue\n    gradient.addColorStop(1, '#01579b');   // Light blue (water)\n\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, 2, 512);\n\n    const texture = new THREE.CanvasTexture(canvas);\n    texture.magFilter = THREE.LinearFilter;\n    this.scene.background = texture;\n  }\n\n  /**\n   * Setup scene lighting\n   */\n  private setupLights(): void {\n    // Ambient light for general illumination\n    const ambient = new THREE.AmbientLight(0xffffff, 0.5);\n    this.scene.add(ambient);\n\n    // Main directional light (sun)\n    const directional = new THREE.DirectionalLight(0xffffff, 0.8);\n    directional.position.set(200, 200, 200);\n    directional.castShadow = true;\n    directional.shadow.camera.left = -500;\n    directional.shadow.camera.right = 500;\n    directional.shadow.camera.top = 500;\n    directional.shadow.camera.bottom = -500;\n    directional.shadow.camera.near = 0.5;\n    directional.shadow.camera.far = 2000;\n    directional.shadow.mapSize.width = 2048;\n    directional.shadow.mapSize.height = 2048;\n    this.scene.add(directional);\n\n    // Fill light from opposite direction\n    const fill = new THREE.DirectionalLight(0xffffff, 0.3);\n    fill.position.set(-200, -200, 100);\n    this.scene.add(fill);\n  }\n\n  /**\n   * Set camera to a predefined view\n   */\n  setCamera(view: CameraView): void {\n    this.currentView = view;\n    const pos = this.cameraPositions[view];\n\n    this.camera.position.set(pos.position.x, pos.position.y, pos.position.z);\n    this.camera.up.set(pos.up.x, pos.up.y, pos.up.z);\n    this.camera.lookAt(0, 0, 0);\n\n    this.controls.target.set(0, 0, 0);\n    this.controls.update();\n\n    // Zoom to fit after a short delay\n    setTimeout(() => this.zoomToFit(), 10);\n  }\n\n  /**\n   * Zoom camera to fit all objects in view\n   */\n  zoomToFit(): void {\n    const center = new THREE.Vector3(\n      (this.sceneBounds.max.x + this.sceneBounds.min.x) / 2,\n      (this.sceneBounds.max.y + this.sceneBounds.min.y) / 2,\n      (this.sceneBounds.max.z + this.sceneBounds.min.z) / 2\n    );\n\n    const size = new THREE.Vector3(\n      this.sceneBounds.max.x - this.sceneBounds.min.x,\n      this.sceneBounds.max.y - this.sceneBounds.min.y,\n      this.sceneBounds.max.z - this.sceneBounds.min.z\n    );\n\n    this.controls.target.copy(center);\n\n    const aspect = this.camera.aspect;\n    const fovRadians = (this.camera.fov * Math.PI) / 180;\n    const padding = 1.3;\n    let distance: number;\n\n    switch (this.currentView) {\n      case 'top':\n        distance = Math.max(\n          (size.x / 2) / Math.tan(fovRadians / 2) / aspect,\n          (size.y / 2) / Math.tan(fovRadians / 2)\n        ) * padding;\n        this.camera.position.set(center.x, center.y, center.z + distance);\n        break;\n\n      case 'front':\n        distance = Math.max(\n          (size.x / 2) / Math.tan(fovRadians / 2) / aspect,\n          (size.z / 2) / Math.tan(fovRadians / 2)\n        ) * padding;\n        this.camera.position.set(center.x, center.y - distance, center.z);\n        break;\n\n      case 'side':\n        distance = Math.max(\n          (size.y / 2) / Math.tan(fovRadians / 2) / aspect,\n          (size.z / 2) / Math.tan(fovRadians / 2)\n        ) * padding;\n        this.camera.position.set(center.x + distance, center.y, center.z);\n        break;\n\n      case 'iso':\n      default:\n        const maxDim = Math.max(size.x, size.y, size.z);\n        distance = (maxDim * 1.4) / (2 * Math.tan((this.camera.fov * Math.PI) / 360));\n        const dir = new THREE.Vector3()\n          .subVectors(this.camera.position, center)\n          .normalize();\n        this.camera.position.copy(center).add(dir.multiplyScalar(distance));\n        break;\n    }\n\n    this.camera.lookAt(center);\n    this.controls.update();\n  }\n\n  /**\n   * Update scene bounds\n   */\n  updateSceneBounds(bounds: SceneBounds): void {\n    this.sceneBounds = bounds;\n  }\n\n  /**\n   * Handle window resize\n   */\n  onResize(): void {\n    const canvas = this.renderer.domElement;\n    this.camera.aspect = canvas.clientWidth / canvas.clientHeight;\n    this.camera.updateProjectionMatrix();\n    this.renderer.setSize(canvas.clientWidth, canvas.clientHeight);\n  }\n\n  /**\n   * Start the render loop\n   */\n  startRenderLoop(onFrame?: () => void): void {\n    const animate = () => {\n      this.animationId = requestAnimationFrame(animate);\n      this.controls.update();\n      this.renderer.render(this.scene, this.camera);\n      onFrame?.();\n    };\n    animate();\n  }\n\n  /**\n   * Stop the render loop\n   */\n  stopRenderLoop(): void {\n    if (this.animationId !== null) {\n      cancelAnimationFrame(this.animationId);\n      this.animationId = null;\n    }\n  }\n\n  /**\n   * Add an object to the scene\n   */\n  add(object: THREE.Object3D): void {\n    this.scene.add(object);\n  }\n\n  /**\n   * Remove an object from the scene\n   */\n  remove(object: THREE.Object3D): void {\n    this.scene.remove(object);\n  }\n\n  /**\n   * Clear all objects from the scene (except lights)\n   */\n  clearObjects(): void {\n    const toRemove: THREE.Object3D[] = [];\n    this.scene.traverse((child) => {\n      if (!(child instanceof THREE.Light) && child !== this.scene) {\n        toRemove.push(child);\n      }\n    });\n    toRemove.forEach((obj) => {\n      if (obj.parent === this.scene) {\n        this.scene.remove(obj);\n      }\n    });\n  }\n\n  /**\n   * Get the Three.js scene\n   */\n  getScene(): THREE.Scene {\n    return this.scene;\n  }\n\n  /**\n   * Get the camera\n   */\n  getCamera(): THREE.PerspectiveCamera {\n    return this.camera;\n  }\n\n  /**\n   * Get the renderer\n   */\n  getRenderer(): THREE.WebGLRenderer {\n    return this.renderer;\n  }\n\n  /**\n   * Get current camera view\n   */\n  getCurrentView(): CameraView {\n    return this.currentView;\n  }\n\n  /**\n   * Get the controls target (center point)\n   */\n  getControlsTarget(): THREE.Vector3 {\n    return this.controls.target;\n  }\n\n  /**\n   * Dispose of all resources\n   */\n  dispose(): void {\n    this.stopRenderLoop();\n    this.controls.dispose();\n    this.renderer.dispose();\n    this.clearObjects();\n  }\n}\n","/**\n * Lazy wave riser creator\n */\n\nimport * as THREE from 'three';\nimport { RISER_COLORS } from '../config';\nimport { RiserSegment } from '../../types';\n\nexport interface BuoyancyModuleVizConfig {\n  outerDiameter: number;    // m\n  length: number;           // m\n  numberOfModules: number;\n  spacing: number;          // m (center-to-center)\n}\n\nexport interface LazyWaveOptions {\n  color?: number;\n  normalRadius?: number;\n  buoyancyStartX?: number;\n  buoyancyEndX?: number;\n  buoyancyStart?: { x: number; z: number };\n  buoyancyEnd?: { x: number; z: number };\n  buoyancyModule?: BuoyancyModuleVizConfig;\n}\n\n/**\n * Create a lazy wave riser from segments\n */\nexport function createLazyWaveRiser(\n  segments: RiserSegment[],\n  options: LazyWaveOptions = {}\n): THREE.Group {\n  const {\n    color = RISER_COLORS[0],\n    normalRadius = 0.2,\n  } = options;\n\n  const buoyancyRadius = options.buoyancyModule\n    ? options.buoyancyModule.outerDiameter / 2\n    : 0.7;\n\n  const group = new THREE.Group();\n  group.name = 'LazyWaveRiser';\n  group.userData = {\n    type: 'lazyWaveRiser',\n    segmentCount: segments.length,\n  };\n\n  const normalMaterial = new THREE.MeshBasicMaterial({ color });\n  const buoyancyMaterial = new THREE.MeshBasicMaterial({\n    color: new THREE.Color(color).multiplyScalar(1.3).getHex(),\n  });\n\n  segments.forEach((segment) => {\n    const isBuoyancy = segment.type === 'buoyancy';\n    const radius = isBuoyancy ? buoyancyRadius : normalRadius;\n    const material = isBuoyancy ? buoyancyMaterial : normalMaterial;\n\n    // Create line from segment points\n    for (let i = 0; i < segment.points.length - 1; i++) {\n      const p1 = segment.points[i];\n      const p2 = segment.points[i + 1];\n\n      const start = new THREE.Vector3(p1.x, 0, -p1.y);\n      const end = new THREE.Vector3(p2.x, 0, -p2.y);\n\n      const direction = new THREE.Vector3().subVectors(end, start);\n      const distance = direction.length();\n\n      if (distance < 0.001) continue;\n\n      const geometry = new THREE.CylinderGeometry(radius, radius, distance, 8);\n      const cylinder = new THREE.Mesh(geometry, material);\n\n      const midpoint = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);\n      cylinder.position.copy(midpoint);\n\n      cylinder.lookAt(end);\n      cylinder.rotateX(Math.PI / 2);\n\n      group.add(cylinder);\n    }\n  });\n\n  return group;\n}\n\n/**\n * Create a lazy wave riser from 3D points with buoyancy section\n */\nexport function createLazyWaveFromPoints(\n  points: Array<{ x: number; y: number; z: number }>,\n  options: LazyWaveOptions = {}\n): THREE.Group {\n  const {\n    color = RISER_COLORS[0],\n    normalRadius = 0.5,\n    buoyancyStartX = 0,\n    buoyancyEndX = 0,\n    buoyancyStart,\n    buoyancyEnd,\n    buoyancyModule,\n  } = options;\n\n  const group = new THREE.Group();\n  group.name = 'LazyWaveRiser';\n  group.userData = {\n    type: 'lazyWaveRiser',\n    pointCount: points.length,\n    buoyancySection: { start: buoyancyStart, end: buoyancyEnd },\n  };\n\n  // Normal riser material\n  const normalMaterial = new THREE.MeshPhongMaterial({\n    color,\n    shininess: 30,\n  });\n\n  // Buoyancy section pipe - slightly thicker\n  const buoyancyPipeRadius = normalRadius * 1.2;\n  const buoyancyPipeMaterial = new THREE.MeshPhongMaterial({\n    color: new THREE.Color(color).offsetHSL(0, 0.1, -0.15).getHex(),\n    shininess: 40,\n  });\n\n  // Determine buoyancy section bounds from API result or fallback to X positions\n  let buoyMinX: number, buoyMaxX: number;\n  if (buoyancyStart && buoyancyEnd) {\n    buoyMinX = Math.min(buoyancyStart.x, buoyancyEnd.x);\n    buoyMaxX = Math.max(buoyancyStart.x, buoyancyEnd.x);\n  } else {\n    buoyMinX = Math.min(buoyancyStartX, buoyancyEndX);\n    buoyMaxX = Math.max(buoyancyStartX, buoyancyEndX);\n  }\n\n  // Store buoyancy section points for module placement\n  const buoyancySectionPoints: Array<{ x: number; y: number; z: number }> = [];\n\n  // Create riser pipe segments\n  for (let i = 0; i < points.length - 1; i++) {\n    const start = new THREE.Vector3(points[i].x, points[i].y, points[i].z);\n    const end = new THREE.Vector3(points[i + 1].x, points[i + 1].y, points[i + 1].z);\n\n    const midX = (start.x + end.x) / 2;\n    const isBuoyancy = buoyMaxX > buoyMinX && midX >= buoyMinX && midX <= buoyMaxX;\n\n    const radius = isBuoyancy ? buoyancyPipeRadius : normalRadius;\n    const material = isBuoyancy ? buoyancyPipeMaterial : normalMaterial;\n\n    // Collect buoyancy section points\n    if (isBuoyancy) {\n      if (buoyancySectionPoints.length === 0) {\n        buoyancySectionPoints.push(points[i]);\n      }\n      buoyancySectionPoints.push(points[i + 1]);\n    }\n\n    const direction = new THREE.Vector3().subVectors(end, start);\n    const distance = direction.length();\n\n    if (distance < 0.001) continue;\n\n    const geometry = new THREE.CylinderGeometry(radius, radius, distance, 12);\n    const cylinder = new THREE.Mesh(geometry, material);\n\n    const midpoint = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);\n    cylinder.position.copy(midpoint);\n\n    cylinder.lookAt(end);\n    cylinder.rotateX(Math.PI / 2);\n\n    group.add(cylinder);\n  }\n\n  // Add individual buoyancy modules if configuration provided\n  if (buoyancyModule && buoyancyModule.numberOfModules > 0 && buoyancySectionPoints.length > 1) {\n    const modules = createBuoyancyModulesAlongPath(\n      buoyancySectionPoints,\n      buoyancyModule\n    );\n    modules.forEach(m => group.add(m));\n  }\n\n  return group;\n}\n\n/**\n * Create individual buoyancy module meshes along the path\n */\nfunction createBuoyancyModulesAlongPath(\n  pathPoints: Array<{ x: number; y: number; z: number }>,\n  config: BuoyancyModuleVizConfig\n): THREE.Mesh[] {\n  const modules: THREE.Mesh[] = [];\n\n  if (pathPoints.length < 2 || config.numberOfModules <= 0) return modules;\n\n  // Calculate arc length along the path\n  const arcLengths: number[] = [0];\n  for (let i = 1; i < pathPoints.length; i++) {\n    const dx = pathPoints[i].x - pathPoints[i - 1].x;\n    const dy = pathPoints[i].y - pathPoints[i - 1].y;\n    const dz = pathPoints[i].z - pathPoints[i - 1].z;\n    arcLengths.push(arcLengths[i - 1] + Math.sqrt(dx * dx + dy * dy + dz * dz));\n  }\n  const totalLength = arcLengths[arcLengths.length - 1];\n\n  // Calculate module positions based on spacing\n  // First module starts at beginning, then spaced by config.spacing\n  const modulePositions: number[] = [];\n  for (let i = 0; i < config.numberOfModules; i++) {\n    const pos = i * config.spacing;\n    if (pos <= totalLength) {\n      modulePositions.push(pos);\n    }\n  }\n\n  // Buoyancy module material - bright orange/yellow for visibility\n  const moduleMaterial = new THREE.MeshPhongMaterial({\n    color: 0xff8c00, // Dark orange\n    shininess: 60,\n  });\n\n  // Create each module\n  for (const targetArcLength of modulePositions) {\n    // Find position and direction on path\n    const { position, direction } = getPointOnPath(pathPoints, arcLengths, targetArcLength);\n\n    // Create cylinder for module\n    const moduleRadius = config.outerDiameter / 2;\n    const geometry = new THREE.CylinderGeometry(moduleRadius, moduleRadius, config.length, 16);\n    const cylinder = new THREE.Mesh(geometry, moduleMaterial);\n\n    cylinder.position.copy(position);\n\n    // Orient along the path direction\n    if (direction.lengthSq() > 0.0001) {\n      const target = position.clone().add(direction);\n      cylinder.lookAt(target);\n      cylinder.rotateX(Math.PI / 2);\n    }\n\n    cylinder.userData = {\n      type: 'buoyancyModule',\n      name: 'Buoyancy Module',\n    };\n\n    modules.push(cylinder);\n  }\n\n  return modules;\n}\n\n/**\n * Get position and direction on path at given arc length\n */\nfunction getPointOnPath(\n  pathPoints: Array<{ x: number; y: number; z: number }>,\n  arcLengths: number[],\n  targetArcLength: number\n): { position: THREE.Vector3; direction: THREE.Vector3 } {\n  // Find segment containing target arc length\n  let segmentIndex = 0;\n  for (let i = 1; i < arcLengths.length; i++) {\n    if (arcLengths[i] >= targetArcLength) {\n      segmentIndex = i - 1;\n      break;\n    }\n    segmentIndex = i - 1;\n  }\n\n  const p1 = pathPoints[segmentIndex];\n  const p2 = pathPoints[Math.min(segmentIndex + 1, pathPoints.length - 1)];\n\n  const segmentStart = arcLengths[segmentIndex];\n  const segmentEnd = arcLengths[Math.min(segmentIndex + 1, arcLengths.length - 1)];\n  const segmentLength = segmentEnd - segmentStart;\n\n  // Interpolate within segment\n  const t = segmentLength > 0 ? (targetArcLength - segmentStart) / segmentLength : 0;\n\n  const position = new THREE.Vector3(\n    p1.x + t * (p2.x - p1.x),\n    p1.y + t * (p2.y - p1.y),\n    p1.z + t * (p2.z - p1.z)\n  );\n\n  const direction = new THREE.Vector3(\n    p2.x - p1.x,\n    p2.y - p1.y,\n    p2.z - p1.z\n  ).normalize();\n\n  return { position, direction };\n}\n\n/**\n * Create sag/hog bend indicator spheres\n */\nexport function createBendIndicator(\n  position: { x: number; y: number; z: number },\n  type: 'sag' | 'hog',\n  color: number = 0x00ff00\n): THREE.Mesh {\n  const geometry = new THREE.SphereGeometry(1, 16, 16);\n  const material = new THREE.MeshBasicMaterial({\n    color,\n    transparent: true,\n    opacity: 0.8,\n  });\n\n  const mesh = new THREE.Mesh(geometry, material);\n  mesh.position.set(position.x, position.y, position.z);\n  mesh.userData = {\n    type: `${type}BendIndicator`,\n    name: type === 'sag' ? 'Sag Bend' : 'Hog Bend',\n    position,\n  };\n\n  return mesh;\n}\n","/**\n * Vessel configuration types for OrcaFlex model\n */\n\nexport interface VesselPosition {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport interface VesselOrientation {\n  heading: number;\n  roll: number;\n  pitch: number;\n}\n\nexport interface ConnectionPoint {\n  id: string;\n  name: string;\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport interface RAOData {\n  period: number[];\n  heave: number[];\n  surge: number[];\n  sway: number[];\n  roll: number[];\n  pitch: number[];\n  yaw: number[];\n}\n\nexport interface VesselConfig {\n  id: string;\n  name: string;\n  length: number;\n  breadth: number;\n  depth: number;\n  draft: number;\n  position: VesselPosition;\n  orientation: VesselOrientation;\n  connectionPoints: ConnectionPoint[];\n  raoData?: RAOData;\n}\n\nexport interface VesselExtractRequest {\n  yamlContent: string;\n}\n\nexport interface VesselExtractResponse {\n  vessels: VesselConfig[];\n  connectionPoints: Record<string, ConnectionPoint[]>;\n}\n\nexport const DEFAULT_VESSEL: VesselConfig = {\n  id: 'vessel-1',\n  name: 'FPSO',\n  length: 280,\n  breadth: 60,\n  depth: 30,\n  draft: 22,\n  position: { x: 0, y: 0, z: 0 },\n  orientation: { heading: 0, roll: 0, pitch: 0 },\n  connectionPoints: [\n    { id: 'cp-1', name: 'Turret Center', x: 50, y: 0, z: -10 },\n  ],\n};\n","import { Component, EventEmitter, Input, Output, inject, signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { DialogModule } from 'primeng/dialog';\nimport { CheckboxModule } from 'primeng/checkbox';\nimport { ButtonModule } from 'primeng/button';\nimport { InputTextModule } from 'primeng/inputtext';\nimport JSZip from 'jszip';\nimport { ModelStateService } from '../../services/model-state.service';\nimport { RiserConfig, ContentConfig } from '../../types';\n\ninterface RiserContentSelection {\n  riserId: string;\n  riserName: string;\n  contents: {\n    contentId: string;\n    contentName: string;\n    selected: boolean;\n  }[];\n}\n\ninterface VesselCondition {\n  id: string;\n  heading: number;\n  offset: number;\n}\n\ninterface GeneratedModel {\n  name: string;\n  risers: string[];\n  condition: string;\n}\n\n@Component({\n  selector: 'orcaflex-generate-dialog',\n  standalone: true,\n  imports: [\n    CommonModule,\n    FormsModule,\n    DialogModule,\n    CheckboxModule,\n    ButtonModule,\n    InputTextModule,\n  ],\n  template: `\n    <p-dialog\n      header=\"Generate OrcaFlex Models\"\n      [visible]=\"visible\"\n      [modal]=\"true\"\n      [closable]=\"true\"\n      [draggable]=\"false\"\n      [resizable]=\"false\"\n      [style]=\"{ width: '900px', maxHeight: '90vh' }\"\n      styleClass=\"generate-dialog\"\n      (onHide)=\"onCancel()\"\n    >\n      <div class=\"dialog-content\">\n        <div class=\"config-panels\">\n          <!-- Left Panel: Riser/Content Selection -->\n          <div class=\"panel risers-panel\">\n            <div class=\"panel-header\">\n              <span>Risers & Contents</span>\n              <div class=\"select-actions\">\n                <button class=\"link-btn\" (click)=\"selectAllContents()\">Select All</button>\n                <button class=\"link-btn\" (click)=\"deselectAllContents()\">Deselect All</button>\n              </div>\n            </div>\n            <div class=\"panel-body\">\n              @for (riser of riserSelections(); track riser.riserId) {\n                <div class=\"riser-group\">\n                  <div class=\"riser-name\">{{ riser.riserName }}</div>\n                  <div class=\"content-list\">\n                    @for (content of riser.contents; track content.contentId) {\n                      <label class=\"content-item\">\n                        <input\n                          type=\"checkbox\"\n                          [(ngModel)]=\"content.selected\"\n                          (ngModelChange)=\"updateModelList()\"\n                        />\n                        <span class=\"content-name\">{{ content.contentName }}</span>\n                      </label>\n                    }\n                  </div>\n                </div>\n              }\n              @if (riserSelections().length === 0) {\n                <div class=\"empty-state\">No risers defined</div>\n              }\n            </div>\n          </div>\n\n          <!-- Right Panel: Vessel Conditions -->\n          <div class=\"panel conditions-panel\">\n            <div class=\"panel-header\">\n              <span>Vessel Conditions</span>\n              <button class=\"add-btn\" (click)=\"addCondition()\">+ Add</button>\n            </div>\n            <div class=\"panel-body\">\n              <div class=\"conditions-table\">\n                <div class=\"table-header\">\n                  <span class=\"col-heading\">Heading ()</span>\n                  <span class=\"col-offset\">Offset (m)</span>\n                  <span class=\"col-actions\"></span>\n                </div>\n                @for (condition of vesselConditions(); track condition.id; let idx = $index) {\n                  <div class=\"table-row\">\n                    <input\n                      type=\"number\"\n                      class=\"condition-input\"\n                      [(ngModel)]=\"condition.heading\"\n                      (ngModelChange)=\"updateModelList()\"\n                      placeholder=\"0\"\n                    />\n                    <input\n                      type=\"number\"\n                      class=\"condition-input\"\n                      [(ngModel)]=\"condition.offset\"\n                      (ngModelChange)=\"updateModelList()\"\n                      placeholder=\"0\"\n                    />\n                    <button\n                      class=\"remove-btn\"\n                      (click)=\"removeCondition(idx)\"\n                      [disabled]=\"vesselConditions().length <= 1\"\n                    ></button>\n                  </div>\n                }\n              </div>\n            </div>\n\n            <!-- Options -->\n            <div class=\"options-section\">\n              <label class=\"option-item\">\n                <input\n                  type=\"checkbox\"\n                  [(ngModel)]=\"oneRiserPerModel\"\n                  (ngModelChange)=\"updateModelList()\"\n                />\n                <span>One riser per model</span>\n              </label>\n            </div>\n          </div>\n        </div>\n\n        <!-- Model Preview -->\n        <div class=\"model-preview\">\n          <div class=\"preview-header\">\n            <span>Models to Generate ({{ generatedModels().length }})</span>\n          </div>\n          <div class=\"preview-body\">\n            @if (generatedModels().length > 0) {\n              <div class=\"model-list\">\n                @for (model of generatedModels(); track model.name) {\n                  <div class=\"model-item\">\n                    <span class=\"model-name\">{{ model.name }}.yml</span>\n                    <span class=\"model-info\">{{ model.risers.length }} riser(s) - {{ model.condition }}</span>\n                  </div>\n                }\n              </div>\n            } @else {\n              <div class=\"empty-preview\">\n                Select risers and contents to generate models\n              </div>\n            }\n          </div>\n        </div>\n      </div>\n\n      <ng-template pTemplate=\"footer\">\n        <div class=\"dialog-footer\">\n          <div class=\"footer-info\">\n            @if (isGenerating()) {\n              <span class=\"generating\">Generating models...</span>\n            }\n          </div>\n          <div class=\"footer-actions\">\n            <button class=\"btn-secondary\" (click)=\"onCancel()\">Cancel</button>\n            <button\n              class=\"btn-primary\"\n              (click)=\"onGenerate()\"\n              [disabled]=\"generatedModels().length === 0 || isGenerating()\"\n            >\n              Generate {{ generatedModels().length }} Model{{ generatedModels().length !== 1 ? 's' : '' }}\n            </button>\n          </div>\n        </div>\n      </ng-template>\n    </p-dialog>\n  `,\n  styles: [`\n    :host ::ng-deep .generate-dialog .p-dialog {\n      background: white;\n    }\n\n    :host ::ng-deep .generate-dialog .p-dialog-header {\n      background: white;\n      border-bottom: 1px solid #eee;\n      padding: 16px 20px;\n    }\n\n    :host ::ng-deep .generate-dialog .p-dialog-content {\n      background: white;\n      padding: 20px;\n      overflow-y: auto;\n    }\n\n    :host ::ng-deep .generate-dialog .p-dialog-footer {\n      background: white;\n      border-top: 1px solid #eee;\n      padding: 16px 20px;\n    }\n\n    :host ::ng-deep .p-dialog-mask {\n      background: rgba(0, 0, 0, 0.5);\n    }\n\n    .dialog-content {\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n\n    .config-panels {\n      display: flex;\n      gap: 16px;\n    }\n\n    .panel {\n      flex: 1;\n      border: 1px solid #eee;\n      border-radius: 6px;\n      overflow: hidden;\n    }\n\n    .panel-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 10px 12px;\n      background: #fafafa;\n      border-bottom: 1px solid #eee;\n      font-size: 11px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: #666;\n    }\n\n    .select-actions {\n      display: flex;\n      gap: 8px;\n    }\n\n    .link-btn {\n      background: none;\n      border: none;\n      color: #1976d2;\n      font-size: 10px;\n      cursor: pointer;\n      text-transform: none;\n      font-weight: 500;\n    }\n\n    .link-btn:hover {\n      text-decoration: underline;\n    }\n\n    .add-btn {\n      padding: 2px 8px;\n      border: 1px solid #1976d2;\n      border-radius: 3px;\n      background: transparent;\n      color: #1976d2;\n      font-size: 10px;\n      cursor: pointer;\n      text-transform: none;\n      font-weight: 500;\n    }\n\n    .add-btn:hover {\n      background: #1976d2;\n      color: white;\n    }\n\n    .panel-body {\n      padding: 12px;\n      max-height: 200px;\n      overflow-y: auto;\n      background: white;\n    }\n\n    .riser-group {\n      margin-bottom: 12px;\n    }\n\n    .riser-group:last-child {\n      margin-bottom: 0;\n    }\n\n    .riser-name {\n      font-size: 12px;\n      font-weight: 600;\n      color: #333;\n      margin-bottom: 6px;\n    }\n\n    .content-list {\n      display: flex;\n      flex-direction: column;\n      gap: 4px;\n      padding-left: 12px;\n    }\n\n    .content-item {\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      cursor: pointer;\n      font-size: 11px;\n      color: #555;\n    }\n\n    .content-item input[type=\"checkbox\"] {\n      width: 14px;\n      height: 14px;\n      cursor: pointer;\n    }\n\n    .conditions-table {\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n    }\n\n    .table-header {\n      display: flex;\n      gap: 8px;\n      padding: 0 4px;\n      font-size: 10px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: #999;\n    }\n\n    .col-heading, .col-offset {\n      flex: 1;\n    }\n\n    .col-actions {\n      width: 24px;\n    }\n\n    .table-row {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n    }\n\n    .condition-input {\n      flex: 1;\n      padding: 6px 8px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      font-size: 12px;\n      text-align: right;\n      background: white;\n    }\n\n    .condition-input:focus {\n      outline: none;\n      border-color: #1976d2;\n    }\n\n    .remove-btn {\n      width: 24px;\n      height: 24px;\n      border: none;\n      background: transparent;\n      color: #999;\n      font-size: 16px;\n      cursor: pointer;\n      border-radius: 3px;\n    }\n\n    .remove-btn:hover:not(:disabled) {\n      background: #ffebee;\n      color: #f44336;\n    }\n\n    .remove-btn:disabled {\n      opacity: 0.3;\n      cursor: not-allowed;\n    }\n\n    .options-section {\n      padding: 12px;\n      border-top: 1px solid #eee;\n      background: white;\n    }\n\n    .option-item {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      cursor: pointer;\n      font-size: 12px;\n      color: #333;\n    }\n\n    .option-item input[type=\"checkbox\"] {\n      width: 14px;\n      height: 14px;\n      cursor: pointer;\n    }\n\n    .model-preview {\n      border: 1px solid #eee;\n      border-radius: 6px;\n      overflow: hidden;\n    }\n\n    .preview-header {\n      padding: 10px 12px;\n      background: #fafafa;\n      border-bottom: 1px solid #eee;\n      font-size: 11px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: #666;\n    }\n\n    .preview-body {\n      max-height: 150px;\n      overflow-y: auto;\n      background: white;\n    }\n\n    .model-list {\n      padding: 8px;\n    }\n\n    .model-item {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 6px 8px;\n      border-radius: 4px;\n      background: #f9f9f9;\n      margin-bottom: 4px;\n    }\n\n    .model-item:last-child {\n      margin-bottom: 0;\n    }\n\n    .model-name {\n      font-size: 12px;\n      font-weight: 500;\n      color: #333;\n      font-family: monospace;\n    }\n\n    .model-info {\n      font-size: 10px;\n      color: #999;\n    }\n\n    .empty-state, .empty-preview {\n      padding: 24px;\n      text-align: center;\n      color: #999;\n      font-size: 12px;\n      font-style: italic;\n    }\n\n    .dialog-footer {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    .footer-info {\n      font-size: 12px;\n    }\n\n    .generating {\n      color: #1976d2;\n    }\n\n    .footer-actions {\n      display: flex;\n      gap: 8px;\n    }\n\n    .btn-secondary {\n      padding: 8px 16px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      background: white;\n      font-size: 12px;\n      cursor: pointer;\n    }\n\n    .btn-secondary:hover {\n      background: #f5f5f5;\n    }\n\n    .btn-primary {\n      padding: 8px 16px;\n      border: none;\n      border-radius: 4px;\n      background: #1976d2;\n      color: white;\n      font-size: 12px;\n      cursor: pointer;\n    }\n\n    .btn-primary:hover:not(:disabled) {\n      background: #1565c0;\n    }\n\n    .btn-primary:disabled {\n      background: #ddd;\n      cursor: not-allowed;\n    }\n  `]\n})\nexport class GenerateOrcaflexDialogComponent {\n  @Input() visible = false;\n  @Output() visibleChange = new EventEmitter<boolean>();\n  @Output() generate = new EventEmitter<GeneratedModel[]>();\n\n  private modelState = inject(ModelStateService);\n\n  // Riser/content selections\n  riserSelections = signal<RiserContentSelection[]>([]);\n\n  // Vessel conditions (heading + offset)\n  vesselConditions = signal<VesselCondition[]>([\n    { id: crypto.randomUUID(), heading: 25, offset: 40 }\n  ]);\n\n  // Options\n  oneRiserPerModel = false;\n\n  // State\n  isGenerating = signal(false);\n\n  // Computed model list\n  generatedModels = signal<GeneratedModel[]>([]);\n\n  ngOnInit(): void {\n    this.initializeSelections();\n  }\n\n  ngOnChanges(): void {\n    if (this.visible) {\n      this.initializeSelections();\n    }\n  }\n\n  private initializeSelections(): void {\n    const risers = this.modelState.risers();\n    const selections: RiserContentSelection[] = risers.map(riser => ({\n      riserId: riser.id,\n      riserName: riser.name,\n      contents: (riser.contents || []).map(content => ({\n        contentId: content.id,\n        contentName: content.name,\n        selected: true, // Default all selected\n      }))\n    }));\n    this.riserSelections.set(selections);\n    this.updateModelList();\n  }\n\n  selectAllContents(): void {\n    const selections = this.riserSelections();\n    for (const riser of selections) {\n      for (const content of riser.contents) {\n        content.selected = true;\n      }\n    }\n    this.riserSelections.set([...selections]);\n    this.updateModelList();\n  }\n\n  deselectAllContents(): void {\n    const selections = this.riserSelections();\n    for (const riser of selections) {\n      for (const content of riser.contents) {\n        content.selected = false;\n      }\n    }\n    this.riserSelections.set([...selections]);\n    this.updateModelList();\n  }\n\n  addCondition(): void {\n    const conditions = this.vesselConditions();\n    this.vesselConditions.set([\n      ...conditions,\n      { id: crypto.randomUUID(), heading: 0, offset: 0 }\n    ]);\n    this.updateModelList();\n  }\n\n  removeCondition(index: number): void {\n    const conditions = this.vesselConditions();\n    if (conditions.length > 1) {\n      conditions.splice(index, 1);\n      this.vesselConditions.set([...conditions]);\n      this.updateModelList();\n    }\n  }\n\n  updateModelList(): void {\n    const models: GeneratedModel[] = [];\n    const selections = this.riserSelections();\n    const conditions = this.vesselConditions();\n\n    // Get selected risers with their selected contents\n    const selectedRisers: { riserId: string; riserName: string; contentId: string; contentName: string }[] = [];\n    for (const riser of selections) {\n      for (const content of riser.contents) {\n        if (content.selected) {\n          selectedRisers.push({\n            riserId: riser.riserId,\n            riserName: riser.riserName,\n            contentId: content.contentId,\n            contentName: content.contentName,\n          });\n        }\n      }\n    }\n\n    if (selectedRisers.length === 0 || conditions.length === 0) {\n      this.generatedModels.set([]);\n      return;\n    }\n\n    // Generate model names based on options\n    for (const condition of conditions) {\n      const conditionStr = `H${condition.heading}_O${condition.offset}`;\n      const conditionLabel = `Heading ${condition.heading}, Offset ${condition.offset}m`;\n\n      if (this.oneRiserPerModel) {\n        // Each riser/content combination gets its own file\n        for (const riser of selectedRisers) {\n          const modelName = `${this.sanitizeName(riser.riserName)}_${this.sanitizeName(riser.contentName)}_${conditionStr}`;\n          models.push({\n            name: modelName,\n            risers: [`${riser.riserName} (${riser.contentName})`],\n            condition: conditionLabel,\n          });\n        }\n      } else {\n        // All risers in one file per condition\n        const riserNames = selectedRisers.map(r => `${r.riserName} (${r.contentName})`);\n        const modelName = `Model_${conditionStr}`;\n        models.push({\n          name: modelName,\n          risers: riserNames,\n          condition: conditionLabel,\n        });\n      }\n    }\n\n    this.generatedModels.set(models);\n  }\n\n  private sanitizeName(name: string): string {\n    return name.replace(/[^a-zA-Z0-9]/g, '_').replace(/_+/g, '_');\n  }\n\n  async onGenerate(): Promise<void> {\n    this.isGenerating.set(true);\n\n    try {\n      const selections = this.riserSelections();\n      const conditions = this.vesselConditions();\n\n      // Generate YAML files\n      const files: { name: string; content: string }[] = [];\n\n      for (const condition of conditions) {\n        const conditionStr = `H${condition.heading}_O${condition.offset}`;\n\n        // Get selected risers for this model\n        const selectedRisers: { riser: RiserConfig; content: ContentConfig }[] = [];\n        const risers = this.modelState.risers();\n\n        for (const selection of selections) {\n          const riser = risers.find(r => r.id === selection.riserId);\n          if (!riser) continue;\n\n          for (const contentSel of selection.contents) {\n            if (contentSel.selected) {\n              const content = riser.contents.find(c => c.id === contentSel.contentId);\n              if (content) {\n                selectedRisers.push({ riser, content });\n              }\n            }\n          }\n        }\n\n        if (this.oneRiserPerModel) {\n          // Each riser gets its own file\n          for (const { riser, content } of selectedRisers) {\n            const modelName = `${this.sanitizeName(riser.name)}_${this.sanitizeName(content.name)}_${conditionStr}`;\n            const yaml = this.generateOrcaFlexYaml([{ riser, content }], condition);\n            files.push({ name: `${modelName}.yml`, content: yaml });\n          }\n        } else {\n          // All risers in one file\n          const modelName = `Model_${conditionStr}`;\n          const yaml = this.generateOrcaFlexYaml(selectedRisers, condition);\n          files.push({ name: `${modelName}.yml`, content: yaml });\n        }\n      }\n\n      // Create and download ZIP\n      await this.downloadAsZip(files);\n\n      this.modelState.addLog('success', `Generated ${files.length} OrcaFlex model(s)`);\n      this.close();\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error';\n      this.modelState.addLog('error', `Failed to generate models: ${message}`);\n    } finally {\n      this.isGenerating.set(false);\n    }\n  }\n\n  private generateOrcaFlexYaml(\n    risers: { riser: RiserConfig; content: ContentConfig }[],\n    condition: VesselCondition\n  ): string {\n    const env = this.modelState.environment();\n    const vessels = this.modelState.vessels();\n    const lineTypes = this.modelState.lineTypes();\n    const buoyancyModules = this.modelState.buoyancyModules();\n\n    // Build YAML structure\n    const yaml: string[] = [];\n\n    // General section\n    yaml.push('General:');\n    yaml.push('  StageDuration:');\n    yaml.push('    - 8');\n    yaml.push('    - ~');\n    yaml.push('  TargetLogSampleInterval: 0.2');\n    yaml.push('  ImplicitConstantTimeStep: 0.02');\n    yaml.push('');\n\n    // Environment section\n    yaml.push('Environment:');\n    yaml.push(`  WaterDepth: ${env.sea.waterDepth}`);\n    yaml.push(`  SeaDensity: ${env.sea.waterDensity}`);\n    yaml.push('  WaveType: Airy');\n    yaml.push('  WaveHeight: 0');\n    yaml.push('  WavePeriod: 10');\n    yaml.push('');\n\n    // Line Types section\n    yaml.push('LineTypes:');\n    for (const lt of lineTypes) {\n      yaml.push(`  - Name: ${lt.name}`);\n      yaml.push(`    OD: ${lt.outerDiameter}`);\n      yaml.push(`    ID: ${lt.innerDiameter}`);\n      yaml.push(`    MassPerUnitLength: ${lt.dryMass}`);\n      yaml.push(`    EI: ${lt.bendingStiffness}`);\n      yaml.push(`    EA: ${lt.axialStiffness}`);\n      yaml.push(`    GJ: ${lt.torsionalStiffness || 10}`);\n      yaml.push(`    PoissonRatio: ${lt.poissonRatio || 0.5}`);\n      yaml.push(`    Cdx: ${lt.dragCoefficients.axial}`);\n      yaml.push(`    Cdn: ${lt.dragCoefficients.normal}`);\n      yaml.push(`    Cax: ${lt.addedMassCoefficients.axial}`);\n      yaml.push(`    Can: ${lt.addedMassCoefficients.normal}`);\n    }\n    yaml.push('');\n\n    // Vessels section\n    yaml.push('Vessels:');\n    for (const vessel of vessels) {\n      yaml.push(`  - Name: ${vessel.name}`);\n      yaml.push(`    Length: ${vessel.length}`);\n      yaml.push(`    InitialX: ${vessel.position.x + condition.offset}`);\n      yaml.push(`    InitialY: ${vessel.position.y}`);\n      yaml.push(`    InitialZ: ${vessel.position.z}`);\n      yaml.push(`    InitialHeading: ${vessel.orientation.heading + condition.heading}`);\n      yaml.push(`    InitialHeel: ${vessel.orientation.roll}`);\n      yaml.push(`    InitialTrim: ${vessel.orientation.pitch}`);\n      yaml.push('    Connection:');\n      for (const cp of vessel.connectionPoints) {\n        yaml.push(`      - Name: ${cp.name}`);\n        yaml.push(`        X: ${cp.x}`);\n        yaml.push(`        Y: ${cp.y}`);\n        yaml.push(`        Z: ${cp.z}`);\n      }\n    }\n    yaml.push('');\n\n    // Buoyancy Modules section (if any)\n    if (buoyancyModules.length > 0) {\n      yaml.push('BuoyancyModules:');\n      for (const bm of buoyancyModules) {\n        yaml.push(`  - Name: ${bm.name}`);\n        yaml.push(`    OD: ${bm.outerDiameter}`);\n        yaml.push(`    Length: ${bm.length}`);\n        yaml.push(`    Mass: ${bm.dryMass}`);\n        yaml.push(`    ApparentMass: ${bm.apparentMassInWater}`);\n        yaml.push(`    NumberOfModules: ${bm.numberOfModules}`);\n        yaml.push(`    Spacing: ${bm.spacing}`);\n      }\n      yaml.push('');\n    }\n\n    // Lines section\n    yaml.push('Lines:');\n    for (const { riser, content } of risers) {\n      const lineType = lineTypes.find(lt => lt.id === riser.lineTypeId);\n      const vessel = vessels.find(v => v.id === riser.vesselId);\n      const cp = vessel?.connectionPoints.find(c => c.id === riser.connectionPointId);\n\n      const lineName = `${riser.name}_${content.name}`.replace(/[^a-zA-Z0-9]/g, '_');\n\n      yaml.push(`  - Name: ${lineName}`);\n      yaml.push(`    LineType: ${lineType?.name || 'Unknown'}`);\n      yaml.push(`    ContentsDensity: ${content.density}`);\n      yaml.push('    EndAConnection: Vessel');\n      yaml.push(`    EndAVessel: ${vessel?.name || 'Unknown'}`);\n      yaml.push(`    EndAConnectionPoint: ${cp?.name || 'CP1'}`);\n      yaml.push('    EndBConnection: Anchored');\n      yaml.push(`    EndBX: ${riser.calculationResults?.tdpPosition?.x || 200}`);\n      yaml.push(`    EndBY: 0`);\n      yaml.push(`    EndBZ: ${-env.sea.waterDepth}`);\n\n      if (riser.geometry.type === 'lazy-wave') {\n        const geom = riser.geometry;\n        yaml.push(`    TargetSegmentLength: 5`);\n        yaml.push(`    # Lazy wave configuration`);\n        yaml.push(`    # SagBend: ${geom.sagBend}`);\n        yaml.push(`    # HogBend: ${geom.hogBend}`);\n      }\n\n      yaml.push(`    TotalLength: ${riser.calculationResults?.totalLength || 500}`);\n    }\n    yaml.push('');\n\n    return yaml.join('\\n');\n  }\n\n  private async downloadAsZip(files: { name: string; content: string }[]): Promise<void> {\n    const zip = new JSZip();\n\n    // Add all YAML files to the ZIP\n    for (const file of files) {\n      zip.file(file.name, file.content);\n    }\n\n    // Generate the ZIP file\n    const zipBlob = await zip.generateAsync({ type: 'blob' });\n\n    // Download the ZIP file\n    const timestamp = new Date().toISOString().slice(0, 10).replace(/-/g, '');\n    const zipFilename = `OrcaFlex_Models_${timestamp}.zip`;\n\n    const url = URL.createObjectURL(zipBlob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = zipFilename;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n  }\n\n  onCancel(): void {\n    this.close();\n  }\n\n  private close(): void {\n    this.visible = false;\n    this.visibleChange.emit(false);\n  }\n}\n","/**\n * Seabed plane creator\n */\n\nimport * as THREE from 'three';\nimport { COLORS } from '../config';\n\nexport interface SeabedOptions {\n  size?: number;\n  addNoise?: boolean;\n}\n\n/**\n * Create a seabed plane at specified depth\n */\nexport function createSeabed(depth: number, options: SeabedOptions = {}): THREE.Mesh {\n  const { size = 2000, addNoise = true } = options;\n\n  const geometry = new THREE.PlaneGeometry(size, size, 64, 64);\n\n  // Add subtle noise for realistic seabed appearance\n  if (addNoise) {\n    const positions = geometry.attributes.position as THREE.BufferAttribute;\n    for (let i = 0; i < positions.count; i++) {\n      const z = positions.getZ(i);\n      positions.setZ(i, z + (Math.random() - 0.5) * 0.5);\n    }\n    positions.needsUpdate = true;\n    geometry.computeVertexNormals();\n  }\n\n  const material = new THREE.MeshLambertMaterial({\n    color: COLORS.seabed,\n    side: THREE.DoubleSide,\n  });\n\n  const mesh = new THREE.Mesh(geometry, material);\n  mesh.position.set(0, 0, -depth);\n  mesh.receiveShadow = true;\n  mesh.userData = {\n    type: 'seabed',\n    name: `Seabed at ${depth}m`,\n    depth: depth,\n  };\n\n  return mesh;\n}\n\n/**\n * Create a seabed reference line at specified depth\n */\nexport function createSeabedLine(depth: number, color: number = 0xff6b35): THREE.Mesh {\n  const geometry = new THREE.BoxGeometry(2000, 2, 0.5);\n  const material = new THREE.MeshBasicMaterial({ color });\n\n  const mesh = new THREE.Mesh(geometry, material);\n  mesh.position.set(0, 0, -depth);\n  mesh.userData = {\n    type: 'seabedLine',\n    name: `Seabed Line ${depth}m`,\n    depth: depth,\n  };\n\n  return mesh;\n}\n","/**\n * Environment configuration types for OrcaFlex model\n */\n\nexport interface SeaConfig {\n  waterDepth: number;\n  waterDensity: number;\n  seabedType?: string;\n  seabedFriction?: number;\n  seabedStiffness?: number;\n}\n\nexport interface CurrentProfile {\n  depth: number;\n  speed: number;\n  direction: number;\n}\n\nexport interface WaveConfig {\n  type: 'none' | 'airy' | 'dean-stream' | 'stokes-5' | 'jonswap';\n  height?: number;\n  period?: number;\n  direction?: number;\n  spectrum?: string;\n  gamma?: number;\n}\n\nexport interface EnvironmentConfig {\n  sea: SeaConfig;\n  currentProfiles: CurrentProfile[];\n  wave: WaveConfig;\n}\n\nexport const DEFAULT_ENVIRONMENT: EnvironmentConfig = {\n  sea: {\n    waterDepth: 100,\n    waterDensity: 1025,\n    seabedType: 'elastic',\n    seabedFriction: 0.3,\n  },\n  currentProfiles: [\n    { depth: 0, speed: 0.5, direction: 0 },\n    { depth: 100, speed: 0.2, direction: 0 },\n  ],\n  wave: {\n    type: 'none',\n  },\n};\n","import { Component, EventEmitter, Input, Output, signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { DialogModule } from 'primeng/dialog';\nimport { TableModule } from 'primeng/table';\nimport { ButtonModule } from 'primeng/button';\nimport { InputTextModule } from 'primeng/inputtext';\nimport { LineTypeConfig } from '../../types';\n\ninterface LineTypeRow {\n  name: string;\n  outerDiameter: number;     // mm\n  innerDiameter: number;     // mm\n  dryMass: number;           // kg/m\n  bendingStiffness: number;  // kNm (EI)\n  axialStiffness: number;    // kN (EA)\n  torsionalStiffness: number; // kNm (GJ)\n  allowableTension: number;  // kN\n  minBendRadius: number;     // m\n}\n\n@Component({\n  selector: 'orcaflex-line-types-import-dialog',\n  standalone: true,\n  imports: [\n    CommonModule,\n    FormsModule,\n    DialogModule,\n    TableModule,\n    ButtonModule,\n    InputTextModule,\n  ],\n  template: `\n    <p-dialog\n      header=\"Import Line Types\"\n      [visible]=\"visible\"\n      [modal]=\"true\"\n      [closable]=\"true\"\n      [draggable]=\"false\"\n      [resizable]=\"false\"\n      [style]=\"{ width: '1000px' }\"\n      styleClass=\"import-dialog\"\n      (onHide)=\"onCancel()\"\n    >\n      <div class=\"dialog-content\">\n        <div class=\"paste-instructions\">\n          <p>Paste data from Excel with columns: <strong>Name, OD (mm), ID (mm), Dry Mass (kg/m), EI (kNm), EA (kN), GJ (kNm), Tension (kN), MBR (m)</strong></p>\n          <p class=\"hint\">Click in the table and press Ctrl+V (Cmd+V on Mac) to paste</p>\n        </div>\n\n        <div\n          class=\"table-container\"\n          tabindex=\"0\"\n          (paste)=\"handlePaste($event)\"\n          (keydown)=\"handleKeydown($event)\"\n        >\n          <p-table [value]=\"rows()\" [tableStyle]=\"{ 'min-width': '100%' }\" [scrollable]=\"true\" scrollHeight=\"300px\">\n            <ng-template pTemplate=\"header\">\n              <tr>\n                <th style=\"width: 14%\">Name</th>\n                <th style=\"width: 10%\">OD (mm)</th>\n                <th style=\"width: 10%\">ID (mm)</th>\n                <th style=\"width: 11%\">Dry Mass</th>\n                <th style=\"width: 11%\">EI (kNm)</th>\n                <th style=\"width: 11%\">EA (kN)</th>\n                <th style=\"width: 11%\">GJ (kNm)</th>\n                <th style=\"width: 11%\">Tension (kN)</th>\n                <th style=\"width: 11%\">MBR (m)</th>\n              </tr>\n            </ng-template>\n            <ng-template pTemplate=\"body\" let-row let-rowIndex=\"rowIndex\">\n              <tr>\n                <td>\n                  <input\n                    type=\"text\"\n                    pInputText\n                    [(ngModel)]=\"row.name\"\n                    placeholder=\"Name\"\n                    class=\"table-input\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.outerDiameter\"\n                    placeholder=\"355.6\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.innerDiameter\"\n                    placeholder=\"254\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.dryMass\"\n                    placeholder=\"184.2\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.bendingStiffness\"\n                    placeholder=\"124.87\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.axialStiffness\"\n                    placeholder=\"711200\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.torsionalStiffness\"\n                    placeholder=\"10\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.allowableTension\"\n                    placeholder=\"5000\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n                <td>\n                  <input\n                    type=\"number\"\n                    pInputText\n                    [(ngModel)]=\"row.minBendRadius\"\n                    placeholder=\"3.675\"\n                    class=\"table-input coord\"\n                  />\n                </td>\n              </tr>\n            </ng-template>\n            <ng-template pTemplate=\"emptymessage\">\n              <tr>\n                <td colspan=\"9\" class=\"empty-message\">\n                  Paste Excel data here or add rows manually\n                </td>\n              </tr>\n            </ng-template>\n          </p-table>\n        </div>\n\n        <div class=\"row-actions\">\n          <button class=\"action-btn add\" (click)=\"addRow()\">+ Add Row</button>\n          <button class=\"action-btn clear\" (click)=\"clearRows()\">Clear All</button>\n        </div>\n      </div>\n\n      <ng-template pTemplate=\"footer\">\n        <div class=\"dialog-footer\">\n          <button class=\"btn-secondary\" (click)=\"onCancel()\">Cancel</button>\n          <button class=\"btn-primary\" (click)=\"onImport()\" [disabled]=\"!hasValidData()\">\n            Import {{ getValidRowCount() }} Line Type{{ getValidRowCount() !== 1 ? 's' : '' }}\n          </button>\n        </div>\n      </ng-template>\n    </p-dialog>\n  `,\n  styles: [`\n    :host ::ng-deep .import-dialog .p-dialog {\n      background: white;\n    }\n\n    :host ::ng-deep .import-dialog .p-dialog-header {\n      background: white;\n      border-bottom: 1px solid #eee;\n      padding: 16px 20px;\n    }\n\n    :host ::ng-deep .import-dialog .p-dialog-content {\n      background: white;\n      padding: 20px;\n    }\n\n    :host ::ng-deep .import-dialog .p-dialog-footer {\n      background: white;\n      border-top: 1px solid #eee;\n      padding: 16px 20px;\n    }\n\n    :host ::ng-deep .p-dialog-mask {\n      background: rgba(0, 0, 0, 0.5);\n    }\n\n    .dialog-content {\n      padding: 0;\n    }\n\n    .paste-instructions {\n      margin-bottom: 16px;\n      padding: 12px;\n      background: #f5f5f5;\n      border-radius: 4px;\n    }\n\n    .paste-instructions p {\n      margin: 0;\n      font-size: 12px;\n      color: #333;\n    }\n\n    .paste-instructions .hint {\n      margin-top: 4px;\n      font-size: 11px;\n      color: #666;\n    }\n\n    .table-container {\n      border: 2px dashed #ddd;\n      border-radius: 4px;\n      padding: 4px;\n      outline: none;\n      transition: border-color 0.2s;\n      background: white;\n    }\n\n    .table-container:focus {\n      border-color: #1976d2;\n    }\n\n    :host ::ng-deep .p-datatable {\n      background: white;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-thead > tr > th {\n      background: #fafafa;\n      font-size: 9px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: #666;\n      padding: 8px 2px;\n      border: none;\n      border-bottom: 1px solid #eee;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-tbody > tr {\n      background: white;\n    }\n\n    :host ::ng-deep .p-datatable .p-datatable-tbody > tr > td {\n      padding: 4px 2px;\n      border: none;\n      border-bottom: 1px solid #f0f0f0;\n      background: white;\n    }\n\n    .table-input {\n      width: 100%;\n      padding: 6px 4px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      font-size: 11px;\n      background: white;\n    }\n\n    .table-input:focus {\n      outline: none;\n      border-color: #1976d2;\n    }\n\n    .table-input.coord {\n      text-align: right;\n    }\n\n    .empty-message {\n      text-align: center;\n      padding: 24px;\n      color: #999;\n      font-style: italic;\n      background: white;\n    }\n\n    .row-actions {\n      display: flex;\n      gap: 8px;\n      margin-top: 12px;\n    }\n\n    .action-btn {\n      padding: 6px 12px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      background: white;\n      font-size: 11px;\n      cursor: pointer;\n    }\n\n    .action-btn:hover {\n      background: #f5f5f5;\n    }\n\n    .action-btn.add {\n      color: #1976d2;\n      border-color: #1976d2;\n    }\n\n    .action-btn.clear {\n      color: #666;\n    }\n\n    .dialog-footer {\n      display: flex;\n      justify-content: flex-end;\n      gap: 8px;\n    }\n\n    .btn-secondary {\n      padding: 8px 16px;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      background: white;\n      font-size: 12px;\n      cursor: pointer;\n    }\n\n    .btn-secondary:hover {\n      background: #f5f5f5;\n    }\n\n    .btn-primary {\n      padding: 8px 16px;\n      border: none;\n      border-radius: 4px;\n      background: #1976d2;\n      color: white;\n      font-size: 12px;\n      cursor: pointer;\n    }\n\n    .btn-primary:hover:not(:disabled) {\n      background: #1565c0;\n    }\n\n    .btn-primary:disabled {\n      background: #ddd;\n      cursor: not-allowed;\n    }\n  `]\n})\nexport class LineTypesImportDialogComponent {\n  @Input() visible = false;\n  @Output() visibleChange = new EventEmitter<boolean>();\n  @Output() import = new EventEmitter<LineTypeConfig[]>();\n\n  private getDefaultRow(): LineTypeRow {\n    return {\n      name: '',\n      outerDiameter: 355.6,\n      innerDiameter: 254,\n      dryMass: 184.2,\n      bendingStiffness: 124.87,\n      axialStiffness: 711200,\n      torsionalStiffness: 10,\n      allowableTension: 5000,\n      minBendRadius: 3.675\n    };\n  }\n\n  rows = signal<LineTypeRow[]>([this.getDefaultRow()]);\n\n  handlePaste(event: ClipboardEvent): void {\n    event.preventDefault();\n    const clipboardData = event.clipboardData;\n    if (!clipboardData) return;\n\n    const text = clipboardData.getData('text');\n    if (!text) return;\n\n    const parsedRows = this.parseExcelData(text);\n    if (parsedRows.length > 0) {\n      this.rows.set(parsedRows);\n    }\n  }\n\n  handleKeydown(event: KeyboardEvent): void {\n    if ((event.ctrlKey || event.metaKey) && event.key === 'v') {\n      return;\n    }\n  }\n\n  parseExcelData(text: string): LineTypeRow[] {\n    const rows: LineTypeRow[] = [];\n    const lines = text.trim().split('\\n');\n\n    for (const line of lines) {\n      const cells = line.split(/\\t|(?:  +)/);\n\n      if (cells.length >= 1 && cells[0]?.trim()) {\n        rows.push({\n          name: cells[0]?.trim() || '',\n          outerDiameter: parseFloat(cells[1]) || 355.6,\n          innerDiameter: parseFloat(cells[2]) || 254,\n          dryMass: parseFloat(cells[3]) || 184.2,\n          bendingStiffness: parseFloat(cells[4]) || 124.87,\n          axialStiffness: parseFloat(cells[5]) || 711200,\n          torsionalStiffness: parseFloat(cells[6]) || 10,\n          allowableTension: parseFloat(cells[7]) || 5000,\n          minBendRadius: parseFloat(cells[8]) || 3.675,\n        });\n      }\n    }\n\n    return rows;\n  }\n\n  addRow(): void {\n    const currentRows = this.rows();\n    this.rows.set([...currentRows, this.getDefaultRow()]);\n  }\n\n  clearRows(): void {\n    this.rows.set([this.getDefaultRow()]);\n  }\n\n  hasValidData(): boolean {\n    return this.rows().some(row => row.name.trim() !== '');\n  }\n\n  getValidRowCount(): number {\n    return this.rows().filter(row => row.name.trim() !== '').length;\n  }\n\n  onImport(): void {\n    const validRows = this.rows().filter(row => row.name.trim() !== '');\n\n    const lineTypes: LineTypeConfig[] = validRows.map(row => ({\n      id: crypto.randomUUID(),\n      name: row.name.trim(),\n      outerDiameter: row.outerDiameter / 1000,  // mm to m\n      innerDiameter: row.innerDiameter / 1000,  // mm to m\n      dryMass: row.dryMass,\n      bendingStiffness: row.bendingStiffness,\n      axialStiffness: row.axialStiffness,\n      torsionalStiffness: row.torsionalStiffness,\n      poissonRatio: 0.5,\n      allowableTension: row.allowableTension,\n      minBendRadius: row.minBendRadius,\n      dragCoefficients: { normal: 1.2, axial: 0.008 },\n      addedMassCoefficients: { normal: 1.0, axial: 0.0 },\n    }));\n\n    this.import.emit(lineTypes);\n    this.close();\n  }\n\n  onCancel(): void {\n    this.close();\n  }\n\n  private close(): void {\n    this.visible = false;\n    this.visibleChange.emit(false);\n    this.rows.set([this.getDefaultRow()]);\n  }\n}\n","/**\n * Vessel mesh creator\n */\n\nimport * as THREE from 'three';\nimport { VesselDimensions, COLORS } from '../config';\n\nexport interface VesselOptions {\n  color?: number;\n  opacity?: number;\n}\n\n/**\n * Create a simple box vessel representation\n */\nexport function createVesselMesh(\n  dimensions: VesselDimensions,\n  options: VesselOptions = {}\n): THREE.Mesh {\n  const { color = COLORS.vessel, opacity = 1 } = options;\n\n  const geometry = new THREE.BoxGeometry(\n    dimensions.length,\n    dimensions.breadth,\n    dimensions.depth\n  );\n\n  const material = new THREE.MeshStandardMaterial({\n    color,\n    transparent: opacity < 1,\n    opacity,\n  });\n\n  const mesh = new THREE.Mesh(geometry, material);\n  mesh.castShadow = true;\n  mesh.receiveShadow = true;\n  mesh.userData = {\n    type: 'vessel',\n    name: 'Vessel',\n    dimensions,\n  };\n\n  return mesh;\n}\n\n/**\n * Create a vessel group with hull and indicators\n */\nexport function createVesselGroup(\n  dimensions: VesselDimensions,\n  position: { x: number; y: number; z: number }\n): THREE.Group {\n  const group = new THREE.Group();\n  group.name = 'VesselGroup';\n  group.userData = { type: 'vesselGroup' };\n\n  // Create hull\n  const hull = createVesselMesh(dimensions);\n  // Position hull so waterline is at z=0\n  hull.position.set(0, 0, dimensions.depth / 2 - dimensions.draft);\n  group.add(hull);\n\n  // Create COG indicator\n  const cogGeometry = new THREE.SphereGeometry(1, 16, 16);\n  const cogMaterial = new THREE.MeshPhongMaterial({\n    color: COLORS.vesselCOG,\n    emissive: 0xff1122,\n    emissiveIntensity: 0.3,\n  });\n  const cog = new THREE.Mesh(cogGeometry, cogMaterial);\n  cog.userData = { type: 'vesselCOG', name: 'Center of Gravity' };\n  group.add(cog);\n\n  // Position the group\n  group.position.set(position.x, position.y, position.z);\n\n  return group;\n}\n\n/**\n * Create a connection point indicator with label\n */\nexport function createConnectionPoint(\n  position: { x: number; y: number; z: number },\n  name: string,\n  color: number = COLORS.cdp\n): THREE.Group {\n  const group = new THREE.Group();\n  group.name = `ConnectionPoint-${name}`;\n\n  // Create sphere for the connection point\n  const geometry = new THREE.SphereGeometry(2, 16, 16);\n  const material = new THREE.MeshBasicMaterial({ color });\n  const mesh = new THREE.Mesh(geometry, material);\n  group.add(mesh);\n\n  // Create ring around the sphere for better visibility\n  const ringGeometry = new THREE.RingGeometry(2.5, 3, 32);\n  const ringMaterial = new THREE.MeshBasicMaterial({\n    color: 0xffff00,\n    side: THREE.DoubleSide,\n  });\n  const ring = new THREE.Mesh(ringGeometry, ringMaterial);\n  ring.rotation.x = Math.PI / 2; // Make ring horizontal\n  group.add(ring);\n\n  // Create text label\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d')!;\n  canvas.width = 256;\n  canvas.height = 64;\n\n  ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n  ctx.font = 'Bold 32px Arial';\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillStyle = '#ffffff';\n  ctx.fillText(name, canvas.width / 2, canvas.height / 2);\n\n  const texture = new THREE.CanvasTexture(canvas);\n  const labelMaterial = new THREE.SpriteMaterial({\n    map: texture,\n    transparent: true,\n  });\n  const label = new THREE.Sprite(labelMaterial);\n  label.position.set(0, 0, 8); // Position label above the point\n  label.scale.set(16, 4, 1);\n  group.add(label);\n\n  group.position.set(position.x, position.y, position.z);\n  group.userData = {\n    type: 'connectionPoint',\n    name,\n    position,\n  };\n\n  return group;\n}\n","import { Component, inject, signal } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { ModelStateService } from '../../services/model-state.service';\nimport { CurrentProfile, WaveConfig } from '../../types';\n\n@Component({\n  selector: 'orcaflex-environment-section',\n  standalone: true,\n  imports: [CommonModule, FormsModule],\n  template: `\n    <div class=\"section-content\">\n      <!-- Sea Configuration -->\n      <div class=\"subsection-header\" (click)=\"toggleSubsection('sea')\">\n        <span>Sea</span>\n        <span class=\"toggle\">{{ expandedSubsections.sea ? '' : '+' }}</span>\n      </div>\n      @if (expandedSubsections.sea) {\n        <div class=\"subsection-content\">\n          <div class=\"form-group\">\n            <label>Water Depth (m)</label>\n            <input\n              type=\"number\"\n              [ngModel]=\"environment().sea.waterDepth\"\n              (ngModelChange)=\"updateWaterDepth($event)\"\n              min=\"10\"\n              max=\"3000\"\n              step=\"1\"\n            />\n          </div>\n\n          <div class=\"form-group\">\n            <label>Water Density (kg/m)</label>\n            <input\n              type=\"number\"\n              [ngModel]=\"environment().sea.waterDensity\"\n              (ngModelChange)=\"updateWaterDensity($event)\"\n              min=\"1000\"\n              max=\"1100\"\n              step=\"1\"\n            />\n          </div>\n\n          <div class=\"form-group\">\n            <label>Seabed Friction</label>\n            <input\n              type=\"number\"\n              [ngModel]=\"environment().sea.seabedFriction\"\n              (ngModelChange)=\"updateSeabedFriction($event)\"\n              min=\"0\"\n              max=\"1\"\n              step=\"0.05\"\n            />\n          </div>\n\n          <div class=\"form-group\">\n            <label>Seabed Stiffness (N/m/m)</label>\n            <input\n              type=\"number\"\n              [ngModel]=\"environment().sea.seabedStiffness\"\n              (ngModelChange)=\"updateSeabedStiffness($event)\"\n              min=\"0\"\n              step=\"100\"\n            />\n          </div>\n        </div>\n      }\n\n      <!-- Wave Configuration -->\n      <div class=\"subsection-header\" (click)=\"toggleSubsection('wave')\">\n        <span>Wave</span>\n        <span class=\"toggle\">{{ expandedSubsections.wave ? '' : '+' }}</span>\n      </div>\n      @if (expandedSubsections.wave) {\n        <div class=\"subsection-content\">\n          <div class=\"form-group\">\n            <label>Wave Type</label>\n            <select\n              [ngModel]=\"environment().wave.type\"\n              (ngModelChange)=\"updateWaveType($event)\"\n            >\n              <option value=\"none\">None</option>\n              <option value=\"airy\">Airy</option>\n              <option value=\"dean-stream\">Dean Stream</option>\n              <option value=\"stokes-5\">Stokes 5th Order</option>\n              <option value=\"jonswap\">JONSWAP Spectrum</option>\n            </select>\n          </div>\n\n          @if (environment().wave.type !== 'none') {\n            <div class=\"form-row\">\n              <div class=\"form-group half\">\n                <label>Hs (m)</label>\n                <input\n                  type=\"number\"\n                  [ngModel]=\"environment().wave.height\"\n                  (ngModelChange)=\"updateWaveHeight($event)\"\n                  min=\"0\"\n                  max=\"30\"\n                  step=\"0.5\"\n                />\n              </div>\n              <div class=\"form-group half\">\n                <label>Tp (s)</label>\n                <input\n                  type=\"number\"\n                  [ngModel]=\"environment().wave.period\"\n                  (ngModelChange)=\"updateWavePeriod($event)\"\n                  min=\"1\"\n                  max=\"30\"\n                  step=\"0.5\"\n                />\n              </div>\n            </div>\n\n            <div class=\"form-group\">\n              <label>Direction ()</label>\n              <input\n                type=\"number\"\n                [ngModel]=\"environment().wave.direction\"\n                (ngModelChange)=\"updateWaveDirection($event)\"\n                min=\"0\"\n                max=\"360\"\n                step=\"5\"\n              />\n            </div>\n\n            @if (environment().wave.type === 'jonswap') {\n              <div class=\"form-group\">\n                <label>Gamma</label>\n                <input\n                  type=\"number\"\n                  [ngModel]=\"environment().wave.gamma\"\n                  (ngModelChange)=\"updateWaveGamma($event)\"\n                  min=\"1\"\n                  max=\"7\"\n                  step=\"0.1\"\n                />\n              </div>\n            }\n          }\n        </div>\n      }\n\n      <!-- Current Profile -->\n      <div class=\"subsection-header\" (click)=\"toggleSubsection('current')\">\n        <span>Current Profile</span>\n        <span class=\"toggle\">{{ expandedSubsections.current ? '' : '+' }}</span>\n      </div>\n      @if (expandedSubsections.current) {\n        <div class=\"subsection-content\">\n          <div class=\"current-list\">\n            @for (profile of environment().currentProfiles; track $index; let idx = $index) {\n              <div class=\"current-row\" [class.editing]=\"editingCurrentIdx() === idx\">\n                @if (editingCurrentIdx() === idx) {\n                  <input\n                    type=\"number\"\n                    class=\"current-input depth\"\n                    [(ngModel)]=\"editingDepth\"\n                    placeholder=\"Depth\"\n                    min=\"0\"\n                  />\n                  <input\n                    type=\"number\"\n                    class=\"current-input speed\"\n                    [(ngModel)]=\"editingSpeed\"\n                    placeholder=\"Speed\"\n                    min=\"0\"\n                    step=\"0.1\"\n                  />\n                  <button class=\"icon-btn save\" (click)=\"saveCurrentEdit(idx)\"></button>\n                  <button class=\"icon-btn cancel\" (click)=\"cancelCurrentEdit()\"></button>\n                } @else {\n                  <span class=\"depth-val\">{{ profile.depth }}m</span>\n                  <span class=\"speed-val\">{{ profile.speed }} m/s</span>\n                  <button class=\"icon-btn edit\" (click)=\"startEditCurrent(idx, profile)\"></button>\n                  <button class=\"icon-btn delete\" (click)=\"deleteCurrentProfile(idx)\"></button>\n                }\n              </div>\n            }\n          </div>\n\n          @if (addingCurrent()) {\n            <div class=\"current-row add-row\">\n              <input\n                type=\"number\"\n                class=\"current-input depth\"\n                [(ngModel)]=\"newCurrentDepth\"\n                placeholder=\"Depth (m)\"\n                min=\"0\"\n              />\n              <input\n                type=\"number\"\n                class=\"current-input speed\"\n                [(ngModel)]=\"newCurrentSpeed\"\n                placeholder=\"Speed (m/s)\"\n                min=\"0\"\n                step=\"0.1\"\n              />\n              <button class=\"icon-btn save\" (click)=\"addCurrentProfile()\"></button>\n              <button class=\"icon-btn cancel\" (click)=\"cancelAddCurrent()\"></button>\n            </div>\n          } @else {\n            <button class=\"add-current-btn\" (click)=\"startAddCurrent()\">\n              + Add Point\n            </button>\n          }\n        </div>\n      }\n    </div>\n  `,\n  styles: [`\n    .section-content {\n      padding: 0;\n    }\n\n    .subsection-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 8px 12px;\n      background: var(--caris-bg-subtle, #f5f5f5);\n      border-bottom: 1px solid var(--caris-border-light, #eee);\n      cursor: pointer;\n      font-size: 11px;\n      font-weight: 600;\n      text-transform: uppercase;\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .subsection-header:hover {\n      background: var(--caris-bg-hover, #ebebeb);\n    }\n\n    .toggle {\n      font-weight: bold;\n    }\n\n    .subsection-content {\n      padding: 12px;\n    }\n\n    .form-group {\n      margin-bottom: 12px;\n    }\n\n    .form-group:last-child {\n      margin-bottom: 0;\n    }\n\n    .form-group label {\n      display: block;\n      font-size: 11px;\n      color: var(--caris-text-secondary, #666);\n      margin-bottom: 4px;\n    }\n\n    .form-group input,\n    .form-group select {\n      width: 100%;\n      padding: 6px 8px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      font-size: 12px;\n      background: white;\n    }\n\n    .form-group input:focus,\n    .form-group select:focus {\n      outline: none;\n      border-color: var(--caris-primary, #1976d2);\n    }\n\n    .form-row {\n      display: flex;\n      gap: 8px;\n    }\n\n    .form-group.half {\n      flex: 1;\n    }\n\n    .current-list {\n      margin-bottom: 8px;\n    }\n\n    .current-row {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      padding: 4px 0;\n      font-size: 12px;\n    }\n\n    .current-row.editing,\n    .current-row.add-row {\n      padding: 6px 0;\n    }\n\n    .depth-val {\n      width: 60px;\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .speed-val {\n      flex: 1;\n    }\n\n    .current-input {\n      padding: 4px 6px;\n      border: 1px solid var(--caris-border-light, #ddd);\n      border-radius: 3px;\n      font-size: 11px;\n    }\n\n    .current-input.depth {\n      width: 60px;\n    }\n\n    .current-input.speed {\n      width: 70px;\n    }\n\n    .icon-btn {\n      width: 22px;\n      height: 22px;\n      padding: 0;\n      border: none;\n      border-radius: 3px;\n      background: transparent;\n      cursor: pointer;\n      font-size: 14px;\n      line-height: 1;\n    }\n\n    .icon-btn:hover {\n      background: var(--caris-bg-hover, #f0f0f0);\n    }\n\n    .icon-btn.edit {\n      color: var(--caris-primary, #1976d2);\n    }\n\n    .icon-btn.delete {\n      color: var(--caris-error, #f44336);\n    }\n\n    .icon-btn.save {\n      color: var(--caris-success, #4caf50);\n    }\n\n    .icon-btn.cancel {\n      color: var(--caris-text-secondary, #666);\n    }\n\n    .add-current-btn {\n      width: 100%;\n      padding: 6px 12px;\n      border: 1px dashed var(--caris-border-light, #ddd);\n      border-radius: 4px;\n      background: transparent;\n      color: var(--caris-text-secondary, #666);\n      font-size: 11px;\n      cursor: pointer;\n    }\n\n    .add-current-btn:hover {\n      border-color: var(--caris-primary, #1976d2);\n      color: var(--caris-primary, #1976d2);\n    }\n  `]\n})\nexport class EnvironmentSectionComponent {\n  private modelState = inject(ModelStateService);\n\n  environment = this.modelState.environment;\n\n  expandedSubsections: Record<string, boolean> = {\n    sea: true,\n    wave: false,\n    current: false,\n  };\n\n  // Current profile editing state\n  editingCurrentIdx = signal<number | null>(null);\n  editingDepth = 0;\n  editingSpeed = 0;\n\n  addingCurrent = signal<boolean>(false);\n  newCurrentDepth = 0;\n  newCurrentSpeed = 0;\n\n  toggleSubsection(section: string): void {\n    this.expandedSubsections[section] = !this.expandedSubsections[section];\n  }\n\n  // Sea updates\n  updateWaterDepth(value: number): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      sea: { ...env.sea, waterDepth: value }\n    });\n  }\n\n  updateWaterDensity(value: number): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      sea: { ...env.sea, waterDensity: value }\n    });\n  }\n\n  updateSeabedFriction(value: number): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      sea: { ...env.sea, seabedFriction: value }\n    });\n  }\n\n  updateSeabedStiffness(value: number): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      sea: { ...env.sea, seabedStiffness: value }\n    });\n  }\n\n  updateSeabedType(value: string): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      sea: { ...env.sea, seabedType: value }\n    });\n  }\n\n  // Wave updates\n  updateWaveType(value: WaveConfig['type']): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      wave: { ...env.wave, type: value }\n    });\n  }\n\n  updateWaveHeight(value: number): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      wave: { ...env.wave, height: value }\n    });\n  }\n\n  updateWavePeriod(value: number): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      wave: { ...env.wave, period: value }\n    });\n  }\n\n  updateWaveDirection(value: number): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      wave: { ...env.wave, direction: value }\n    });\n  }\n\n  updateWaveSpectrum(value: string): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      wave: { ...env.wave, spectrum: value }\n    });\n  }\n\n  updateWaveGamma(value: number): void {\n    const env = this.environment();\n    this.modelState.updateEnvironment({\n      ...env,\n      wave: { ...env.wave, gamma: value }\n    });\n  }\n\n  // Current profile management\n  startEditCurrent(idx: number, profile: CurrentProfile): void {\n    this.editingCurrentIdx.set(idx);\n    this.editingDepth = profile.depth;\n    this.editingSpeed = profile.speed;\n  }\n\n  saveCurrentEdit(idx: number): void {\n    const env = this.environment();\n    const profiles = [...env.currentProfiles];\n    profiles[idx] = { depth: this.editingDepth, speed: this.editingSpeed, direction: profiles[idx]?.direction ?? 0 };\n    profiles.sort((a, b) => a.depth - b.depth);\n\n    this.modelState.updateEnvironment({\n      ...env,\n      currentProfiles: profiles\n    });\n    this.editingCurrentIdx.set(null);\n  }\n\n  cancelCurrentEdit(): void {\n    this.editingCurrentIdx.set(null);\n  }\n\n  deleteCurrentProfile(idx: number): void {\n    const env = this.environment();\n    const profiles = env.currentProfiles.filter((_, i) => i !== idx);\n    this.modelState.updateEnvironment({\n      ...env,\n      currentProfiles: profiles\n    });\n  }\n\n  startAddCurrent(): void {\n    this.addingCurrent.set(true);\n    this.newCurrentDepth = 0;\n    this.newCurrentSpeed = 0;\n  }\n\n  addCurrentProfile(): void {\n    const env = this.environment();\n    const profiles = [...env.currentProfiles, { depth: this.newCurrentDepth, speed: this.newCurrentSpeed, direction: 0 }];\n    profiles.sort((a, b) => a.depth - b.depth);\n\n    this.modelState.updateEnvironment({\n      ...env,\n      currentProfiles: profiles\n    });\n    this.addingCurrent.set(false);\n  }\n\n  cancelAddCurrent(): void {\n    this.addingCurrent.set(false);\n  }\n}\n","/**\n * Coordinate system axes creator\n * Creates visual coordinate axes for global and local reference frames\n */\n\nimport * as THREE from 'three';\n\nexport interface CoordinateAxesOptions {\n  size?: number;\n  labelSize?: number;\n  showLabels?: boolean;\n}\n\n/**\n * Create coordinate axes (X=red, Y=green, Z=blue)\n */\nexport function createCoordinateAxes(\n  options: CoordinateAxesOptions = {}\n): THREE.Group {\n  const { size = 20, showLabels = true } = options;\n\n  const group = new THREE.Group();\n  group.name = 'CoordinateAxes';\n  group.userData = { type: 'coordinateAxes' };\n\n  // Create arrow helpers for each axis\n  const origin = new THREE.Vector3(0, 0, 0);\n\n  // X axis - Red\n  const xDir = new THREE.Vector3(1, 0, 0);\n  const xArrow = new THREE.ArrowHelper(xDir, origin, size, 0xff0000, size * 0.15, size * 0.08);\n  xArrow.name = 'X-axis';\n  group.add(xArrow);\n\n  // Y axis - Green\n  const yDir = new THREE.Vector3(0, 1, 0);\n  const yArrow = new THREE.ArrowHelper(yDir, origin, size, 0x00ff00, size * 0.15, size * 0.08);\n  yArrow.name = 'Y-axis';\n  group.add(yArrow);\n\n  // Z axis - Blue\n  const zDir = new THREE.Vector3(0, 0, 1);\n  const zArrow = new THREE.ArrowHelper(zDir, origin, size, 0x0088ff, size * 0.15, size * 0.08);\n  zArrow.name = 'Z-axis';\n  group.add(zArrow);\n\n  // Add axis labels using sprites\n  if (showLabels) {\n    const xLabel = createAxisLabel('X', 0xff0000);\n    xLabel.position.set(size + 3, 0, 0);\n    group.add(xLabel);\n\n    const yLabel = createAxisLabel('Y', 0x00ff00);\n    yLabel.position.set(0, size + 3, 0);\n    group.add(yLabel);\n\n    const zLabel = createAxisLabel('Z', 0x0088ff);\n    zLabel.position.set(0, 0, size + 3);\n    group.add(zLabel);\n  }\n\n  return group;\n}\n\n/**\n * Create global coordinate system at origin\n */\nexport function createGlobalCoordinateSystem(size: number = 30): THREE.Group {\n  const axes = createCoordinateAxes({ size, showLabels: true });\n  axes.name = 'GlobalCoordinateSystem';\n  axes.userData = { type: 'globalCoordinates' };\n\n  // Add origin sphere\n  const originGeometry = new THREE.SphereGeometry(1.5, 16, 16);\n  const originMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });\n  const originSphere = new THREE.Mesh(originGeometry, originMaterial);\n  originSphere.name = 'GlobalOrigin';\n  axes.add(originSphere);\n\n  // Add \"Global\" label\n  const globalLabel = createAxisLabel('GLOBAL', 0xffffff);\n  globalLabel.position.set(0, 0, size + 8);\n  axes.add(globalLabel);\n\n  return axes;\n}\n\n/**\n * Create vessel local coordinate system\n */\nexport function createVesselCoordinateSystem(size: number = 15): THREE.Group {\n  const axes = createCoordinateAxes({ size, showLabels: true });\n  axes.name = 'VesselCoordinateSystem';\n  axes.userData = { type: 'vesselCoordinates' };\n\n  // Add origin sphere\n  const originGeometry = new THREE.SphereGeometry(1, 16, 16);\n  const originMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });\n  const originSphere = new THREE.Mesh(originGeometry, originMaterial);\n  originSphere.name = 'VesselOrigin';\n  axes.add(originSphere);\n\n  // Add \"Vessel\" label\n  const vesselLabel = createAxisLabel('VESSEL', 0xffff00);\n  vesselLabel.position.set(0, 0, size + 5);\n  axes.add(vesselLabel);\n\n  return axes;\n}\n\n/**\n * Create a text label sprite for axis\n */\nfunction createAxisLabel(text: string, color: number): THREE.Sprite {\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext('2d')!;\n  canvas.width = 128;\n  canvas.height = 64;\n\n  // Clear canvas\n  context.clearRect(0, 0, canvas.width, canvas.height);\n\n  // Draw text\n  context.font = 'Bold 48px Arial';\n  context.textAlign = 'center';\n  context.textBaseline = 'middle';\n\n  // Convert hex color to CSS\n  const hexColor = '#' + color.toString(16).padStart(6, '0');\n  context.fillStyle = hexColor;\n  context.fillText(text, canvas.width / 2, canvas.height / 2);\n\n  const texture = new THREE.CanvasTexture(canvas);\n  const material = new THREE.SpriteMaterial({\n    map: texture,\n    transparent: true,\n    depthTest: false,\n  });\n\n  const sprite = new THREE.Sprite(material);\n  sprite.scale.set(8, 4, 1);\n  sprite.name = `Label-${text}`;\n\n  return sprite;\n}\n"],"names":["createWaterPlane","options","size","opacity","geometry","material","color","water","transparent","side","shininess","specular","mesh","position","set","receiveShadow","userData","type","name","OrcaFlexApiService","httpClient","inject","externalApiService","setApiService","api","this","calculateCatenary","request","post","calculateLazyWave","parseYaml","content","parseVesselFromYaml","contentStr","File","text","generateYaml","downloadYaml","responseType","firstValueFrom","validateModel","model","url","body","Injectable","providedIn","LineTypesSectionComponent","modelState","lineTypes","buoyancyModules","selectedLineTypeId","signal","selectedBuoyancyId","addingLineType","addingBuoyancy","newLineType","getDefaultNewLineType","newLineTypeODmm","newLineTypeIDmm","newBuoyancy","getDefaultNewBuoyancy","newBuoyancyODmm","newBuoyancyLengthmm","showLineTypesImportDialog","showBuoyancyImportDialog","formatDiameter","meters","inches","toFixed","getWetMass","lineType","waterDensity","environment","sea","Math","round","getPipeDensity","selectLineType","id","selectBuoyancy","updateLineType","field","value","updateDryMass","dryMass","updateWetMass","wetMass","outerDiameter","updatePipeDensity","density","innerDiameter","pipeDensity","updateDragCoeff","axis","dragCoefficients","deleteLineType","startAddLineType","saveNewLineType","crypto","randomUUID","bendingStiffness","axialStiffness","torsionalStiffness","poissonRatio","allowableTension","minBendRadius","normal","axial","addedMassCoefficients","addLineType","cancelAddLineType","updateBuoyancy","buoyancy","updateBuoyancyModule","deleteBuoyancy","buoyancyId","deleteBuoyancyModule","getModuleBuoyancy","getSectionLength","getBuoyancyPerMeter","startAddBuoyancy","saveNewBuoyancy","length","apparentMassInWater","dragCoefficient","numberOfModules","spacing","addBuoyancyModule","cancelAddBuoyancy","handleLineTypesImport","addLog","handleBuoyancyModulesImport","modules","module","Component","selector","standalone","imports","CommonModule","FormsModule","template","styles","BuoyancyModulesImportDialogComponent","visible","visibleChange","EventEmitter","import","rows","handlePaste","event","preventDefault","clipboardData","getData","parsedRows","parseExcelData","handleKeydown","ctrlKey","metaKey","key","lines","trim","split","line","cells","push","parseFloat","parseInt","addRow","currentRows","clearRows","hasValidData","some","row","getValidRowCount","filter","onImport","map","emit","close","onCancel","Input","Output","createGrid","divisions","colorCenter","grid","colorGrid","rotation","x","PI","OrcaFlexRiserComponent","apiService","showGenerateDialog","expandedSections","vessel","risers","results","logs","ngOnInit","ngOnDestroy","toggleSection","section","calculateRiser","riser","console","log","setCalculating","find","lt","lineTypeId","Error","env","waterDepth","height","abs","hangoffPoint","z","activeContent","contents","c","activeContentId","contentDensity","method","weight","departure_angle","departureAngle","num_points","apiResult","mappedPoints","points","p","y","s","angle","slice","updateRiser","calculationResults","totalLength","arc_length","tdpPosition","horizontal_distance","maxTension","horizontal_tension","cos","end_angle_rad","minTension","buoyancyModule","bm","buoyancyModuleId","geom","vessels","v","vesselId","connectionPoint","connectionPoints","cp","connectionPointId","hangoffZ","effectiveWaterDepth","water_depth","line_weight","buoyancy_weight","sag","sagBend","hog","hogBend","buoyancySectionStart","buoyancy_section_start","buoyancySectionEnd","buoyancy_section_end","tdp_length","tdp_horizontal_distance","sagBendRadius","hogBendRadius","buoyancyStart","buoyancyEnd","error","message","CONTENT_COLORS","RisersSectionComponent","selectedRiserId","onCalculateRequest","selectRiser","getConnectionPoints","getColorHex","toString","padStart","addRiser","count","newRiser","azimuth","deleteRiser","updateRiserName","updateRiserVessel","updateRiserConnectionPoint","updateRiserLineType","updateRiserBuoyancy","addContent","colorIndex","newContent","removeContent","contentId","newContents","selectContent","updateContentName","updateContentDensity","setRiserType","undefined","updateGeometry","asCatenary","asLazyWave","ViewHelper","animating","controls","camera","dim","turnRate","interactiveObjects","raycaster","mouse","dummy","posXAxisHelper","posYAxisHelper","posZAxisHelper","negXAxisHelper","negYAxisHelper","negZAxisHelper","point","targetPosition","targetQuaternion","q1","q2","radius","editorCamera","constructor","super","color1","color2","color3","translate","xAxis","getAxisMaterial","yAxis","zAxis","add","getSpriteMaterial","scale","setScalar","render","renderer","containerWidth","_containerHeight","updateOpacity","autoClear","setViewport","clearDepth","renderToCanvas","quaternion","copy","invert","updateMatrixWorld","applyQuaternion","handleClick","container","rect","getBoundingClientRect","offsetX","right","offsetY","bottom","clientX","clientY","setFromCamera","intersects","intersectObjects","object","prepareAnimationData","center","update","delta","step","focusPoint","rotateTowards","multiplyScalar","angleTo","setDimension","setFromEuler","distanceTo","lookAt","toneMapped","canvas","document","createElement","width","context","getContext","beginPath","arc","closePath","fillStyle","getStyle","fill","font","textAlign","fillText","texture","dispose","traverse","LogsSectionComponent","formatTime","date","Date","toLocaleTimeString","hour12","hour","minute","second","clearLogs","VesselSectionComponent","selectedVesselId","importing","editingCpIdx","editingCp","showImportDialog","importTargetVesselId","selectVessel","addVessel","newVessel","deleteVessel","onFileSelected","input","target","files","file","result","breadth","depth","draft","initialX","initialY","initialZ","orientation","heading","initialHeading","roll","initialHeel","pitch","initialTrim","updateVesselName","updateVessel","updateVesselDimension","updateVesselPosition","updateVesselOrientation","param","addConnectionPoint","newCp","startCpEdit","idx","saveCpEdit","cancelCpEdit","deleteCp","_","i","openImportDialog","handleConnectionPointsImport","DEFAULT_SCENE_BOUNDS","min","max","DEFAULT_CAMERA_POSITIONS","up","top","front","iso","RISER_COLORS","COLORS","seabed","vesselCOG","cdp","tdp","catenary","ModelStateService","_model","createEmptyModel","_selectedRiserId","_selectedVesselId","_isCalculating","_isDirty","_undoStack","_redoStack","MAX_HISTORY","_logs","_validationResult","asReadonly","isCalculating","isDirty","validationResult","computed","selectedRiser","r","selectedVessel","canUndo","canRedo","riserCount","vesselCount","newModel","loadModel","updateEnvironment","previous","pushUndoAction","current","m","updatedAt","riserId","undo","stack","action","applyUndoAction","redo","applyRedoAction","calculating","setValidationResult","level","details","entry","timestamp","createdAt","newStack","OrcaFlexRiserModule","version","component","onInit","injector","get","services","config","applyConfig","onDestroy","onActivate","onDeactivate","onRibbonAction","notifications","info","handleImportYaml","handleExportYaml","handleCalculateAll","handleValidateModel","handleGoalSeek","window","open","showAboutDialog","dialogs","confirm","title","then","confirmed","warn","onSidebarAction","fileUpload","accept","response","success","blob","URL","createObjectURL","a","href","download","replace","click","revokeObjectURL","valid","warning","errors","warnings","ConnectionPointsImportDialogComponent","ThreeViewComponent","canvasRef","containerRef","viewHelperCanvasRef","sceneManager","resizeObserver","viewHelper","viewHelperRenderer","clock","globalCoordSystem","vesselCoordSystems","vesselGroups","connectionPointGroups","waterPlane","seabedPlane","gridHelper","currentView","displayMenuOpen","showCoordinateSystems","showVessel","showConnectionPoints","showWater","showSeabed","showGrid","effect","rebuildScene","ngAfterViewInit","nativeElement","initialize","ResizeObserver","onResize","observe","parentElement","setupViewHelper","startRenderLoop","renderViewHelper","addEventListener","bind","closeMenuOnOutsideClick","removeEventListener","disconnect","viewHelperCanvas","alpha","antialias","setSize","setPixelRatio","devicePixelRatio","getCamera","getControlsTarget","onViewHelperClick","left","fakeEvent","getDelta","clear","closest","clearObjects","forEach","vesselGroup","vesselCoordSys","headingRad","cosH","sinH","sin","cpX","cpY","cpZ","cpGroup","hasResults","pointsCount","index","vesselHeadingDeg","totalRotationRad","vesselHeadingRad","hangoffX","hangoffY","cable","tdpLocalX","tdpLocalY","cosTot","sinTot","tdpGlobalX","tdpGlobalY","allPoints","lazyWave","buoyancyStartX","buoyancyEndX","updateSceneBounds","setView","view","setCamera","zoomToFit","toggleDisplayMenu","toggleVisibility","element","coordVisible","vcs","vesselVisible","vg","cpVisible","waterVisible","seabedVisible","gridVisible","activeElement","HTMLInputElement","HTMLTextAreaElement","toLowerCase","ViewChild","static","ElementRef","createCatenaryCable","lineRadius","group","pointCount","start","end","distance","subVectors","cylinder","midpoint","addVectors","rotateX","createTDPMarker","calculateModuleBuoyancy","calculateBuoyancySectionLength","calculateBuoyancyWeightPerMeter","totalBuoyancy","sectionLength","calculateWetMass","displacedMass","pow","calculateDryMass","calculatePipeDensity","crossSectionArea","calculateDryMassFromDensity","calculateEffectiveWeight","innerArea","outerArea","DEFAULT_LINE_TYPES","category","DEFAULT_BUOYANCY_MODULE","ResultsSectionComponent","DEFAULT_CONTENTS","SceneManager","scene","animationId","cameraPositions","sceneBounds","clientWidth","clientHeight","shadowMap","enabled","setupBackground","aspect","domElement","enableDamping","dampingFactor","screenSpacePanning","minDistance","maxDistance","setupLights","ctx","gradient","createLinearGradient","addColorStop","fillRect","magFilter","background","ambient","directional","castShadow","shadow","near","far","mapSize","pos","setTimeout","fovRadians","fov","tan","dir","normalize","bounds","updateProjectionMatrix","onFrame","animate","requestAnimationFrame","stopRenderLoop","cancelAnimationFrame","remove","toRemove","child","obj","parent","getScene","getRenderer","getCurrentView","createLazyWaveFromPoints","normalRadius","buoyancySection","normalMaterial","buoyancyPipeRadius","buoyancyPipeMaterial","offsetHSL","getHex","buoyMinX","buoyMaxX","buoyancySectionPoints","midX","isBuoyancy","pathPoints","arcLengths","dx","dy","dz","sqrt","modulePositions","moduleMaterial","targetArcLength","direction","getPointOnPath","moduleRadius","lengthSq","clone","createBuoyancyModulesAlongPath","segmentIndex","p1","p2","segmentStart","segmentLength","t","DEFAULT_VESSEL","GenerateOrcaflexDialogComponent","generate","riserSelections","vesselConditions","offset","oneRiserPerModel","isGenerating","generatedModels","initializeSelections","ngOnChanges","selections","riserName","contentName","selected","updateModelList","selectAllContents","deselectAllContents","addCondition","conditions","removeCondition","splice","models","selectedRisers","condition","conditionStr","conditionLabel","modelName","sanitizeName","riserNames","onGenerate","selection","contentSel","yaml","generateOrcaFlexYaml","downloadAsZip","lineName","join","zip","zipBlob","generateAsync","zipFilename","toISOString","appendChild","removeChild","createSeabed","addNoise","positions","attributes","getZ","setZ","random","needsUpdate","computeVertexNormals","DEFAULT_ENVIRONMENT","seabedType","seabedFriction","currentProfiles","speed","wave","LineTypesImportDialogComponent","getDefaultRow","createVesselGroup","dimensions","hull","createVesselMesh","cogGeometry","cogMaterial","emissive","emissiveIntensity","cog","createConnectionPoint","ringGeometry","ringMaterial","ring","textBaseline","labelMaterial","label","EnvironmentSectionComponent","expandedSubsections","editingCurrentIdx","editingDepth","editingSpeed","addingCurrent","newCurrentDepth","newCurrentSpeed","toggleSubsection","updateWaterDepth","updateWaterDensity","updateSeabedFriction","updateSeabedStiffness","seabedStiffness","updateSeabedType","updateWaveType","updateWaveHeight","updateWavePeriod","period","updateWaveDirection","updateWaveSpectrum","spectrum","updateWaveGamma","gamma","startEditCurrent","profile","saveCurrentEdit","profiles","sort","b","cancelCurrentEdit","deleteCurrentProfile","startAddCurrent","addCurrentProfile","cancelAddCurrent","createCoordinateAxes","showLabels","origin","xDir","xArrow","yDir","yArrow","zDir","zArrow","xLabel","createAxisLabel","yLabel","zLabel","createGlobalCoordinateSystem","axes","originGeometry","originMaterial","originSphere","globalLabel","createVesselCoordinateSystem","vesselLabel","clearRect","hexColor","depthTest","sprite"],"ignoreList":[],"sourceRoot":""}